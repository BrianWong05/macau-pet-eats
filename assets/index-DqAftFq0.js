import{u as I,j as e,s as m}from"./index-CdrfHzWc.js";import{r as o}from"./react-vendor-7d_4YsRm.js";import{a7 as L,Z as T,a8 as M,_ as R,X as J,$ as U,y as G,t as l}from"./ui-vendor-uHOkKSV_.js";import"./supabase-K6a4hp2a.js";function $(){const{t:d}=I(["admin","common"]),[i,p]=o.useState([]),[j,y]=o.useState([]),[S,N]=o.useState(!0),[v,_]=o.useState(!1),[P,h]=o.useState(null),[s,u]=o.useState({name:"",name_zh:"",name_pt:""}),[C,g]=o.useState(!1),[n,c]=o.useState({name:"",name_zh:"",name_pt:""}),b=JSON.stringify(i.map(t=>t.id))!==JSON.stringify(j.map(t=>t.id)),w=t=>t.split("_").map(r=>r.charAt(0).toUpperCase()+r.slice(1).toLowerCase()).join(" "),z=t=>t.trim().toLowerCase().replace(/\s+/g,"_"),x=async()=>{N(!0);const{data:t,error:r}=await m.from("pet_policies").select("*").order("sort_order",{ascending:!0});!r&&t&&(p(t),y(t)),N(!1)};o.useEffect(()=>{x()},[]);const k=async()=>{if(!n.name.trim()){l.error("Name is required");return}const t=i.length>0?Math.max(...i.map(a=>a.sort_order)):0,{error:r}=await m.from("pet_policies").insert({name:z(n.name),name_zh:n.name_zh.trim()||null,name_pt:n.name_pt.trim()||null,sort_order:t+1});r?l.error("Failed to add pet policy"):(l.success("Pet policy added"),c({name:"",name_zh:"",name_pt:""}),g(!1),x())},O=t=>{h(t.id),u({name:w(t.name),name_zh:t.name_zh||"",name_pt:t.name_pt||""})},F=async t=>{if(!s.name.trim()){l.error("Name is required");return}const{error:r}=await m.from("pet_policies").update({name:z(s.name),name_zh:s.name_zh.trim()||null,name_pt:s.name_pt.trim()||null}).eq("id",t);r?l.error("Failed to update"):(l.success("Updated"),h(null),x())},D=async t=>{if(!confirm("Delete this pet policy?"))return;const{error:r}=await m.from("pet_policies").delete().eq("id",t);r?l.error("Failed to delete"):(l.success("Deleted"),x())},A=(t,r)=>{if(t===r)return;const a=[...i],[f]=a.splice(t,1);a.splice(r,0,f),p(a)},E=async()=>{_(!0);let t=!1;for(let r=0;r<i.length;r++){const{error:a}=await m.from("pet_policies").update({sort_order:r+1}).eq("id",i[r].id);if(a){t=!0;break}}t?l.error("Failed to save order"):(l.success("Order saved"),y([...i])),_(!1)},q=()=>{p([...j])};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-neutral-900",children:d("admin:petPolicies.title")||"Pet Policies"}),e.jsx("p",{className:"text-neutral-500",children:d("admin:petPolicies.subtitle")||"Manage pet policy options"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[b&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:q,className:"px-4 py-2 text-neutral-600 hover:bg-neutral-100 rounded-xl transition-colors",children:d("common:cancel")||"Cancel"}),e.jsxs("button",{onClick:E,disabled:v,className:"flex items-center gap-2 px-4 py-2 bg-green-500 hover:bg-green-600 disabled:bg-green-300 text-white rounded-xl transition-colors",children:[e.jsx(L,{size:18}),v?"...":d("common:save")||"Save Order"]})]}),!C&&!b&&e.jsxs("button",{onClick:()=>g(!0),className:"flex items-center gap-2 px-4 py-2 bg-primary-500 hover:bg-primary-600 text-white rounded-xl transition-colors",children:[e.jsx(T,{size:18}),d("admin:petPolicies.add")||"Add Policy"]})]})]}),b&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-3 text-amber-700 text-sm",children:["⚠️ ",d("admin:petPolicies.orderChanged")||'Order has changed. Click "Save Order" to save.']}),C&&e.jsxs("div",{className:"bg-white rounded-xl border border-neutral-200 p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Name (e.g. Medium Dogs Allowed)",value:n.name,onChange:t=>c({...n,name:t.target.value}),className:"px-4 py-2 border border-neutral-200 rounded-lg focus:ring-2 focus:ring-primary-500"}),e.jsx("input",{type:"text",placeholder:"Name (中文)",value:n.name_zh,onChange:t=>c({...n,name_zh:t.target.value}),className:"px-4 py-2 border border-neutral-200 rounded-lg focus:ring-2 focus:ring-primary-500"}),e.jsx("input",{type:"text",placeholder:"Name (Português)",value:n.name_pt,onChange:t=>c({...n,name_pt:t.target.value}),className:"px-4 py-2 border border-neutral-200 rounded-lg focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>{g(!1),c({name:"",name_zh:"",name_pt:""})},className:"px-4 py-2 text-neutral-600 hover:bg-neutral-100 rounded-lg",children:d("common:cancel")||"Cancel"}),e.jsx("button",{onClick:k,className:"px-4 py-2 bg-primary-500 hover:bg-primary-600 text-white rounded-lg",children:d("common:save")||"Add"})]})]}),e.jsx("div",{className:"bg-white rounded-xl border border-neutral-200 overflow-hidden",children:S?e.jsx("div",{className:"p-8 text-center text-neutral-500",children:"Loading..."}):i.length===0?e.jsx("div",{className:"p-8 text-center text-neutral-500",children:"No pet policies found"}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-neutral-50 border-b border-neutral-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-10 px-4 py-3"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-medium text-neutral-600",children:"Key"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-medium text-neutral-600",children:"中文"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-medium text-neutral-600",children:"Português"}),e.jsx("th",{className:"w-32 px-4 py-3 text-right text-sm font-medium text-neutral-600",children:"Actions"})]})}),e.jsx("tbody",{children:i.map((t,r)=>e.jsxs("tr",{className:"border-b border-neutral-100 hover:bg-neutral-50",draggable:!0,onDragStart:a=>a.dataTransfer.setData("index",r.toString()),onDragOver:a=>a.preventDefault(),onDrop:a=>{const f=parseInt(a.dataTransfer.getData("index"));A(f,r)},children:[e.jsx("td",{className:"px-4 py-3 cursor-grab",children:e.jsx(M,{size:16,className:"text-neutral-400"})}),P===t.id?e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"text",value:s.name,onChange:a=>u({...s,name:a.target.value}),className:"w-full px-2 py-1 border border-neutral-200 rounded"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"text",value:s.name_zh,onChange:a=>u({...s,name_zh:a.target.value}),className:"w-full px-2 py-1 border border-neutral-200 rounded"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"text",value:s.name_pt,onChange:a=>u({...s,name_pt:a.target.value}),className:"w-full px-2 py-1 border border-neutral-200 rounded"})}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsx("button",{onClick:()=>F(t.id),className:"p-1 text-green-500 hover:bg-green-50 rounded",children:e.jsx(R,{size:16})}),e.jsx("button",{onClick:()=>h(null),className:"p-1 text-neutral-500 hover:bg-neutral-100 rounded ml-1",children:e.jsx(J,{size:16})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-4 py-3 font-mono text-sm text-neutral-700",children:w(t.name)}),e.jsx("td",{className:"px-4 py-3 text-neutral-700",children:t.name_zh||"-"}),e.jsx("td",{className:"px-4 py-3 text-neutral-700",children:t.name_pt||"-"}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsx("button",{onClick:()=>O(t),className:"p-1 text-neutral-500 hover:bg-neutral-100 rounded",children:e.jsx(U,{size:16})}),e.jsx("button",{onClick:()=>D(t.id),className:"p-1 text-red-500 hover:bg-red-50 rounded ml-1",children:e.jsx(G,{size:16})})]})]})]},t.id))})]})})]})}export{$ as AdminPetPolicies};
