import{u as N,a as T,j as e,c as ie,s as L}from"./index-CmKh2cFY.js";import{L as O,r as o,i as ce}from"./react-vendor-B-2HpIm1.js";import{A as de}from"./index-h-3U-Q6_.js";import{L as me}from"./index-DFrpsQpT.js";import{A as Q,L as ue,g as Z,h as U,U as ee,n as te,N as xe,o as se,F as pe,l as re,E as he,p as fe,I as ge,G as be,q as je,r as V,s as K,M as B,u as H,v as ve,X as ae,w as G,x as X,t as J}from"./ui-vendor-CRea9Wwv.js";import{g as F,P as we}from"./index-C5HAZOLl.js";import{g as Ne,R as ye}from"./index-D5tAYuyW.js";import"./supabase-K6a4hp2a.js";function ke({isScrolled:t,onLoginClick:a}){const{t:l}=N(),{user:n,signOut:s}=T();return e.jsx("header",{className:`
        fixed top-0 left-0 right-0 z-50 transition-all duration-300
        ${t?"bg-white/80 backdrop-blur-md shadow-sm py-3":"bg-transparent py-4"}
      `,children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between",children:[e.jsxs(O,{to:"/",className:`flex items-center gap-2 px-4 py-2 rounded-full transition-all ${t?"text-neutral-600 hover:bg-neutral-100":"bg-white/20 backdrop-blur-sm text-white hover:bg-white/30"}`,children:[e.jsx(Q,{size:20}),e.jsx("span",{className:"font-medium hidden sm:block",children:l("restaurant.backToList")})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[n?e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx("span",{className:`text-sm font-medium hidden sm:block ${t?"text-neutral-700":"text-white drop-shadow-md"}`,children:n.email}),e.jsx("button",{onClick:()=>s(),className:`p-2 rounded-full transition-all ${t?"bg-white shadow-sm text-neutral-600 hover:text-red-600":"bg-white/20 backdrop-blur-sm text-white hover:bg-white/30"}`,title:l("auth.logout")||"Logout",children:e.jsx(ue,{size:20})})]}):e.jsxs("button",{onClick:a,className:`flex items-center gap-2 px-4 py-2 rounded-full shadow-sm hover:shadow-md transition-all font-medium ${t?"bg-white text-neutral-700":"bg-white/90 backdrop-blur-sm text-neutral-700"}`,children:[e.jsx(Z,{size:18}),e.jsx("span",{children:l("auth.login")||"Login"})]}),e.jsxs(O,{to:"/submit",className:`flex items-center gap-2 px-4 py-2 rounded-full shadow-sm hover:shadow-md transition-all font-medium ${t?"bg-white text-neutral-700":"bg-white/90 backdrop-blur-sm text-neutral-700"}`,children:[e.jsx(U,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:l("nav.submit")})]}),e.jsx("div",{className:t?"":"bg-white/20 backdrop-blur-sm rounded-lg",children:e.jsx(me,{})})]})]})})}function _e({restaurant:t,lang:a}){const{getLocalizedName:l}=ie(),n=F(t,"name",a),s=F(t,"cuisine_type","en");return e.jsxs("div",{className:"relative h-64 md:h-96",children:[e.jsx("img",{src:t.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=1200",alt:n,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-6 md:p-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-white mb-3 drop-shadow-lg",children:n}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-2",children:[e.jsx(we,{policy:t.pet_policy,size:"lg"}),s.map((r,m)=>e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-white/90 backdrop-blur-sm text-sm font-medium text-neutral-700 rounded-full",children:[e.jsx(ee,{size:14}),l(r,a)]},m))]}),e.jsxs("div",{className:"mt-3 inline-flex items-center gap-2 bg-amber-400/95 backdrop-blur-sm px-4 py-2 rounded-lg shadow-lg",children:[e.jsx(te,{className:"w-4 h-4 text-amber-900 flex-shrink-0"}),e.jsx("p",{className:"text-sm font-semibold text-amber-900",children:a==="zh"?"請致電餐廳確認寵物政策":a==="pt"?"Por favor confirme a política de animais com o restaurante":"Please confirm pet policy with the restaurant"})]})]})})]})}function Re({restaurant:t,onReportClick:a,onEditClick:l,isAdmin:n}){const{t:s}=N(),r=()=>{if(!t)return"#";const{latitude:x,longitude:d,name:j}=t;return`https://www.google.com/maps/search/?api=1&query=${x},${d}&query_place_id=${encodeURIComponent(j)}`},m=()=>t?.contact_info?`tel:${t.contact_info.replace(/\s/g,"")}`:"#";return e.jsxs("div",{className:"flex flex-wrap gap-4 mb-8",children:[e.jsxs("a",{href:r(),target:"_blank",rel:"noopener noreferrer",className:"flex-1 min-w-[140px] inline-flex items-center justify-center gap-2 px-6 py-4 bg-primary-500 hover:bg-primary-600 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all",children:[e.jsx(xe,{size:20}),s("restaurant.getDirections")]}),t.contact_info&&e.jsxs("a",{href:m(),className:"flex-1 min-w-[140px] inline-flex items-center justify-center gap-2 px-6 py-4 bg-white border-2 border-neutral-200 hover:border-primary-300 text-neutral-700 font-semibold rounded-xl shadow-soft hover:shadow-lg transition-all",children:[e.jsx(se,{size:20}),s("restaurant.callNow")]}),e.jsxs("button",{onClick:a,className:"flex-1 min-w-[140px] inline-flex items-center justify-center gap-2 px-6 py-4 bg-white border-2 border-neutral-200 hover:border-amber-300 text-neutral-700 font-semibold rounded-xl shadow-soft hover:shadow-lg transition-all",children:[e.jsx(pe,{size:20}),s("restaurant.reportUpdate")]}),n&&e.jsx("button",{onClick:l,className:"flex-1 min-w-[140px] inline-flex items-center justify-center gap-2 px-6 py-4 bg-neutral-800 hover:bg-neutral-900 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all",children:s("common.edit")||"Edit"})]})}function Se({restaurant:t,lang:a}){const{t:l}=N(),n=F(t,"description",a),s=F(t,"address",a),r=()=>{if(!t)return"#";const{latitude:x,longitude:d,name:j}=t;return`https://www.google.com/maps/search/?api=1&query=${x},${d}&query_place_id=${encodeURIComponent(j)}`},m=()=>t?.contact_info?`tel:${t.contact_info.replace(/\s/g,"")}`:"#";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-card p-6 mb-6",children:[e.jsx("p",{className:"text-lg text-neutral-700 leading-relaxed mb-4",children:n}),e.jsxs("div",{className:"flex items-start gap-2 pt-3 border-t border-neutral-100",children:[e.jsx(te,{className:"w-4 h-4 text-neutral-400 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-xs text-neutral-500 italic",children:a==="zh"?"此描述可能由 AI 生成，請以實際為準":a==="pt"?"Esta descrição pode ser gerada por IA, por favor confirme com o local":"This description may be AI-generated, please verify with the restaurant"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"bg-white rounded-2xl shadow-card p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-primary-100 rounded-xl",children:e.jsx(re,{className:"w-6 h-6 text-primary-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-neutral-900 mb-1",children:l("restaurant.address")}),e.jsx("p",{className:"text-neutral-600 mb-3",children:s}),e.jsxs("a",{href:r(),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1.5 text-primary-600 hover:text-primary-700 font-medium text-sm",children:[l("restaurant.openInMaps"),e.jsx(he,{size:14})]})]})]})}),t.contact_info&&e.jsx("div",{className:"bg-white rounded-2xl shadow-card p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-secondary-100 rounded-xl",children:e.jsx(se,{className:"w-6 h-6 text-secondary-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-neutral-900 mb-1",children:l("restaurant.contact")}),e.jsx("a",{href:m(),className:"text-neutral-600 hover:text-primary-600 transition-colors",children:t.contact_info})]})]})})]})]})}function Ce({restaurant:t}){const{t:a}=N();return!t.social_media||!Object.values(t.social_media).some(l=>l)?null:e.jsxs("div",{className:"mt-4 bg-white rounded-2xl shadow-card p-6",children:[e.jsx("h3",{className:"font-semibold text-neutral-900 mb-4",children:a("restaurant.socialMedia.title")}),e.jsxs("div",{className:"flex gap-4",children:[t.social_media.facebook&&e.jsxs("a",{href:t.social_media.facebook,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-4 py-2 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 transition-colors",children:[e.jsx(fe,{size:18}),e.jsx("span",{className:"text-sm font-medium",children:"Facebook"})]}),t.social_media.instagram&&e.jsxs("a",{href:t.social_media.instagram,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-4 py-2 bg-pink-50 text-pink-600 rounded-lg hover:bg-pink-100 transition-colors",children:[e.jsx(ge,{size:18}),e.jsx("span",{className:"text-sm font-medium",children:"Instagram"})]}),t.social_media.website&&e.jsxs("a",{href:t.social_media.website,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-4 py-2 bg-neutral-100 text-neutral-700 rounded-lg hover:bg-neutral-200 transition-colors",children:[e.jsx(be,{size:18}),e.jsx("span",{className:"text-sm font-medium",children:a("restaurant.socialMedia.website")})]})]})]})}const Me=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"];function ze({restaurant:t}){const{t:a}=N();if(!t.opening_hours)return null;const l=t.opening_hours,n=[];Me.forEach(r=>{const m=l[r]||null,x=m?`${m.open}-${m.close}`:"closed",d=n[n.length-1];(d?.hours?`${d.hours.open}-${d.hours.close}`:d?.hours===null?"closed":null)===x?d.days.push(r):n.push({days:[r],hours:m})});const s=r=>{if(r.length===1)return a(`openingHours.days.${r[0]}`);if(r.length===7)return a("openingHours.everyday")||"Every day";const m=a(`openingHours.days.${r[0]}`),x=a(`openingHours.days.${r[r.length-1]}`);return`${m.substring(0,3)} - ${x.substring(0,3)}`};return e.jsxs("div",{className:"mt-6 bg-white rounded-2xl shadow-card p-6",children:[e.jsxs("h3",{className:"font-semibold text-neutral-900 mb-4 flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5 text-primary-500"}),a("openingHours.title")]}),e.jsx("div",{className:"space-y-2",children:n.map((r,m)=>e.jsxs("div",{className:"flex justify-between text-sm py-1 border-b border-neutral-100 last:border-0",children:[e.jsx("span",{className:"font-medium text-neutral-700",children:s(r.days)}),e.jsx("span",{className:r.hours?"text-neutral-600":"text-neutral-400",children:r.hours?`${r.hours.open} - ${r.hours.close}`:a("openingHours.closed")})]},m))})]})}function Le({restaurant:t}){const{t:a}=N();if(!t.menu_images||t.menu_images.length===0)return null;const l=n=>n.toLowerCase().endsWith(".pdf");return e.jsxs("div",{className:"mt-6 bg-white rounded-2xl shadow-card p-6",children:[e.jsxs("h3",{className:"font-semibold text-neutral-900 mb-4 flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5 text-primary-500"}),a("restaurant.menu")]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:t.menu_images.map((n,s)=>e.jsx("a",{href:n,target:"_blank",rel:"noopener noreferrer",className:"block overflow-hidden rounded-xl border border-neutral-200 hover:shadow-lg transition-shadow",children:l(n)?e.jsxs("div",{className:"w-full h-40 bg-neutral-50 flex flex-col items-center justify-center",children:[e.jsx(V,{size:40,className:"text-red-500 mb-2"}),e.jsx("span",{className:"text-sm font-medium text-neutral-700",children:a("restaurant.viewMenu")||"View Menu"}),e.jsx("span",{className:"text-xs text-neutral-500 mt-1",children:"PDF"})]}):e.jsx("img",{src:n,alt:`Menu ${s+1}`,className:"w-full h-40 object-cover hover:scale-105 transition-transform"})},s))})]})}function $e({restaurant:t,lang:a}){const{t:l}=N(),n=F(t,"name",a),s=()=>Ne(t.google_maps_url,t.latitude,t.longitude,t.name,a);return e.jsxs("div",{className:"mt-8 bg-white rounded-2xl shadow-card p-6",children:[e.jsxs("h3",{className:"font-semibold text-neutral-900 mb-4 flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-primary-500"}),l("restaurant.location")]}),e.jsx("div",{className:"aspect-video rounded-xl overflow-hidden bg-neutral-100",children:e.jsx("iframe",{title:`${n} location`,width:"100%",height:"100%",style:{border:0},loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",src:s()})})]})}function Ee({restaurant:t,lang:a}){const{t:l}=N(),n=F(t,"name",a);return!t.gallery_images||t.gallery_images.length===0?null:e.jsxs("div",{className:"mt-8 bg-white rounded-2xl shadow-card p-6",children:[e.jsxs("h3",{className:"font-semibold text-neutral-900 mb-4 flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5 text-primary-500"}),l("restaurant.photos")]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:t.gallery_images.map((s,r)=>e.jsxs("div",{className:"aspect-square rounded-xl overflow-hidden bg-neutral-100 group relative",children:[e.jsx("img",{src:s,alt:`${n} photo ${r+1}`,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors"})]},r))})]})}function Fe({restaurantId:t}){const{user:a}=T(),[l,n]=o.useState([]),[s,r]=o.useState(!0),[m,x]=o.useState(null),d=o.useCallback(async()=>{r(!0),x(null);try{const{data:f,error:u}=await L.from("reviews").select("*").eq("restaurant_id",t).order("created_at",{ascending:!1});if(u)throw u;n(f||[])}catch(f){const u=f instanceof Error?f.message:"Failed to load reviews";x(u)}finally{r(!1)}},[t]);return o.useEffect(()=>{d()},[d]),{reviews:l,isLoading:s,error:m,submitReview:async(f,u,p=null)=>{if(!a)return{error:"You must be logged in to submit a review"};try{const b=p?URL.createObjectURL(p):null,k={restaurant_id:t,user_id:a.id,rating:f,comment:u,image_url:b},{error:_}=await L.from("reviews").insert(k);if(_)throw _;return await d(),{error:null}}catch(b){return{error:b instanceof Error?b.message:"Failed to submit review"}}},deleteReview:async f=>{if(!a)return{error:"You must be logged in to delete a review"};try{const{error:u}=await L.from("reviews").delete().eq("id",f).eq("user_id",a.id);if(u)throw u;return await d(),{error:null}}catch(u){return{error:u instanceof Error?u.message:"Failed to delete review"}}},refetch:d}}function Ie({restaurantId:t,lang:a,onAuthRequired:l}){const{t:n}=N(),{user:s}=T(),{reviews:r,isLoading:m,submitReview:x,deleteReview:d}=Fe({restaurantId:t||""}),[j,S]=o.useState(!1),[f,u]=o.useState(5),[p,b]=o.useState(""),[k,_]=o.useState(!1),[y,C]=o.useState(null),[M,v]=o.useState(null),[g,R]=o.useState(null),I=()=>{s?S(!0):l()},A=c=>{const w=c.target.files?.[0];if(w){if(w.size>2*1024*1024){C(n("submit.form.uploadHint"));return}v(w);const P=new FileReader;P.onloadend=()=>{R(P.result)},P.readAsDataURL(w)}},$=()=>{v(null),R(null)},q=async c=>{c.preventDefault(),_(!0),C(null);const{error:w}=await x(f,p,M);w?C(w):(S(!1),b(""),u(5),v(null),R(null)),_(!1)},D=async c=>{await d(c)};return e.jsxs("div",{className:"mt-8 bg-white rounded-2xl shadow-card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"font-semibold text-neutral-900 flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5 text-primary-500"}),n("reviews.title"),e.jsxs("span",{className:"text-neutral-400 font-normal",children:["(",r.length,")"]})]}),e.jsxs("button",{onClick:I,className:"inline-flex items-center gap-2 px-4 py-2 bg-primary-500 hover:bg-primary-600 text-white font-medium rounded-xl transition-colors",children:[e.jsx(H,{size:16}),n("reviews.writeReview")]})]}),j&&s&&e.jsxs("form",{onSubmit:q,className:"mb-6 p-4 bg-neutral-50 rounded-xl",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:n("reviews.yourRating")}),e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(c=>e.jsx("button",{type:"button",onClick:()=>u(c),className:"transition-colors",children:e.jsx(H,{size:28,className:c<=f?"fill-amber-400 text-amber-400":"text-neutral-300"})},c))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"comment",className:"block text-sm font-medium text-neutral-700 mb-2",children:n("reviews.yourReview")}),e.jsx("textarea",{id:"comment",value:p,onChange:c=>b(c.target.value),placeholder:n("reviews.reviewPlaceholder"),rows:3,required:!0,className:"w-full px-4 py-3 border-2 border-neutral-200 rounded-xl focus:border-primary-400 focus:ring-4 focus:ring-primary-100 focus:outline-none transition-all resize-none"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:n("reviews.addPhoto")}),g?e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:g,alt:"Preview",className:"h-32 w-auto rounded-lg object-cover border border-neutral-200"}),e.jsx("button",{type:"button",onClick:$,className:"absolute -top-2 -right-2 p-1 bg-white rounded-full shadow-md text-neutral-500 hover:text-red-500 transition-colors","aria-label":n("reviews.removePhoto"),children:e.jsx(ae,{size:16})})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("label",{className:"cursor-pointer inline-flex items-center gap-2 px-4 py-2 bg-white border border-neutral-300 rounded-xl text-sm font-medium text-neutral-700 hover:bg-neutral-50 transition-colors",children:[e.jsx(K,{size:18}),n("reviews.uploadPhoto"),e.jsx("input",{type:"file",accept:"image/*",onChange:A,className:"hidden"})]}),e.jsxs("label",{className:"cursor-pointer inline-flex items-center gap-2 px-4 py-2 bg-white border border-neutral-300 rounded-xl text-sm font-medium text-neutral-700 hover:bg-neutral-50 transition-colors",children:[e.jsx(ve,{size:18}),n("reviews.takePhoto"),e.jsx("input",{type:"file",accept:"image/*",capture:"environment",onChange:A,className:"hidden"})]})]}),e.jsx("p",{className:"mt-1 text-xs text-neutral-400",children:n("reviews.photoHint")})]}),y&&e.jsx("p",{className:"text-red-600 text-sm mb-4",children:y}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",disabled:k,className:"px-6 py-2 bg-primary-500 hover:bg-primary-600 disabled:bg-primary-300 text-white font-medium rounded-xl transition-colors",children:n(k?"common.loading":"reviews.submitReview")}),e.jsx("button",{type:"button",onClick:()=>S(!1),className:"px-6 py-2 bg-neutral-200 hover:bg-neutral-300 text-neutral-700 font-medium rounded-xl transition-colors",children:n("common.cancel")})]})]}),m?e.jsx("div",{className:"space-y-4",children:[1,2].map(c=>e.jsx("div",{className:"h-24 rounded-xl animate-shimmer"},c))}):r.length===0?e.jsxs("div",{className:"text-center py-8 text-neutral-500",children:[e.jsx(B,{className:"w-12 h-12 mx-auto mb-3 text-neutral-300"}),e.jsx("p",{children:n("reviews.noReviews")})]}):e.jsx("div",{className:"space-y-4",children:r.map(c=>e.jsxs("div",{className:"p-4 bg-neutral-50 rounded-xl",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-neutral-200 rounded-full flex items-center justify-center",children:e.jsx(Z,{className:"w-5 h-5 text-neutral-500"})}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(w=>e.jsx(H,{size:14,className:w<=c.rating?"fill-amber-400 text-amber-400":"text-neutral-300"},w))}),e.jsx("p",{className:"text-xs text-neutral-400",children:new Date(c.created_at).toLocaleDateString(a)})]})]}),s?.id===c.user_id&&e.jsx("button",{onClick:()=>D(c.id),className:"p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors","aria-label":n("reviews.deleteReview"),children:e.jsx(G,{size:16})})]}),e.jsx("p",{className:"text-neutral-700",children:c.comment}),c.image_url&&e.jsx("div",{className:"mt-3",children:e.jsx("img",{src:c.image_url,alt:"Review attachment",className:"max-h-48 rounded-lg object-cover border border-neutral-200"})})]},c.id))})]})}function Pe({isOpen:t,onClose:a,restaurantId:l,userId:n}){const{t:s}=N(),[r,m]=o.useState(""),[x,d]=o.useState(""),[j,S]=o.useState(""),[f,u]=o.useState(!1),[p,b]=o.useState([]),[k,_]=o.useState(!1),[y,C]=o.useState("upload"),[M,v]=o.useState(""),[g,R]=o.useState("upload"),[I,A]=o.useState(""),$=o.useRef(null);if(!t)return null;const q=r==="image"||r==="menu",D=r==="menu"?"image/*,.pdf":"image/*",c=async i=>{const h=i.target.files;if(!(!h||h.length===0)){_(!0);try{const z=[];for(const E of Array.from(h)){const ne=E.name.split(".").pop(),le=`${Date.now()}-${Math.random().toString(36).substring(7)}.${ne}`,W=`${r==="menu"?"menus":"gallery"}/${le}`,{error:Y}=await L.storage.from("restaurants").upload(W,E);if(Y)throw Y;const{data:{publicUrl:oe}}=L.storage.from("restaurants").getPublicUrl(W);z.push(oe)}b(E=>[...E,...z])}catch(z){console.error("Upload error:",z),alert(s("common.uploadError")||"Upload failed")}finally{_(!1),$.current&&($.current.value="")}}},w=i=>{b(h=>h.filter((z,E)=>E!==i))},P=async i=>{if(i.preventDefault(),!!r&&!(!q&&!x)&&!(r==="image"&&(g==="upload"&&p.length===0||g==="link"&&!I))&&!(r==="menu"&&(y==="upload"&&p.length===0||y==="link"&&!M))){u(!0);try{let h=x;r==="image"?h=g==="link"?I:p.join(","):r==="menu"&&(h=y==="link"?M:p.join(","));const{error:z}=await L.from("restaurant_reports").insert({restaurant_id:l,user_id:n||null,field_name:r,suggested_value:h,reason:j||null});if(z)throw z;a(),m(""),d(""),S(""),b([]),v(""),J.success(s("restaurant.reportModal.success"))}catch(h){console.error("Report submission error:",h),J.error(s("restaurant.reportModal.error"))}finally{u(!1)}}};return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-fade-in",style:{zIndex:100},children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-neutral-100 flex items-center justify-between sticky top-0 bg-white",children:[e.jsx("h2",{className:"text-xl font-bold text-neutral-900",children:s("restaurant.reportModal.title")}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-neutral-100 rounded-full transition-colors",children:e.jsx(ae,{size:20,className:"text-neutral-500"})})]}),e.jsxs("form",{onSubmit:P,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:s("restaurant.reportModal.fieldLabel")}),e.jsxs("select",{value:r,onChange:i=>{m(i.target.value),b([]),v(""),d("")},required:!0,onInvalid:i=>i.target.setCustomValidity(s("restaurant.reportModal.selectField")),onInput:i=>i.target.setCustomValidity(""),className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:s("restaurant.reportModal.selectField")}),e.jsx("option",{value:"pet_policy",children:s("restaurant.reportModal.fields.pet_policy")}),e.jsx("option",{value:"contact_info",children:s("restaurant.reportModal.fields.contact_info")}),e.jsx("option",{value:"address",children:s("restaurant.reportModal.fields.address")}),e.jsx("option",{value:"cuisine_type",children:s("restaurant.reportModal.fields.cuisine_type")}),e.jsx("option",{value:"image",children:s("restaurant.reportModal.fields.image")||"相片"}),e.jsx("option",{value:"menu",children:s("restaurant.reportModal.fields.menu")||"菜單"}),e.jsx("option",{value:"other",children:s("restaurant.reportModal.fields.other")})]})]}),r==="image"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:[e.jsx(K,{size:16,className:"inline mr-1"}),s("restaurant.reportModal.uploadImages")||"相片"]}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsxs("button",{type:"button",onClick:()=>R("upload"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-1 ${g==="upload"?"bg-primary-500 text-white":"bg-neutral-100 text-neutral-600 hover:bg-neutral-200"}`,children:[e.jsx(U,{size:14}),s("common.upload")||"上傳"]}),e.jsxs("button",{type:"button",onClick:()=>R("link"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-1 ${g==="link"?"bg-primary-500 text-white":"bg-neutral-100 text-neutral-600 hover:bg-neutral-200"}`,children:[e.jsx(X,{size:14}),s("common.link")||"連結"]})]}),g==="upload"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:$,type:"file",accept:D,multiple:!0,onChange:c,className:"hidden",id:"report-file-upload"}),e.jsxs("label",{htmlFor:"report-file-upload",className:"flex items-center justify-center gap-2 w-full p-4 border-2 border-dashed border-neutral-300 rounded-xl cursor-pointer hover:border-primary-400 hover:bg-primary-50 transition-colors",children:[e.jsx(U,{size:20,className:"text-neutral-500"}),e.jsx("span",{className:"text-neutral-600",children:k?s("common.uploading")||"上傳中...":s("common.clickToUpload")||"點擊上傳"})]}),p.length>0&&e.jsx("div",{className:"mt-3 grid grid-cols-3 gap-2",children:p.map((i,h)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:i,alt:"",className:"w-full h-20 object-cover rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>w(h),className:"absolute top-1 right-1 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(G,{size:12})})]},h))})]}),g==="link"&&e.jsx("input",{type:"url",value:I,onChange:i=>A(i.target.value),placeholder:"https://...",className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),r==="menu"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:[e.jsx(V,{size:16,className:"inline mr-1"}),s("restaurant.reportModal.menuUpload")||"菜單"]}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsxs("button",{type:"button",onClick:()=>C("upload"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-1 ${y==="upload"?"bg-primary-500 text-white":"bg-neutral-100 text-neutral-600 hover:bg-neutral-200"}`,children:[e.jsx(U,{size:14}),s("common.upload")||"上傳"]}),e.jsxs("button",{type:"button",onClick:()=>C("link"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-1 ${y==="link"?"bg-primary-500 text-white":"bg-neutral-100 text-neutral-600 hover:bg-neutral-200"}`,children:[e.jsx(X,{size:14}),s("common.link")||"連結"]})]}),y==="upload"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:$,type:"file",accept:D,multiple:!0,onChange:c,className:"hidden",id:"report-menu-upload"}),e.jsxs("label",{htmlFor:"report-menu-upload",className:"flex items-center justify-center gap-2 w-full p-4 border-2 border-dashed border-neutral-300 rounded-xl cursor-pointer hover:border-primary-400 hover:bg-primary-50 transition-colors",children:[e.jsx(U,{size:20,className:"text-neutral-500"}),e.jsx("span",{className:"text-neutral-600",children:k?s("common.uploading")||"上傳中...":s("common.uploadImageOrPdf")||"上傳圖片或 PDF"})]}),p.length>0&&e.jsx("div",{className:"mt-3 space-y-2",children:p.map((i,h)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-neutral-50 rounded-lg",children:[i.endsWith(".pdf")?e.jsx(V,{size:20,className:"text-red-500"}):e.jsx("img",{src:i,alt:"",className:"w-12 h-12 object-cover rounded"}),e.jsx("span",{className:"flex-1 text-sm text-neutral-600 truncate",children:i.split("/").pop()}),e.jsx("button",{type:"button",onClick:()=>w(h),className:"p-1 text-red-500 hover:bg-red-50 rounded",children:e.jsx(G,{size:16})})]},h))})]}),y==="link"&&e.jsx("input",{type:"url",value:M,onChange:i=>v(i.target.value),placeholder:"https://...",className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),!q&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:s("restaurant.reportModal.suggestedValue")}),e.jsx("textarea",{value:x,onChange:i=>d(i.target.value),required:!0,onInvalid:i=>i.target.setCustomValidity(s("restaurant.reportModal.validation.required")),onInput:i=>i.target.setCustomValidity(""),rows:3,className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:s("restaurant.reportModal.reason")}),e.jsx("textarea",{value:j,onChange:i=>S(i.target.value),placeholder:s("restaurant.reportModal.reasonPlaceholder"),rows:2,className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{className:"pt-2 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 text-neutral-600 hover:bg-neutral-50 rounded-lg font-medium transition-colors",children:s("common.cancel")}),e.jsx("button",{type:"submit",disabled:f||k,className:"px-4 py-2 bg-primary-500 text-white rounded-lg font-medium hover:bg-primary-600 transition-colors disabled:opacity-50",children:s(f?"common.loading":"common.submit")})]})]})]})})}function Ue(){const{t}=N();return e.jsx("footer",{className:"bg-neutral-900 text-neutral-400 py-8 mt-16",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 text-center",children:e.jsx("p",{className:"text-sm",children:t("footer.copyright")})})})}function Ae(){return e.jsxs("div",{className:"min-h-screen bg-neutral-50",children:[e.jsx("div",{className:"h-64 md:h-96 animate-shimmer"}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-10 w-3/4 rounded-lg animate-shimmer"}),e.jsx("div",{className:"h-6 w-1/2 rounded-lg animate-shimmer"}),e.jsx("div",{className:"h-32 rounded-xl animate-shimmer"})]})})]})}function qe({error:t}){const{t:a}=N();return e.jsx("div",{className:"min-h-screen bg-neutral-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center px-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-neutral-900 mb-4",children:a("errors.loadingRestaurants")}),e.jsx("p",{className:"text-neutral-600 mb-6",children:t}),e.jsxs(O,{to:"/",className:"inline-flex items-center gap-2 px-6 py-3 bg-primary-500 text-white rounded-xl font-medium hover:bg-primary-600 transition-colors",children:[e.jsx(Q,{size:18}),a("restaurant.backToList")]})]})})}function Be(){const{id:t}=ce(),{i18n:a}=N(),l=a.language,{user:n,isAdmin:s}=T(),[r,m]=o.useState(null),[x,d]=o.useState(!0),[j,S]=o.useState(null),[f,u]=o.useState(!1),[p,b]=o.useState(!1),[k,_]=o.useState(!1),[y,C]=o.useState(!1);o.useEffect(()=>{const v=()=>{b(window.scrollY>10)};return window.addEventListener("scroll",v),()=>window.removeEventListener("scroll",v)},[]);const M=o.useCallback(async(v=!1)=>{if(t){v||d(!0),S(null);try{const{data:g,error:R}=await L.from("restaurants").select("*").eq("id",t).single();if(R)throw R;m(g)}catch(g){const R=g instanceof Error?g.message:"Failed to load restaurant";S(R)}finally{v||d(!1)}}},[t]);return o.useEffect(()=>{M()},[M]),x?e.jsx(Ae,{}):j||!r?e.jsx(qe,{error:j||"Restaurant not found"}):e.jsxs("div",{className:"min-h-screen bg-neutral-50",children:[e.jsx(ke,{isScrolled:p,onLoginClick:()=>u(!0)}),e.jsx(_e,{restaurant:r,lang:l}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[e.jsx(Re,{restaurant:r,onReportClick:()=>_(!0),isAdmin:s,onEditClick:()=>C(!0)}),e.jsx(Se,{restaurant:r,lang:l}),e.jsx(Ce,{restaurant:r}),e.jsx(ze,{restaurant:r}),e.jsx(Le,{restaurant:r}),e.jsx($e,{restaurant:r,lang:l}),e.jsx(Ee,{restaurant:r,lang:l}),e.jsx(Ie,{restaurantId:r.id,lang:l,onAuthRequired:()=>u(!0)})]}),e.jsx(Ue,{}),e.jsx(de,{isOpen:f,onClose:()=>u(!1)}),e.jsx(Pe,{isOpen:k,onClose:()=>_(!1),restaurantId:r.id,userId:n?.id}),e.jsx(ye,{isOpen:y,onClose:()=>C(!1),onSave:()=>{M(!0),C(!1)},restaurant:r})]})}export{Be as RestaurantDetail};
