import{u as S,j as e,b as A,s as N}from"./index-CCFjVqBI.js";import{L as R,r as d}from"./react-vendor-7d_4YsRm.js";import{L as q}from"./index-LclTNxZ1.js";import{A as M,O as H,o as V,X as B,i as W,f as Y,P as X}from"./ui-vendor-uHOkKSV_.js";import"./supabase-K6a4hp2a.js";function G({isScrolled:t}){const{t:l}=S(["submit","restaurant"]);return e.jsx("header",{className:`
        fixed top-0 left-0 right-0 z-50 transition-all duration-300 border-b
        ${t?"bg-white/90 backdrop-blur-md border-neutral-200 py-3 shadow-sm":"bg-white border-neutral-200 py-4"}
      `,children:e.jsxs("div",{className:"max-w-3xl mx-auto px-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(R,{to:"/",className:"p-2 hover:bg-neutral-100 rounded-xl transition-colors","aria-label":l("restaurant:backToList"),children:e.jsx(M,{size:20,className:"text-neutral-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-neutral-900",children:l("submit:title")}),e.jsx("p",{className:"text-sm text-neutral-500 hidden sm:block",children:l("submit:subtitle")})]})]}),e.jsx(q,{})]})})}function J({onReset:t}){const{t:l}=S(["submit","common"]);return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 via-white to-secondary-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-md w-full text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-secondary-100 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(H,{className:"w-10 h-10 text-secondary-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-neutral-900 mb-3",children:l("submit:successTitle")}),e.jsx("p",{className:"text-neutral-600 mb-8",children:l("submit:successMessage")}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsx(R,{to:"/",className:"px-6 py-3 bg-primary-500 text-white font-semibold rounded-xl hover:bg-primary-600 transition-colors",children:l("submit:backToHome")}),e.jsx("button",{onClick:t,className:"px-6 py-3 bg-white border-2 border-neutral-200 text-neutral-700 font-semibold rounded-xl hover:bg-neutral-50 transition-colors",children:l("common:nav.submit")})]})]})})}function K({formData:t,setFormData:l,cuisineTypes:P,formState:y,setFormState:m,imageFiles:j,setImageFiles:v,imagePreviews:x,setImagePreviews:C}){const{t:n,i18n:b}=S(["submit","common","explore","restaurant"]),w=b.language,{petPolicies:k,getPetPolicyDisplayName:f}=A(),p=d.useRef(null),g=s=>{const{name:r,value:a}=s.target;l(o=>({...o,[r]:a}))},$=s=>{const r=Array.from(s.target.files||[]);if(r.length>0){const a=r.filter(o=>!(!o.type.startsWith("image/")||o.size>5242880));a.length>0&&(v(o=>[...o,...a]),a.forEach(o=>{const i=new FileReader;i.onloadend=()=>{C(u=>[...u,i.result])},i.readAsDataURL(o)}))}},U=s=>{v(r=>r.filter((a,o)=>o!==s)),C(r=>r.filter((a,o)=>o!==s)),p.current&&(p.current.value="")},[E,O]=d.useState(!1),z=d.useRef(null),F=async s=>{s.preventDefault(),m("submitting");try{if(!t.cuisine_type||t.cuisine_type.length===0){m("error"),z.current&&(z.current.scrollIntoView({behavior:"smooth",block:"center"}),O(!0),setTimeout(()=>O(!1),2e3));return}const{data:{user:r}}=await N.auth.getUser(),a=[];if(j.length>0)for(const _ of j){const h=_.name.split(".").pop(),T=`${`${Math.random().toString(36).substring(2)}_${Date.now()}.${h}`}`,{error:L}=await N.storage.from("restaurants").upload(T,_);if(L)throw new Error(`Image upload failed: ${L.message}`);const{data:{publicUrl:I}}=N.storage.from("restaurants").getPublicUrl(T);a.push(I)}const o=a.length>0?a[0]:"",i={...t,name_zh:t.name,description_zh:t.description,address_zh:t.address,name:"",description:"",address:"",image_url:o,gallery_images:a,status:"pending",submitted_by:r?.id||null};if(i.cuisine_type&&Array.isArray(i.cuisine_type)){const _=h=>i.cuisine_type.map(c=>c==="Other"?t.cuisine_type_other||"Other":b.getFixedT(h,"common")(`cuisineTypes.${c.toLowerCase()}`));if(i.cuisine_type_zh=_("zh"),i.cuisine_type_pt=_("pt"),i.cuisine_type.includes("Other")&&t.cuisine_type_other){const h=t.cuisine_type_other;i.cuisine_type=i.cuisine_type.map(c=>c==="Other"?h:c),i.cuisine_type_zh=i.cuisine_type_zh.map(c=>c==="其他"||c==="Other"?h:c),i.cuisine_type_pt=i.cuisine_type_pt.map(c=>c==="Outros"||c==="Other"?h:c)}}delete i.cuisine_type_other,i.latitude||(i.latitude=22.1897),i.longitude||(i.longitude=113.5378);const{error:u}=await N.from("restaurants").insert(i);if(u)throw u;m("success")}catch(r){console.error("Submission error:",r),m("error")}};return e.jsxs("form",{onSubmit:F,className:"space-y-6",children:[y==="error"&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 text-red-700 rounded-xl",children:[e.jsx(V,{className:"w-5 h-5 shrink-0"}),e.jsx("span",{children:n("submit:errorMessage")})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-card p-6",children:[e.jsxs("label",{htmlFor:"name",className:"block text-sm font-medium text-neutral-700 mb-2",children:[n("submit:form.name")," *"]}),e.jsx("input",{type:"text",id:"name",name:"name",required:!0,value:t.name,onChange:g,placeholder:n("submit:form.namePlaceholder"),className:"w-full px-4 py-3 border-2 border-neutral-200 rounded-xl focus:border-primary-400 focus:ring-4 focus:ring-primary-100 focus:outline-none transition-all"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-card p-6",children:[e.jsxs("label",{htmlFor:"description",className:"block text-sm font-medium text-neutral-700 mb-2",children:[n("submit:form.description")," (",n("submit:form.optional"),")"]}),e.jsx("textarea",{id:"description",name:"description",rows:4,value:t.description,onChange:g,placeholder:n("submit:form.descriptionPlaceholder"),className:"w-full px-4 py-3 border-2 border-neutral-200 rounded-xl focus:border-primary-400 focus:ring-4 focus:ring-primary-100 focus:outline-none transition-all resize-none"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-card p-6",children:[e.jsxs("label",{htmlFor:"address",className:"block text-sm font-medium text-neutral-700 mb-2",children:[n("submit:form.address")," *"]}),e.jsx("input",{type:"text",id:"address",name:"address",required:!0,value:t.address,onChange:g,placeholder:n("submit:form.addressPlaceholder"),className:"w-full px-4 py-3 border-2 border-neutral-200 rounded-xl focus:border-primary-400 focus:ring-4 focus:ring-primary-100 focus:outline-none transition-all"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-card p-6",children:[e.jsxs("label",{htmlFor:"location",className:"block text-sm font-medium text-neutral-700 mb-2",children:[n("explore:filters.location")||"地區"," *"]}),e.jsxs("select",{id:"location",name:"location",required:!0,value:t.location||"澳門",onChange:g,className:"w-full px-4 py-3 border-2 border-neutral-200 rounded-xl focus:border-primary-400 focus:ring-4 focus:ring-primary-100 focus:outline-none transition-all appearance-none bg-white",children:[e.jsx("option",{value:"澳門",children:"澳門 / Macau"}),e.jsx("option",{value:"氹仔",children:"氹仔 / Taipa"}),e.jsx("option",{value:"路環",children:"路環 / Coloane"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-card p-6",children:[e.jsxs("label",{htmlFor:"pet_policy",className:"block text-sm font-medium text-neutral-700 mb-2",children:[n("submit:form.petPolicy")," *"]}),e.jsx("select",{id:"pet_policy",name:"pet_policy",required:!0,value:t.pet_policy,onChange:g,className:"w-full px-4 py-3 border-2 border-neutral-200 rounded-xl focus:border-primary-400 focus:ring-4 focus:ring-primary-100 focus:outline-none transition-all appearance-none bg-white",children:k.length>0?k.map(s=>e.jsx("option",{value:s.name,children:f(s.name,w)},s.name)):["indoors_allowed","patio_only","small_pets_only","all_pets_welcome","dogs_only","cats_only","medium_dogs_allowed"].map(s=>e.jsx("option",{value:s,children:f(s,w)},s))})]}),e.jsxs("div",{ref:z,className:`bg-white rounded-2xl shadow-card p-6 transition-colors duration-500 ${E?"ring-2 ring-red-500 bg-red-50":""}`,children:[e.jsxs("label",{htmlFor:"cuisine_type",className:"block text-sm font-medium text-neutral-700 mb-2",children:[n("submit:form.cuisineType")," *"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[P.filter(s=>s.name!=="Other").map(s=>{const r=b.language==="zh"?s.name_zh||s.name:b.language==="pt"&&s.name_pt||s.name,a=(t.cuisine_type||[]).includes(s.name);return e.jsx("button",{type:"button",onClick:()=>{const o=t.cuisine_type||[],i=o.includes(s.name)?o.filter(u=>u!==s.name):[...o,s.name];l(u=>({...u,cuisine_type:i}))},className:`
                      px-3 py-1.5 rounded-full text-sm font-medium transition-all border
                      ${a?"bg-primary-500 text-white border-primary-500 shadow-sm":"bg-white text-neutral-600 border-neutral-200 hover:border-primary-300 hover:bg-neutral-50"}
                    `,children:r},s.id)}),e.jsx("button",{type:"button",onClick:()=>{const s=t.cuisine_type||[],r=s.includes("Other")?s.filter(a=>a!=="Other"):[...s,"Other"];l(a=>({...a,cuisine_type:r}))},className:`
                  px-3 py-1.5 rounded-full text-sm font-medium transition-all border
                  ${(t.cuisine_type||[]).includes("Other")?"bg-primary-500 text-white border-primary-500 shadow-sm":"bg-white text-neutral-600 border-neutral-200 hover:border-primary-300 hover:bg-neutral-50"}
                `,children:n("common:other")||"Other"})]}),(t.cuisine_type||[]).includes("Other")&&e.jsx("input",{type:"text",name:"cuisine_type_other",value:t.cuisine_type_other||"",onChange:g,placeholder:n("submit:form.otherCuisinePlaceholder")||"Please specify cuisine type",className:"w-full px-4 py-3 border-2 border-neutral-200 rounded-xl focus:border-primary-400 focus:ring-4 focus:ring-primary-100 focus:outline-none transition-all"}),(t.cuisine_type||[]).length===0&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:n("submit:form.selectAtLeastOne")||"Please select at least one cuisine type"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-card p-6",children:[e.jsxs("label",{htmlFor:"contact_info",className:"block text-sm font-medium text-neutral-700 mb-2",children:[n("submit:form.contactInfo")," (",n("submit:form.optional"),")"]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-neutral-500 font-medium",children:"+853"})}),e.jsx("input",{type:"text",id:"contact_info",name:"contact_info",value:t.contact_info?.replace(/^\+853\s?/,"")||"",onChange:s=>{const r=s.target.value.replace(/^\+853\s?/,"");l(a=>({...a,contact_info:`+853 ${r}`}))},placeholder:"6666 6666",className:"w-full pl-16 pr-4 py-3 border-2 border-neutral-200 rounded-xl focus:border-primary-400 focus:ring-4 focus:ring-primary-100 focus:outline-none transition-all"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-card p-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:[n("restaurant:socialMedia.title")," (",n("submit:form.optional")||"Optional",")"]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsx("input",{type:"url",value:t.social_media?.facebook||"",onChange:s=>l(r=>({...r,social_media:{...r.social_media,facebook:s.target.value||""}})),placeholder:"Facebook URL",className:"w-full px-4 py-3 border-2 border-neutral-200 rounded-xl focus:border-primary-400 focus:ring-4 focus:ring-primary-100 focus:outline-none transition-all"}),e.jsx("input",{type:"url",value:t.social_media?.instagram||"",onChange:s=>l(r=>({...r,social_media:{...r.social_media,instagram:s.target.value||""}})),placeholder:"Instagram URL",className:"w-full px-4 py-3 border-2 border-neutral-200 rounded-xl focus:border-primary-400 focus:ring-4 focus:ring-primary-100 focus:outline-none transition-all"}),e.jsx("input",{type:"url",value:t.social_media?.website||"",onChange:s=>l(r=>({...r,social_media:{...r.social_media,website:s.target.value||""}})),placeholder:"Website URL",className:"w-full px-4 py-3 border-2 border-neutral-200 rounded-xl focus:border-primary-400 focus:ring-4 focus:ring-primary-100 focus:outline-none transition-all"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-card p-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:[n("submit:form.uploadPhoto")," ",e.jsx("span",{className:"text-neutral-500 font-normal ml-1",children:n("submit:form.maxPhotos")})]}),e.jsxs("div",{className:"grid grid-cols-2 xs:grid-cols-3 md:grid-cols-4 gap-4",children:[x.map((s,r)=>e.jsxs("div",{className:"relative aspect-square",children:[e.jsx("img",{src:s,alt:`Preview ${r+1}`,className:"w-full h-full object-cover rounded-xl"}),e.jsx("button",{type:"button",onClick:()=>U(r),className:"absolute top-1 right-1 p-1 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors shadow-md","aria-label":n("common:close"),children:e.jsx(B,{size:14})})]},r)),x.length<5&&e.jsxs("div",{onClick:()=>p.current?.click(),className:`
                border-2 border-dashed border-neutral-300
                rounded-xl aspect-square
                flex flex-col items-center justify-center
                cursor-pointer
                hover:border-primary-400 hover:bg-primary-50
                transition-all
              `,children:[e.jsx("div",{className:"p-2 bg-neutral-100 rounded-full mb-2",children:e.jsx(W,{size:20,className:"text-neutral-400"})}),e.jsx("span",{className:"text-xs font-medium text-neutral-600 text-center px-2",children:x.length===0?n("submit:form.clickToUpload"):n("common:addMore")})]})]}),e.jsx("input",{ref:p,type:"file",accept:"image/*",multiple:!0,onChange:$,className:"hidden"})]}),e.jsx("button",{type:"submit",disabled:y==="submitting",className:"w-full flex items-center justify-center gap-3 px-8 py-4 bg-primary-500 hover:bg-primary-600 disabled:bg-primary-300 text-white font-semibold text-lg rounded-xl shadow-lg hover:shadow-xl transition-all",children:y==="submitting"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:n("common:loading")})]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{size:20}),e.jsx("span",{children:n("submit:submitButton")})]})})]})}function Q(){const{t}=S(["common"]);return e.jsx("footer",{className:"bg-neutral-900 text-neutral-400 py-8 mt-16",children:e.jsxs("div",{className:"max-w-3xl mx-auto px-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx(X,{className:"w-5 h-5 text-primary-400"}),e.jsx("span",{className:"font-semibold text-white",children:t("common:appName")})]}),e.jsxs("p",{className:"text-sm",children:["© ",new Date().getFullYear()," ",t("common:allRightsReserved")]})]})})}function re(){const[t,l]=d.useState(!1),[P,y]=d.useState([]);d.useEffect(()=>{const f=()=>{l(window.scrollY>10)};return window.addEventListener("scroll",f),()=>window.removeEventListener("scroll",f)},[]),d.useEffect(()=>{(async()=>{const{data:p}=await N.from("cuisine_types").select("*").order("sort_order",{ascending:!0});p&&y(p)})()},[]);const[m,j]=d.useState("idle"),[v,x]=d.useState([]),[C,n]=d.useState([]),[b,w]=d.useState({name:"",description:"",address:"",pet_policy:"patio_only",cuisine_type:[],contact_info:"",image_url:"",gallery_images:[],social_media:{facebook:"",instagram:"",website:""}}),k=()=>{j("idle"),x([]),n([]),w({name:"",description:"",address:"",pet_policy:"patio_only",cuisine_type:[],contact_info:"",image_url:"",gallery_images:[],social_media:{facebook:"",instagram:"",website:""}})};return m==="success"?e.jsx(J,{onReset:k}):e.jsxs("div",{className:"min-h-screen bg-neutral-50",children:[e.jsx(G,{isScrolled:t}),e.jsx("div",{className:"max-w-3xl mx-auto px-4 py-8 pt-28",children:e.jsx(K,{formData:b,setFormData:w,cuisineTypes:P,formState:m,setFormState:j,imageFiles:v,setImageFiles:x,imagePreviews:C,setImagePreviews:n})}),e.jsx(Q,{})]})}export{re as Submit};
