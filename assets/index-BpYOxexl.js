import{u as j,j as e,a as k,s as m}from"./index-Cwj2wa9J.js";import{r as x}from"./react-vendor-B-2HpIm1.js";import{a as S,E as C,R as E,k as R,K as L,w as q,F as A,J as c}from"./ui-vendor-1tFYE1Xe.js";import"./supabase-K6a4hp2a.js";function D({filterStatus:n,setFilterStatus:d}){const{t:i}=j(),o=["pending","approved","rejected","all"];return e.jsx("div",{className:"flex gap-2",children:o.map(l=>e.jsx("button",{onClick:()=>d(l),className:`px-4 py-2 rounded-lg font-medium transition-colors ${n===l?"bg-primary-500 text-white":"bg-neutral-100 text-neutral-600 hover:bg-neutral-200"}`,children:i(`admin.reports.status.${l}`)},l))})}function F({reports:n,isLoading:d,processingId:i,onApprove:o,onReject:l,onCheck:p}){const{t:r}=j(),f=t=>{switch(t){case"approved":return e.jsx(q,{className:"w-5 h-5 text-green-500"});case"rejected":return e.jsx(L,{className:"w-5 h-5 text-red-500"});default:return e.jsx(R,{className:"w-5 h-5 text-amber-500"})}},g=t=>({pet_policy:r("restaurant.reportModal.fields.pet_policy"),contact_info:r("restaurant.reportModal.fields.contact_info"),address:r("restaurant.reportModal.fields.address"),cuisine_type:r("restaurant.reportModal.fields.cuisine_type"),other:r("restaurant.reportModal.fields.other")})[t]||t;return d?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(S,{className:"w-8 h-8 animate-spin text-primary-500"})}):n.length===0?e.jsx("div",{className:"text-center py-12 text-neutral-500",children:r("admin.reports.empty")}):e.jsx("div",{className:"space-y-4",children:n.map(t=>e.jsx("div",{className:"bg-white rounded-xl shadow-card p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[f(t.status),e.jsx("span",{className:"font-semibold text-neutral-900",children:t.restaurant?.name_zh||t.restaurant?.name||"Unknown"}),e.jsx("a",{href:`/#/restaurants/${t.restaurant_id}`,target:"_blank",rel:"noopener noreferrer",className:"text-primary-500 hover:text-primary-600",children:e.jsx(C,{size:16})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-neutral-500",children:[r("admin.reports.fieldLabel"),":"]}),e.jsx("span",{className:"ml-2 font-medium",children:g(t.field_name)})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-neutral-500",children:[r("admin.reports.suggestedValue"),":"]}),e.jsx("span",{className:"ml-2 font-medium text-primary-600",children:t.suggested_value})]})]}),t.reason&&e.jsx("p",{className:"mt-2 text-sm text-neutral-600 bg-neutral-50 p-2 rounded-lg",children:t.reason}),e.jsx("p",{className:"mt-2 text-xs text-neutral-400",children:new Date(t.created_at).toLocaleString()})]}),t.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>o(t),disabled:i===t.id,className:"px-4 py-2 bg-green-500 hover:bg-green-600 disabled:bg-neutral-300 text-white rounded-lg font-medium transition-colors",children:i===t.id?"...":r("admin.reports.approve")}),e.jsxs("button",{onClick:()=>p(t.id),disabled:i===t.id,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 disabled:bg-neutral-300 text-white rounded-lg font-medium transition-colors flex items-center gap-1",children:[e.jsx(E,{size:16}),i===t.id?"...":r("admin.reports.check")]}),e.jsx("button",{onClick:()=>l(t.id),disabled:i===t.id,className:"px-4 py-2 bg-red-500 hover:bg-red-600 disabled:bg-neutral-300 text-white rounded-lg font-medium transition-colors",children:i===t.id?"...":r("admin.reports.reject")})]})]})},t.id))})}function B(){const{t:n}=j(),{user:d}=k(),[i,o]=x.useState([]),[l,p]=x.useState(!0),[r,f]=x.useState("pending"),[g,t]=x.useState(null),u=async()=>{p(!0);let s=m.from("restaurant_reports").select(`
        *,
        restaurant:restaurants(id, name, name_zh)
      `).order("created_at",{ascending:!1});r!=="all"&&(s=s.eq("status",r));const{data:a,error:h}=await s;!h&&a&&o(a),p(!1)};x.useEffect(()=>{u()},[r]);const v=async s=>{t(s.id);try{const a={};if(s.field_name==="cuisine_type"){const _=s.suggested_value.includes(",")?s.suggested_value.split(",").map(N=>N.trim()):[s.suggested_value.trim()];a[s.field_name]=_}else a[s.field_name]=s.suggested_value;const{error:h}=await m.from("restaurants").update(a).eq("id",s.restaurant_id);if(h)throw h;const{error:b}=await m.from("restaurant_reports").update({status:"approved",reviewed_at:new Date().toISOString(),reviewed_by:d?.id}).eq("id",s.id);if(b)throw b;c.success(n("admin.reports.approveSuccess")),u()}catch(a){console.error("Approve error:",a),c.error(n("admin.reports.approveError"))}finally{t(null)}},y=async s=>{t(s);try{const{error:a}=await m.from("restaurant_reports").update({status:"rejected",reviewed_at:new Date().toISOString(),reviewed_by:d?.id}).eq("id",s);if(a)throw a;c.success(n("admin.reports.rejectSuccess")),u()}catch(a){console.error("Reject error:",a),c.error(n("admin.reports.rejectError"))}finally{t(null)}},w=async s=>{t(s);try{const{error:a}=await m.from("restaurant_reports").update({status:"approved",reviewed_at:new Date().toISOString(),reviewed_by:d?.id}).eq("id",s);if(a)throw a;c.success(n("admin.reports.checkSuccess")),u()}catch(a){console.error("Check error:",a),c.error(n("admin.reports.checkError"))}finally{t(null)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h1",{className:"text-2xl font-bold text-neutral-900 flex items-center gap-3",children:[e.jsx(A,{className:"text-primary-500"}),n("admin.reports.title")]})}),e.jsx(D,{filterStatus:r,setFilterStatus:f}),e.jsx(F,{reports:i,isLoading:l,processingId:g,onApprove:v,onReject:y,onCheck:w})]})}export{B as AdminReports};
