import{u as _,j as e,c as H,b as J,s as P}from"./index-CdrfHzWc.js";import{h as K,r as n}from"./react-vendor-7d_4YsRm.js";import{j as V,O as M,a5 as q,a6 as W,y as Y,s as F,Z as ee,X as te,t as O}from"./ui-vendor-uHOkKSV_.js";import{R as se}from"./index-D6TPk3zT.js";import{P as ae}from"./index-DUph1MOJ.js";import"./supabase-K6a4hp2a.js";function re({searchQuery:a,setSearchQuery:h,filterStatus:d,setFilterStatus:g}){const{t:u}=_(["admin","common"]),j=["all","pending","approved"];return e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(V,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:u("common:search"),value:a,onChange:r=>h(r.target.value),className:"w-full pl-10 pr-4 py-2 bg-white border border-neutral-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsx("div",{className:"flex gap-2",children:j.map(r=>e.jsx("button",{onClick:()=>g(r),className:`px-4 py-2 rounded-xl text-sm font-medium transition-colors ${d===r?"bg-neutral-900 text-white":"bg-white border border-neutral-200 text-neutral-600 hover:bg-neutral-50"}`,children:u(`admin:restaurants.filters.${r}`)},r))})]})}function ne({restaurants:a,isLoading:h,onApprove:d,onReject:g,onEdit:u,onDelete:j}){const{t:r,i18n:m}=_(["admin","common"]),{getLocalizedName:k}=H(),{getPetPolicyDisplayName:o}=J(),y=m.language,R=({status:s})=>{const x={approved:"bg-green-100 text-green-700",pending:"bg-amber-100 text-amber-700",rejected:"bg-red-100 text-red-700"},b={approved:M,pending:F,rejected:q}[s]||F;return e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-medium ${x[s]||x.pending}`,children:[e.jsx(b,{size:12}),s==="pending"?r("admin:restaurants.status.pending"):s==="approved"?r("admin:restaurants.status.approved"):s==="rejected"?r("admin:restaurants.status.rejected"):s]})};return e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-neutral-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-neutral-50 border-b border-neutral-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-neutral-500 uppercase tracking-wider",children:r("admin:restaurants.table.headers.restaurant")}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-neutral-500 uppercase tracking-wider",children:r("admin:restaurants.table.headers.status")}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-neutral-500 uppercase tracking-wider",children:r("admin:restaurants.table.headers.petPolicy")}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-neutral-500 uppercase tracking-wider",children:r("admin:restaurants.table.headers.submitted")}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-neutral-500 uppercase tracking-wider",children:r("admin:restaurants.table.headers.actions")})]})}),e.jsx("tbody",{className:"divide-y divide-neutral-200",children:h?[1,2,3].map(s=>e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-neutral-100 rounded w-3/4 animate-pulse"})})},s)):a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-12 text-center text-neutral-500",children:r("admin:restaurants.table.noRestaurants")})}):a.map(s=>e.jsxs("tr",{className:"hover:bg-neutral-50/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:s.image_url||"https://via.placeholder.com/40",alt:"",className:"w-10 h-10 rounded-lg object-cover bg-neutral-100"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-neutral-900",children:s.name_zh||s.name}),e.jsx("p",{className:"text-sm text-neutral-500",children:Array.isArray(s.cuisine_type)?s.cuisine_type.map(x=>k(x,y)).join(", "):s.cuisine_type})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(R,{status:s.status||"approved"})}),e.jsx("td",{className:"px-6 py-4 text-sm text-neutral-600",children:o(s.pet_policy,y)}),e.jsx("td",{className:"px-6 py-4 text-sm text-neutral-600",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>d(s),className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Approve",children:e.jsx(M,{size:18})}),e.jsx("button",{onClick:()=>g(s),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Reject",children:e.jsx(q,{size:18})}),e.jsx("div",{className:"w-px h-4 bg-neutral-200 mx-1"})]}),e.jsx("button",{className:"p-2 text-neutral-400 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors",onClick:()=>u(s),children:e.jsx(W,{size:18})}),e.jsx("button",{className:"p-2 text-neutral-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",onClick:()=>j(s.id),children:e.jsx(Y,{size:18})})]})})]},s.id))})]})})})}const le=[10,25,50,100];function xe(){const{t:a}=_(["admin","search","common"]),[h,d]=K(),[g,u]=n.useState([]),[j,r]=n.useState(!0),[m,k]=n.useState(""),[o,y]=n.useState("all"),[R,s]=n.useState(!1),[x,f]=n.useState(null),[b,I]=n.useState(1),[p,T]=n.useState(25),[i,v]=n.useState(null),[E,N]=n.useState(""),w=async()=>{r(!0);let t=P.from("restaurants").select("*").order("created_at",{ascending:!1});o!=="all"&&(t=t.eq("status",o));const{data:l,error:A}=await t;if(!A&&l){const C=l;u(C);const z=h.get("edit");if(z){const L=C.find(c=>c.id===z);if(L)f(L),s(!0),d(c=>(c.delete("edit"),c));else{const{data:c}=await P.from("restaurants").select("*").eq("id",z).single();c&&(f(c),s(!0),d(D=>(D.delete("edit"),D)))}}}r(!1)};n.useEffect(()=>{w()},[o]),n.useEffect(()=>{I(1)},[m,o,p]);const $=async t=>{if(!confirm("Are you sure you want to delete this restaurant?"))return;const{error:l}=await P.from("restaurants").delete().eq("id",t);l||(O.success("Restaurant deleted successfully"),w())},B=async(t,l,A)=>{const{error:C}=await P.from("restaurants").update({status:l,admin_comment:A||null}).eq("id",t);C||(O.success(a(l==="approved"?"admin:restaurants.actions.approveSuccess":"admin:restaurants.actions.rejectSuccess")),w())},Q=(t,l)=>{v({type:"approve",restaurantId:t,restaurantName:l}),N("")},X=(t,l)=>{v({type:"reject",restaurantId:t,restaurantName:l}),N("")},Z=async()=>{i&&(await B(i.restaurantId,i.type==="approve"?"approved":"rejected",E||void 0),v(null),N(""))},S=g.filter(t=>t.name.toLowerCase().includes(m.toLowerCase())||t.name_zh?.toLowerCase().includes(m.toLowerCase())),G=Math.ceil(S.length/p),U=n.useMemo(()=>{const t=(b-1)*p;return S.slice(t,t+p)},[S,b,p]);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-neutral-900",children:a("admin:restaurants.title")}),e.jsx("p",{className:"text-neutral-500 mt-1",children:a("admin:restaurants.subtitle")})]}),e.jsxs("button",{className:"inline-flex items-center gap-2 px-4 py-2 bg-primary-500 hover:bg-primary-600 text-white font-medium rounded-xl transition-colors",onClick:()=>{f(null),s(!0)},children:[e.jsx(ee,{size:20}),a("admin:restaurants.addRestaurant")]})]}),e.jsx(re,{searchQuery:m,setSearchQuery:k,filterStatus:o,setFilterStatus:y}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("p",{className:"text-sm text-neutral-500",children:a("search:results",{count:S.length})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{htmlFor:"admin-page-size",className:"text-sm text-neutral-500",children:[a("search:perPage"),":"]}),e.jsx("select",{id:"admin-page-size",value:p,onChange:t=>T(Number(t.target.value)),className:"px-3 py-1.5 text-sm border border-neutral-200 rounded-lg bg-white focus:ring-2 focus:ring-primary-500",children:le.map(t=>e.jsx("option",{value:t,children:t},t))})]})]}),e.jsx(ne,{restaurants:U,isLoading:j,onApprove:t=>Q(t.id,t.name),onReject:t=>X(t.id,t.name),onEdit:t=>{f(t),s(!0)},onDelete:$}),e.jsx(ae,{currentPage:b,totalPages:G,onPageChange:I}),e.jsx(se,{isOpen:R,onClose:()=>s(!1),onSave:()=>{w(),s(!1)},restaurant:x}),i&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full",children:[e.jsxs("div",{className:"p-5 border-b border-neutral-100 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900",children:a("admin:comment.title")||"Add Comment"}),e.jsx("button",{onClick:()=>v(null),className:"p-2 hover:bg-neutral-100 rounded-full transition-colors",children:e.jsx(te,{size:18,className:"text-neutral-500"})})]}),e.jsxs("div",{className:"p-5 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-neutral-600 mb-1",children:[i.type==="approve"?a("admin:restaurants.actions.approve"):a("admin:restaurants.actions.reject"),": ",e.jsx("strong",{children:i.restaurantName})]}),e.jsx("p",{className:"text-sm text-neutral-500 mb-2",children:a("admin:comment.hint")||"Add a comment for the user (optional)"}),e.jsx("textarea",{value:E,onChange:t=>N(t.target.value),placeholder:a("admin:comment.placeholder")||"Enter your response...",rows:3,className:"w-full px-4 py-3 border border-neutral-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 resize-none",autoFocus:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>v(null),className:"flex-1 px-4 py-2 border border-neutral-200 rounded-xl font-medium text-neutral-600 hover:bg-neutral-50 transition-colors",children:a("common:cancel")}),e.jsx("button",{onClick:Z,className:`flex-1 px-4 py-2 rounded-xl font-medium text-white transition-colors ${i.type==="approve"?"bg-green-500 hover:bg-green-600":"bg-red-500 hover:bg-red-600"}`,children:i.type==="approve"?a("admin:restaurants.actions.approve"):a("admin:restaurants.actions.reject")})]})]})]})})]})}export{xe as AdminRestaurants};
