import{u as E,j as e,s as T}from"./index-CdrfHzWc.js";import{r as o}from"./react-vendor-7d_4YsRm.js";import{a7 as A,X as I,a8 as L,a6 as U,y as Z,Z as J,t as u}from"./ui-vendor-uHOkKSV_.js";import"./supabase-K6a4hp2a.js";function G({newForm:i,setNewForm:l,onAdd:h,onCancel:d}){const{t:c}=E(["admin"]);return e.jsx("div",{className:"bg-white rounded-xl shadow-card p-4 animate-fade-in",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("input",{type:"text",placeholder:c("admin:cuisineTypes.form.key"),value:i.name,onChange:p=>l({...i,name:p.target.value}),className:"px-3 py-2 border border-neutral-200 rounded-lg"}),e.jsx("input",{type:"text",placeholder:c("admin:cuisineTypes.form.nameZh"),value:i.name_zh,onChange:p=>l({...i,name_zh:p.target.value}),className:"px-3 py-2 border border-neutral-200 rounded-lg"}),e.jsx("input",{type:"text",placeholder:c("admin:cuisineTypes.form.namePt"),value:i.name_pt,onChange:p=>l({...i,name_pt:p.target.value}),className:"px-3 py-2 border border-neutral-200 rounded-lg"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:h,className:"flex-1 px-3 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:e.jsx(A,{size:18,className:"mx-auto"})}),e.jsx("button",{onClick:d,className:"px-3 py-2 bg-neutral-200 text-neutral-600 rounded-lg hover:bg-neutral-300 transition-colors",children:e.jsx(I,{size:18})})]})]})})}function M({cuisineTypes:i,isLoading:l,editingId:h,editForm:d,setEditForm:c,onEdit:p,onSave:z,onCancelEdit:S,onDelete:D,onReorder:O}){const{t:m}=E(["admin","common"]),[y,b]=o.useState(null),[w,g]=o.useState(null),f=(a,n)=>{b(n),a.dataTransfer.effectAllowed="move",a.dataTransfer.setData("text/plain",n.toString()),setTimeout(()=>{a.target.closest("tr")?.classList.add("opacity-50")},0)},N=a=>{a.target.closest("tr")?.classList.remove("opacity-50"),b(null),g(null)},_=(a,n)=>{a.preventDefault(),a.dataTransfer.dropEffect="move",n!==y&&g(n)},v=()=>{g(null)},k=(a,n)=>{a.preventDefault();const s=parseInt(a.dataTransfer.getData("text/plain"),10);s!==n&&O(s,n),b(null),g(null)};return e.jsx("div",{className:"bg-white rounded-xl shadow-card overflow-hidden",children:l?e.jsx("div",{className:"p-8 text-center text-neutral-500",children:m("common:loading")}):i.length===0?e.jsx("div",{className:"p-8 text-center text-neutral-500",children:m("admin:cuisineTypes.empty")}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-neutral-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-3 text-left text-sm font-medium text-neutral-600 w-10"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-neutral-600",children:m("admin:cuisineTypes.table.headers.key")}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-neutral-600",children:m("admin:cuisineTypes.table.headers.nameZh")}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-neutral-600",children:m("admin:cuisineTypes.table.headers.namePt")}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-neutral-600",children:m("admin:cuisineTypes.table.headers.actions")})]})}),e.jsx("tbody",{className:"divide-y divide-neutral-100",children:i.map((a,n)=>e.jsx("tr",{className:`hover:bg-neutral-50 transition-colors ${w===n?"bg-primary-50 border-t-2 border-primary-500":""}`,draggable:h!==a.id,onDragStart:s=>f(s,n),onDragEnd:N,onDragOver:s=>_(s,n),onDragLeave:v,onDrop:s=>k(s,n),children:h===a.id?e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-2 py-3",children:e.jsx("span",{className:"text-neutral-300",children:e.jsx(L,{size:16})})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"text",value:d.name,onChange:s=>c({...d,name:s.target.value}),className:"w-full px-2 py-1 border border-neutral-200 rounded"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"text",value:d.name_zh,onChange:s=>c({...d,name_zh:s.target.value}),className:"w-full px-2 py-1 border border-neutral-200 rounded"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"text",value:d.name_pt,onChange:s=>c({...d,name_pt:s.target.value}),className:"w-full px-2 py-1 border border-neutral-200 rounded"})}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsx("button",{onClick:()=>z(a.id),className:"p-1.5 text-primary-600 hover:bg-primary-50 rounded",children:e.jsx(A,{size:16})}),e.jsx("button",{onClick:S,className:"p-1.5 text-neutral-500 hover:bg-neutral-100 rounded ml-1",children:e.jsx(I,{size:16})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-2 py-3 cursor-grab active:cursor-grabbing",children:e.jsx(L,{size:16,className:"text-neutral-400 hover:text-neutral-600"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-neutral-900",children:a.name}),e.jsx("td",{className:"px-4 py-3 text-sm text-neutral-600",children:a.name_zh||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-neutral-600",children:a.name_pt||"-"}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsx("button",{onClick:()=>p(a),className:"p-1.5 text-neutral-500 hover:bg-neutral-100 rounded",children:e.jsx(U,{size:16})}),e.jsx("button",{onClick:()=>D(a.id),className:"p-1.5 text-red-500 hover:bg-red-50 rounded ml-1",children:e.jsx(Z,{size:16})})]})]})},a.id))})]})})}function H(){const{t:i}=E(["admin"]),[l,h]=o.useState([]),[d,c]=o.useState([]),[p,z]=o.useState(!0),[S,D]=o.useState(!1),[O,m]=o.useState(null),[y,b]=o.useState({name:"",name_zh:"",name_pt:""}),[w,g]=o.useState(!1),[f,N]=o.useState({name:"",name_zh:"",name_pt:""}),_=JSON.stringify(l.map(t=>t.id))!==JSON.stringify(d.map(t=>t.id)),v=async()=>{z(!0);const{data:t,error:r}=await T.from("cuisine_types").select("*").order("sort_order",{ascending:!0});!r&&t&&(h(t),c(t)),z(!1)};o.useEffect(()=>{v()},[]);const k=async()=>{if(!f.name.trim()){u.error("Name is required");return}const t=l.length>0?Math.max(...l.map(j=>j.sort_order)):0,r=j=>j.trim().split(" ").map(C=>C.charAt(0).toUpperCase()+C.slice(1).toLowerCase()).join(" "),{error:x}=await T.from("cuisine_types").insert({name:r(f.name),name_zh:f.name_zh.trim()||null,name_pt:f.name_pt.trim()||null,sort_order:t+1});x?u.error("Failed to add cuisine type"):(u.success("Cuisine type added"),N({name:"",name_zh:"",name_pt:""}),g(!1),v())},a=t=>{m(t.id),b({name:t.name,name_zh:t.name_zh||"",name_pt:t.name_pt||""})},n=async t=>{if(!y.name.trim()){u.error("Name is required");return}const r=j=>j.trim().split(" ").map(C=>C.charAt(0).toUpperCase()+C.slice(1).toLowerCase()).join(" "),{error:x}=await T.from("cuisine_types").update({name:r(y.name),name_zh:y.name_zh.trim()||null,name_pt:y.name_pt.trim()||null}).eq("id",t);x?u.error("Failed to update"):(u.success("Updated"),m(null),v())},s=async t=>{if(!confirm("Delete this cuisine type?"))return;const{error:r}=await T.from("cuisine_types").delete().eq("id",t);r?u.error("Failed to delete"):(u.success("Deleted"),v())},q=(t,r)=>{if(t===r)return;const x=[...l],[j]=x.splice(t,1);x.splice(r,0,j),h(x)},P=async()=>{D(!0);let t=!1;for(let r=0;r<l.length;r++){const{error:x}=await T.from("cuisine_types").update({sort_order:r+1}).eq("id",l[r].id);if(x){t=!0;break}}t?u.error("Failed to save order"):(u.success("Order saved"),c([...l])),D(!1)},R=()=>{h([...d])};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-neutral-900",children:i("admin:cuisineTypes.title")}),e.jsx("p",{className:"text-neutral-500",children:i("admin:cuisineTypes.subtitle")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[_&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:R,className:"px-4 py-2 text-neutral-600 hover:bg-neutral-100 rounded-xl transition-colors",children:"取消"}),e.jsxs("button",{onClick:P,disabled:S,className:"flex items-center gap-2 px-4 py-2 bg-green-500 hover:bg-green-600 disabled:bg-green-300 text-white rounded-xl transition-colors",children:[e.jsx(A,{size:18}),S?"保存中...":"保存順序"]})]}),!w&&!_&&e.jsxs("button",{onClick:()=>g(!0),className:"flex items-center gap-2 px-4 py-2 bg-primary-500 hover:bg-primary-600 text-white rounded-xl transition-colors",children:[e.jsx(J,{size:18}),i("admin:cuisineTypes.add")]})]})]}),_&&e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-3 text-amber-700 text-sm",children:"⚠️ 順序已更改，請點擊「保存順序」以保存更改"}),w&&e.jsx(G,{newForm:f,setNewForm:N,onAdd:k,onCancel:()=>{g(!1),N({name:"",name_zh:"",name_pt:""})}}),e.jsx(M,{cuisineTypes:l,isLoading:p,editingId:O,editForm:y,setEditForm:b,onEdit:a,onSave:n,onCancelEdit:()=>m(null),onDelete:s,onReorder:q})]})}export{H as AdminCuisineTypes};
