import{j as e,u as R,s as C}from"./index-CmKh2cFY.js";import{r as c}from"./react-vendor-B-2HpIm1.js";import{a1 as k,X as A,a2 as E,Z as U,w as J,_ as G,t as m}from"./ui-vendor-CRea9Wwv.js";import"./supabase-K6a4hp2a.js";function K({newForm:i,setNewForm:l,onAdd:x,onCancel:o}){return e.jsx("div",{className:"bg-white rounded-xl shadow-card p-4 animate-fade-in",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Name (key)",value:i.name,onChange:d=>l({...i,name:d.target.value}),className:"px-3 py-2 border border-neutral-200 rounded-lg"}),e.jsx("input",{type:"text",placeholder:"中文名稱",value:i.name_zh,onChange:d=>l({...i,name_zh:d.target.value}),className:"px-3 py-2 border border-neutral-200 rounded-lg"}),e.jsx("input",{type:"text",placeholder:"Nome PT",value:i.name_pt,onChange:d=>l({...i,name_pt:d.target.value}),className:"px-3 py-2 border border-neutral-200 rounded-lg"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:x,className:"flex-1 px-3 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:e.jsx(k,{size:18,className:"mx-auto"})}),e.jsx("button",{onClick:o,className:"px-3 py-2 bg-neutral-200 text-neutral-600 rounded-lg hover:bg-neutral-300 transition-colors",children:e.jsx(A,{size:18})})]})]})})}function M({cuisineTypes:i,isLoading:l,editingId:x,editForm:o,setEditForm:d,onEdit:w,onSave:z,onCancelEdit:S,onDelete:D,onReorder:O}){const[j,u]=c.useState(null),[T,h]=c.useState(null),b=(a,r)=>{u(r),a.dataTransfer.effectAllowed="move",a.dataTransfer.setData("text/plain",r.toString()),setTimeout(()=>{a.target.closest("tr")?.classList.add("opacity-50")},0)},g=a=>{a.target.closest("tr")?.classList.remove("opacity-50"),u(null),h(null)},v=(a,r)=>{a.preventDefault(),a.dataTransfer.dropEffect="move",r!==j&&h(r)},N=()=>{h(null)},f=(a,r)=>{a.preventDefault();const s=parseInt(a.dataTransfer.getData("text/plain"),10);s!==r&&O(s,r),u(null),h(null)};return e.jsx("div",{className:"bg-white rounded-xl shadow-card overflow-hidden",children:l?e.jsx("div",{className:"p-8 text-center text-neutral-500",children:"Loading..."}):i.length===0?e.jsx("div",{className:"p-8 text-center text-neutral-500",children:"No cuisine types"}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-neutral-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-3 text-left text-sm font-medium text-neutral-600 w-10"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-neutral-600",children:"Key"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-neutral-600",children:"中文"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-neutral-600",children:"PT"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-neutral-600",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-neutral-100",children:i.map((a,r)=>e.jsx("tr",{className:`hover:bg-neutral-50 transition-colors ${T===r?"bg-primary-50 border-t-2 border-primary-500":""}`,draggable:x!==a.id,onDragStart:s=>b(s,r),onDragEnd:g,onDragOver:s=>v(s,r),onDragLeave:N,onDrop:s=>f(s,r),children:x===a.id?e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-2 py-3",children:e.jsx("span",{className:"text-neutral-300",children:e.jsx(E,{size:16})})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"text",value:o.name,onChange:s=>d({...o,name:s.target.value}),className:"w-full px-2 py-1 border border-neutral-200 rounded"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"text",value:o.name_zh,onChange:s=>d({...o,name_zh:s.target.value}),className:"w-full px-2 py-1 border border-neutral-200 rounded"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"text",value:o.name_pt,onChange:s=>d({...o,name_pt:s.target.value}),className:"w-full px-2 py-1 border border-neutral-200 rounded"})}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsx("button",{onClick:()=>z(a.id),className:"p-1.5 text-primary-600 hover:bg-primary-50 rounded",children:e.jsx(k,{size:16})}),e.jsx("button",{onClick:S,className:"p-1.5 text-neutral-500 hover:bg-neutral-100 rounded ml-1",children:e.jsx(A,{size:16})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-2 py-3 cursor-grab active:cursor-grabbing",children:e.jsx(E,{size:16,className:"text-neutral-400 hover:text-neutral-600"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-neutral-900",children:a.name}),e.jsx("td",{className:"px-4 py-3 text-sm text-neutral-600",children:a.name_zh||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-neutral-600",children:a.name_pt||"-"}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsx("button",{onClick:()=>w(a),className:"p-1.5 text-neutral-500 hover:bg-neutral-100 rounded",children:e.jsx(U,{size:16})}),e.jsx("button",{onClick:()=>D(a.id),className:"p-1.5 text-red-500 hover:bg-red-50 rounded ml-1",children:e.jsx(J,{size:16})})]})]})},a.id))})]})})}function B(){const{t:i}=R(),[l,x]=c.useState([]),[o,d]=c.useState([]),[w,z]=c.useState(!0),[S,D]=c.useState(!1),[O,j]=c.useState(null),[u,T]=c.useState({name:"",name_zh:"",name_pt:""}),[h,b]=c.useState(!1),[g,v]=c.useState({name:"",name_zh:"",name_pt:""}),N=JSON.stringify(l.map(t=>t.id))!==JSON.stringify(o.map(t=>t.id)),f=async()=>{z(!0);const{data:t,error:n}=await C.from("cuisine_types").select("*").order("sort_order",{ascending:!0});!n&&t&&(x(t),d(t)),z(!1)};c.useEffect(()=>{f()},[]);const a=async()=>{if(!g.name.trim()){m.error("Name is required");return}const t=l.length>0?Math.max(...l.map(y=>y.sort_order)):0,n=y=>y.trim().split(" ").map(_=>_.charAt(0).toUpperCase()+_.slice(1).toLowerCase()).join(" "),{error:p}=await C.from("cuisine_types").insert({name:n(g.name),name_zh:g.name_zh.trim()||null,name_pt:g.name_pt.trim()||null,sort_order:t+1});p?m.error("Failed to add cuisine type"):(m.success("Cuisine type added"),v({name:"",name_zh:"",name_pt:""}),b(!1),f())},r=t=>{j(t.id),T({name:t.name,name_zh:t.name_zh||"",name_pt:t.name_pt||""})},s=async t=>{if(!u.name.trim()){m.error("Name is required");return}const n=y=>y.trim().split(" ").map(_=>_.charAt(0).toUpperCase()+_.slice(1).toLowerCase()).join(" "),{error:p}=await C.from("cuisine_types").update({name:n(u.name),name_zh:u.name_zh.trim()||null,name_pt:u.name_pt.trim()||null}).eq("id",t);p?m.error("Failed to update"):(m.success("Updated"),j(null),f())},L=async t=>{if(!confirm("Delete this cuisine type?"))return;const{error:n}=await C.from("cuisine_types").delete().eq("id",t);n?m.error("Failed to delete"):(m.success("Deleted"),f())},I=(t,n)=>{if(t===n)return;const p=[...l],[y]=p.splice(t,1);p.splice(n,0,y),x(p)},q=async()=>{D(!0);let t=!1;for(let n=0;n<l.length;n++){const{error:p}=await C.from("cuisine_types").update({sort_order:n+1}).eq("id",l[n].id);if(p){t=!0;break}}t?m.error("Failed to save order"):(m.success("Order saved"),d([...l])),D(!1)},P=()=>{x([...o])};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-neutral-900",children:i("admin.cuisineTypes.title")}),e.jsx("p",{className:"text-neutral-500",children:i("admin.cuisineTypes.subtitle")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[N&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:P,className:"px-4 py-2 text-neutral-600 hover:bg-neutral-100 rounded-xl transition-colors",children:"取消"}),e.jsxs("button",{onClick:q,disabled:S,className:"flex items-center gap-2 px-4 py-2 bg-green-500 hover:bg-green-600 disabled:bg-green-300 text-white rounded-xl transition-colors",children:[e.jsx(k,{size:18}),S?"保存中...":"保存順序"]})]}),!h&&!N&&e.jsxs("button",{onClick:()=>b(!0),className:"flex items-center gap-2 px-4 py-2 bg-primary-500 hover:bg-primary-600 text-white rounded-xl transition-colors",children:[e.jsx(G,{size:18}),i("admin.cuisineTypes.add")]})]})]}),N&&e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-3 text-amber-700 text-sm",children:"⚠️ 順序已更改，請點擊「保存順序」以保存更改"}),h&&e.jsx(K,{newForm:g,setNewForm:v,onAdd:a,onCancel:()=>{b(!1),v({name:"",name_zh:"",name_pt:""})}}),e.jsx(M,{cuisineTypes:l,isLoading:w,editingId:O,editForm:u,setEditForm:T,onEdit:r,onSave:s,onCancelEdit:()=>j(null),onDelete:L,onReorder:I})]})}export{B as AdminCuisineTypes};
