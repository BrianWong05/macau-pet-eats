import{u as X,j as e,s as y}from"./index-8xtluKpC.js";import{r as n}from"./react-vendor-7d_4YsRm.js";import{j as B,X as G,x as J,a9 as K,aa as U,y as V,t as m,a as W}from"./ui-vendor-uHOkKSV_.js";import{P as Y}from"./index-Ccm_PCMm.js";import{R as Z}from"./index-7KHcT_0f.js";import"./supabase-K6a4hp2a.js";function ee({rating:t}){return e.jsx("div",{className:"flex items-center gap-0.5",children:[1,2,3,4,5].map(u=>e.jsx(W,{size:14,className:u<=t?"text-amber-400 fill-amber-400":"text-neutral-300"},u))})}function ie(){const{t,i18n:u}=X(["admin","common"]),L=u.language,[f,D]=n.useState([]),[I,w]=n.useState(!0),[i,T]=n.useState("all"),[d,q]=n.useState("all"),[r,C]=n.useState(""),[g,_]=n.useState(1),[o]=n.useState(25),[S,j]=n.useState(null),[R,b]=n.useState(!1),[z,A]=n.useState(null),[k,v]=n.useState(null),[E,x]=n.useState(""),h=async()=>{w(!0);const{data:s,error:a}=await y.from("reviews").select(`
        *,
        restaurants(id, name, name_zh),
        users:profiles(name, email, avatar_url)
      `).order("created_at",{ascending:!1});!a&&s?D(s):a&&(console.error("Error fetching reviews:",a),m.error(t("common:error"))),w(!1)};n.useEffect(()=>{h()},[]),n.useEffect(()=>{_(1)},[i,d,r,o]);const p=n.useMemo(()=>f.filter(s=>{if(i!=="all"&&s.rating!==i||d==="visible"&&s.is_hidden||d==="hidden"&&!s.is_hidden)return!1;if(r){const a=r.toLowerCase(),c=(s.restaurants?.name_zh||s.restaurants?.name||"").toLowerCase(),l=(s.comment||"").toLowerCase(),N=s.user_id.toLowerCase();if(!c.includes(a)&&!l.includes(a)&&!N.includes(a))return!1}return!0}),[f,i,d,r]),P=Math.ceil(p.length/o),M=n.useMemo(()=>{const s=(g-1)*o;return p.slice(s,s+o)},[p,g,o]),O=(s,a)=>{a?H(s,!0,null):(v(s),x(""))},H=async(s,a,c)=>{const l={is_hidden:!a};c!==null&&(l.admin_comment=c);const{error:N}=await y.from("reviews").update(l).eq("id",s);N?m.error(t("common:error")):(m.success(t(a?"admin:reviews.unhidden":"admin:reviews.hidden")),h(),v(null),x(""))},F=async s=>{const{error:a}=await y.from("reviews").delete().eq("id",s);a?(console.error("Delete error:",a),m.error(t("common:error"))):(m.success(t("admin:reviews.deleted")),j(null),h())},Q=s=>{A(s),b(!0)},$=s=>s.restaurants?L==="zh"&&s.restaurants.name_zh?s.restaurants.name_zh:s.restaurants.name:"-";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-neutral-900",children:t("admin:reviews.title")}),e.jsx("p",{className:"text-neutral-500",children:t("admin:reviews.subtitle")})]}),e.jsx("div",{className:"bg-white rounded-xl border border-neutral-200 p-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(B,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400"}),e.jsx("input",{type:"text",value:r,onChange:s=>C(s.target.value),placeholder:t("admin:reviews.searchPlaceholder"),className:"w-full pl-10 pr-4 py-2 border border-neutral-200 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"}),r&&e.jsx("button",{onClick:()=>C(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-neutral-400 hover:text-neutral-600",children:e.jsx(G,{size:16})})]})}),e.jsxs("select",{value:i,onChange:s=>T(s.target.value==="all"?"all":Number(s.target.value)),className:"px-3 py-2 border border-neutral-200 rounded-lg focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"all",children:t("admin:reviews.allRatings")}),[5,4,3,2,1].map(s=>e.jsxs("option",{value:s,children:[s," â˜…"]},s))]}),e.jsxs("select",{value:d,onChange:s=>q(s.target.value),className:"px-3 py-2 border border-neutral-200 rounded-lg focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"all",children:t("admin:reviews.allStatus")}),e.jsx("option",{value:"visible",children:t("admin:reviews.visibleOnly")}),e.jsx("option",{value:"hidden",children:t("admin:reviews.hiddenOnly")})]})]})}),e.jsxs("div",{className:"flex gap-4 text-sm text-neutral-500",children:[e.jsxs("span",{children:[t("admin:reviews.total"),": ",f.length]}),e.jsxs("span",{children:[t("admin:reviews.filtered"),": ",p.length]})]}),e.jsx("div",{className:"bg-white rounded-xl border border-neutral-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-neutral-50 border-b border-neutral-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-neutral-600",children:t("admin:reviews.restaurant")}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-neutral-600",children:t("admin:reviews.reviewer")}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-neutral-600",children:t("admin:reviews.rating")}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-neutral-600",children:t("admin:reviews.comment")}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-neutral-600",children:t("admin:reviews.date")}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-neutral-600",children:t("admin:reviews.actions")})]})}),e.jsx("tbody",{className:"divide-y divide-neutral-100",children:I?[...Array(5)].map((s,a)=>e.jsx("tr",{children:[...Array(6)].map((c,l)=>e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-neutral-200 rounded animate-pulse"})},l))},a)):M.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-12 text-center text-neutral-500",children:t("admin:reviews.noReviews")})}):M.map(s=>e.jsxs("tr",{className:`hover:bg-neutral-50 ${s.is_hidden?"opacity-50 bg-neutral-50":""}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-medium text-neutral-900 line-clamp-1",children:$(s)})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-neutral-900 line-clamp-1",children:s.users?.name||t("common:user")}),s.users?.email&&e.jsx("span",{className:"text-xs text-neutral-500 line-clamp-1",children:s.users.email}),!s.users?.name&&!s.users?.email&&e.jsxs("span",{className:"text-xs text-neutral-400",children:[s.user_id.slice(0,8),"..."]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(ee,{rating:s.rating})}),e.jsxs("td",{className:"px-4 py-3 max-w-xs",children:[e.jsx("p",{className:"text-sm text-neutral-600 line-clamp-2",title:s.comment||"",children:s.comment||e.jsx("span",{className:"text-neutral-400 italic",children:"-"})}),s.is_hidden&&s.admin_comment&&e.jsxs("div",{className:"mt-2 p-2 bg-red-50 border border-red-100 rounded-lg text-xs",children:[e.jsxs("span",{className:"font-medium text-red-700 block mb-0.5",children:[t("common:adminComment"),":"]}),e.jsx("span",{className:"text-red-600",children:s.admin_comment})]})]}),e.jsx("td",{className:"px-4 py-3 text-sm text-neutral-500 whitespace-nowrap",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>Q(s),className:"p-2 text-primary-600 hover:bg-primary-50 rounded-lg transition-colors",title:t("common:edit"),children:e.jsx(J,{size:18})}),e.jsx("button",{onClick:()=>O(s.id,s.is_hidden),className:`p-2 rounded-lg transition-colors ${s.is_hidden?"text-green-600 hover:bg-green-50":"text-amber-600 hover:bg-amber-50"}`,title:s.is_hidden?t("admin:reviews.unhide"):t("admin:reviews.hide"),children:s.is_hidden?e.jsx(K,{size:18}):e.jsx(U,{size:18})}),e.jsx("button",{onClick:()=>j(s.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:t("common:delete"),children:e.jsx(V,{size:18})})]})})]},s.id))})]})})}),P>1&&e.jsx(Y,{currentPage:g,totalPages:P,onPageChange:_}),S&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-sm w-full p-6 space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900",children:t("admin:reviews.deleteConfirmTitle")}),e.jsx("p",{className:"text-neutral-600",children:t("admin:reviews.deleteConfirmMessage")}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>j(null),className:"px-4 py-2 text-neutral-600 hover:bg-neutral-100 rounded-lg transition-colors",children:t("common:cancel")}),e.jsx("button",{onClick:()=>F(S),className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors",children:t("common:delete")})]})]})}),k&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-sm w-full p-6 space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900",children:t("admin:reviews.hideConfirmTitle")||"Hide Review"}),e.jsx("p",{className:"text-neutral-600 text-sm",children:t("admin:reviews.hideConfirmMessage")||"Please provide a reason for hiding this review (optional):"}),e.jsx("textarea",{value:E,onChange:s=>x(s.target.value),placeholder:"Reason for hiding...",className:"w-full px-3 py-2 border border-neutral-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-sm h-24 resize-none"}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>{v(null),x("")},className:"px-4 py-2 text-neutral-600 hover:bg-neutral-100 rounded-lg transition-colors",children:t("common:cancel")}),e.jsx("button",{onClick:()=>H(k,!1,E),className:"px-4 py-2 bg-amber-500 hover:bg-amber-600 text-white rounded-lg transition-colors",children:t("admin:reviews.confirmHide")||"Hide"})]})]})}),R&&z&&e.jsx(Z,{isOpen:R,onClose:()=>b(!1),onSuccess:()=>{h(),b(!1)},review:z})]})}export{ie as AdminReviews};
