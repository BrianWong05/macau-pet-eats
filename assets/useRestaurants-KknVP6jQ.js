import{r as t}from"./react-vendor-7d_4YsRm.js";import{s as g}from"./index-CdrfHzWc.js";const q=["澳門","氹仔","路環"];function A(C={}){const{searchQuery:n="",petPolicyFilter:o=null,cuisineFilters:u=[],locationFilter:c=null}=C,[i,p]=t.useState([]),[l,E]=t.useState([]),[f,R]=t.useState([]),[_,m]=t.useState(!0),[L,h]=t.useState(null),d=t.useCallback(async()=>{m(!0),h(null);try{let e=g.from("restaurants").select("*").eq("status","approved");n.trim()&&(e=e.ilike("name",`%${n}%`)),o&&(e=e.eq("pet_policy",o)),c&&(e=e.eq("location",c)),console.log("useRestaurants: Fetching restaurants...");const{data:s,error:r}=await e.order("created_at",{ascending:!1});if(r)throw console.error("useRestaurants: Error",r),r;console.log("useRestaurants: Data received",s?.length),E(s||[])}catch(e){const s=e instanceof Error?e.message:"Failed to fetch restaurants";h(s),console.error("Error fetching restaurants:",e)}finally{m(!1)}},[n,o,c]);t.useEffect(()=>{if(u.length===0)p(l);else{const e=f.map(r=>r.name.toLowerCase()),s=l.filter(r=>{const y=(r.cuisine_type||[]).map(a=>a.toLowerCase());return u.some(a=>a==="__other__"?y.some(S=>!e.includes(S)):y.includes(a.toLowerCase()))});p(s)}},[l,u,f]),t.useEffect(()=>{(async()=>{const{data:s}=await g.from("cuisine_types").select("*").order("sort_order",{ascending:!0});s&&R(s)})()},[]),t.useEffect(()=>{d()},[d]);const w=t.useMemo(()=>i.slice(0,6),[i]);return{restaurants:i,featuredRestaurants:w,isLoading:_,error:L,refetch:d,cuisineTypes:f}}export{q as L,A as u};
