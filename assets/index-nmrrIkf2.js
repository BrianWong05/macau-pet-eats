import{u as O,j as e,s as _,b as ie}from"./index-da4C4Nok.js";import{r as x}from"./react-vendor-B-2HpIm1.js";import{X as q,q as W,l as oe,x as ce,h as H,r as de,b as ue,t as v,i as me,O as X,W as Y,Y as pe,w as xe,Z as he}from"./ui-vendor-BzBFCVgS.js";import{g as ge,e as fe}from"./mapUtils-Dr1D9bNV.js";import"./supabase-K6a4hp2a.js";const K=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],ye=["indoors_allowed","patio_only","small_pets_only","all_pets_welcome","dogs_only","cats_only"];function be({isOpen:y,onClose:w,onSave:z,restaurant:m}){const{t:r,i18n:p}=O(),[b,N]=x.useState(!1),[F,$]=x.useState(null),[d,C]=x.useState(""),[R,S]=x.useState([]),[k,L]=x.useState([]),[T,g]=x.useState(""),f=x.useRef(null),[E,A]=x.useState([]),[B,P]=x.useState([]),[G,Z]=x.useState(""),I=x.useRef(null);x.useEffect(()=>{(async()=>{const{data:s}=await _.from("cuisine_types").select("*").order("sort_order",{ascending:!0});s&&S(s)})()},[]);const J=t=>{C(t);const s=fe(t);s?(c(l=>({...l,latitude:s.lat,longitude:s.lng,google_maps_url:t})),v.success("Location extracted from URL!")):t&&c(l=>({...l,google_maps_url:t}))},[n,c]=x.useState({name:"",name_zh:"",name_pt:"",address:"",address_zh:"",address_pt:"",description:"",description_zh:"",description_pt:"",pet_policy:"patio_only",cuisine_type:[],contact_info:"",image_url:"",gallery_images:[],menu_images:[],latitude:22.1937,longitude:113.5399,status:"approved"});x.useEffect(()=>{if(m){if(c(m),C(m.google_maps_url||""),m.cuisine_type&&m.cuisine_type.length>0&&R.length>0){const s=R.map(a=>a.name.toLowerCase()),l=m.cuisine_type.find(a=>!s.includes(a.toLowerCase())&&a!=="Other");if(l){const a=m.cuisine_type.map(i=>i===l?"Other":i);c(i=>({...i,cuisine_type:a,cuisine_type_other:l}))}}let t=[];m.gallery_images&&m.gallery_images.length>0?t=m.gallery_images.map((s,l)=>({id:`existing-${l}-${Date.now()}`,preview:s,url:s})):m.image_url&&(t=[{id:`legacy-${Date.now()}`,preview:m.image_url,url:m.image_url}]),L(t),P(m.menu_images||[])}else c({name:"",name_zh:"",name_pt:"",address:"",address_zh:"",address_pt:"",description:"",description_zh:"",description_pt:"",pet_policy:"patio_only",cuisine_type:[],contact_info:"",image_url:"",gallery_images:[],menu_images:[],latitude:22.1937,longitude:113.5399,status:"approved"}),L([]),P([]);A([])},[m,y]);const V=t=>{const s=Array.from(t.target.files||[]);if(s.length>0){const l=s.filter(a=>a.size>5242880?(v.error(`Image ${a.name} is too large (max 5MB)`),!1):!0);l.length>0&&l.forEach(a=>{const i=new FileReader;i.onloadend=()=>{L(o=>[...o,{id:`new-${Math.random().toString(36).substr(2,9)}`,preview:i.result,file:a}])},i.readAsDataURL(a)})}f.current&&(f.current.value="")},ee=t=>{L(s=>s.filter(l=>l.id!==t))},Q=(t,s)=>{if(s==="left"&&t===0||s==="right"&&t===k.length-1)return;const l=[...k],a=s==="left"?t-1:t+1,i=l[t];l[t]=l[a],l[a]=i,L(l)},te=t=>{if(t===0)return;const s=[...k],l=s.splice(t,1)[0];s.unshift(l),L(s)},se=t=>{const s=Array.from(t.target.files||[]);if(s.length>0){const l=s.filter(a=>a.type.startsWith("image/")||a.type==="application/pdf"?a.size>5242880?(v.error(`File ${a.name} is too large (max 5MB)`),!1):!0:(v.error(`File ${a.name} is not a supported format (images or PDF)`),!1));if(l.length===0)return;A(a=>[...a,...l]),l.forEach(a=>{if(a.type==="application/pdf")P(i=>[...i,"PDF:"+a.name]);else{const i=new FileReader;i.onloadend=()=>{P(o=>[...o,i.result])},i.readAsDataURL(a)}})}},re=t=>{const s=(n.menu_images||[]).length;if(t<s){const l=[...n.menu_images||[]];l.splice(t,1),c(a=>({...a,menu_images:l})),P(a=>a.filter((i,o)=>o!==t))}else{const l=t-s;A(a=>a.filter((i,o)=>o!==l)),P(a=>a.filter((i,o)=>o!==t))}I.current&&(I.current.value="")},ae=()=>{const t=G.trim();if(!t)return;if(!t.startsWith("http://")&&!t.startsWith("https://")){v.error("Please enter a valid URL starting with http:// or https://");return}const s=[...n.menu_images||[],t];c(l=>({...l,menu_images:s})),P(l=>[...l,t]),Z("")},ne=()=>{const t=T.trim();if(t){if(!t.startsWith("http://")&&!t.startsWith("https://")){v.error("Please enter a valid URL starting with http:// or https://");return}L(s=>[...s,{id:`url-${Date.now()}`,preview:t,url:t}]),g("")}},le=async t=>{t.preventDefault(),N(!0),$(null);try{if(!n.cuisine_type||n.cuisine_type.length===0){v.error(r("submit.form.selectAtLeastOne")||"Please select at least one cuisine type"),N(!1);return}const s=[];for(const u of k)if(u.url)s.push(u.url);else if(u.file){const j=u.file.name.split(".").pop(),h=`${`${Math.random().toString(36).substring(2)}_${Date.now()}.${j}`}`,{error:U}=await _.storage.from("restaurants").upload(h,u.file);if(U)throw new Error(`Image upload failed: ${U.message}`);const{data:{publicUrl:D}}=_.storage.from("restaurants").getPublicUrl(h);s.push(D)}let l=s.length>0?s[0]:"";const a=[];if(E.length>0)for(const u of E){const j=u.name.split(".").pop(),h=`${`menu_${Math.random().toString(36).substring(2)}_${Date.now()}.${j}`}`,{error:U}=await _.storage.from("restaurants").upload(h,u);if(U)throw new Error(`Menu upload failed: ${U.message}`);const{data:{publicUrl:D}}=_.storage.from("restaurants").getPublicUrl(h);a.push(D)}const i=[...n.menu_images||[],...a],o={...n,gallery_images:s,menu_images:i,image_url:l};if(delete o.cuisine_type_other,n.cuisine_type&&Array.isArray(n.cuisine_type)){const u=j=>n.cuisine_type.map(M=>M==="Other"?n.cuisine_type_other||"Other":p.getFixedT(j)(`cuisineTypes.${M.toLowerCase()}`));if(o.cuisine_type_zh=u("zh"),o.cuisine_type_pt=u("pt"),o.cuisine_type?.includes("Other")&&n.cuisine_type_other){const j=n.cuisine_type_other;o.cuisine_type=o.cuisine_type.map(h=>h==="Other"?j:h);const M=n.cuisine_type_other;M&&(o.cuisine_type_zh=o.cuisine_type_zh.map(h=>h==="其他"||h==="Other"?M:h),o.cuisine_type_pt=o.cuisine_type_pt.map(h=>h==="Outros"||h==="Other"?M:h))}}if(m?.id){const{error:u}=await _.from("restaurants").update(o).eq("id",m.id);if(u)throw u}else{const{error:u}=await _.from("restaurants").insert(o);if(u)throw u}z(),w(),v.success(m?"Restaurant updated successfully":"Restaurant created successfully")}catch(s){console.error("Submission error:",s);const l=s instanceof Error?s.message:"An error occurred";$(l),v.error(l)}finally{N(!1)}};return y?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-neutral-100 p-6 flex items-center justify-between z-10",children:[e.jsx("h2",{className:"text-xl font-bold text-neutral-900",children:m?"Edit Restaurant":"Add Restaurant"}),e.jsx("button",{onClick:w,className:"p-2 text-neutral-400 hover:bg-neutral-100 rounded-lg transition-colors",children:e.jsx(q,{size:20})})]}),e.jsxs("form",{onSubmit:le,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-neutral-700",children:[e.jsx("span",{className:"text-red-500 text-xs mr-1",children:r("common.requiredField")}),r("admin.modal.labels.nameZh")]}),e.jsx("input",{type:"text",required:!0,value:n.name_zh||"",onChange:t=>c(s=>({...s,name_zh:t.target.value})),className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-neutral-700",children:r("admin.modal.labels.nameEn")}),e.jsx("input",{type:"text",value:n.name||"",onChange:t=>c(s=>({...s,name:t.target.value})),className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-neutral-700",children:r("admin.modal.labels.namePt")}),e.jsx("input",{type:"text",value:n.name_pt||"",onChange:t=>c(s=>({...s,name_pt:t.target.value})),className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-primary-500"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-neutral-700",children:[e.jsx("span",{className:"text-red-500 text-xs mr-1",children:r("common.requiredField")}),r("admin.modal.labels.cuisineType")]}),e.jsxs("div",{className:"grid grid-cols-2 xs:grid-cols-3 gap-2",children:[R.filter(t=>t.name!=="Other").map(t=>{const s=p.language==="zh"?t.name_zh||t.name:p.language==="pt"&&t.name_pt||t.name,a=(n.cuisine_type||[]).some(i=>i.toLowerCase()===t.name.toLowerCase());return e.jsx("button",{type:"button",onClick:()=>{const i=n.cuisine_type||[],u=i.find(j=>j.toLowerCase()===t.name.toLowerCase())?i.filter(j=>j.toLowerCase()!==t.name.toLowerCase()):[...i,t.name];c(j=>({...j,cuisine_type:u}))},className:`
                          px-2 py-1.5 rounded-lg text-xs font-medium transition-all border text-center truncate
                          ${a?"bg-primary-500 text-white border-primary-500 shadow-sm":"bg-white text-neutral-600 border-neutral-200 hover:border-primary-300 hover:bg-neutral-50"}
                        `,children:s},t.id)}),e.jsx("button",{type:"button",onClick:()=>{const t=n.cuisine_type||[],s=t.includes("Other")?t.filter(l=>l!=="Other"):[...t,"Other"];c(l=>({...l,cuisine_type:s}))},className:`
                      px-2 py-1.5 rounded-lg text-xs font-medium transition-all border text-center truncate
                      ${(n.cuisine_type||[]).includes("Other")?"bg-primary-500 text-white border-primary-500 shadow-sm":"bg-white text-neutral-600 border-neutral-200 hover:border-primary-300 hover:bg-neutral-50"}
                    `,children:r("common.other")||"Other"})]}),(n.cuisine_type||[]).includes("Other")&&e.jsx("input",{type:"text",required:!0,value:n.cuisine_type_other||"",onChange:t=>c(s=>({...s,cuisine_type_other:t.target.value})),placeholder:r("submit.form.otherCuisinePlaceholder")||"Please specify",className:"w-full mt-2 px-4 py-2 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-neutral-700",children:[e.jsx("span",{className:"text-red-500 text-xs mr-1",children:r("common.requiredField")}),r("admin.modal.labels.petPolicy")]}),e.jsx("select",{required:!0,value:n.pet_policy||"patio_only",onChange:t=>c(s=>({...s,pet_policy:t.target.value})),className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-primary-500",children:ye.map(t=>e.jsx("option",{value:t,children:r(`petPolicy.${t}`)},t))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-neutral-700",children:r("admin.modal.labels.status")}),e.jsxs("select",{value:n.status||"pending",onChange:t=>c(s=>({...s,status:t.target.value})),className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"pending",children:r("admin.restaurants.status.pending")}),e.jsx("option",{value:"approved",children:r("admin.restaurants.status.approved")}),e.jsx("option",{value:"rejected",children:r("admin.restaurants.status.rejected")})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-neutral-700",children:r("explore.filters.location")||"地區"}),e.jsxs("select",{value:n.location||"澳門",onChange:t=>c(s=>({...s,location:t.target.value})),className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"澳門",children:"澳門 / Macau"}),e.jsx("option",{value:"氹仔",children:"氹仔 / Taipa"}),e.jsx("option",{value:"路環",children:"路環 / Coloane"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-neutral-700",children:[e.jsx("span",{className:"text-red-500 text-xs mr-1",children:r("common.requiredField")}),r("admin.modal.labels.descriptionZh")]}),e.jsx("textarea",{required:!0,rows:3,value:n.description_zh||"",onChange:t=>c(s=>({...s,description_zh:t.target.value})),className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-primary-500",placeholder:r("admin.modal.placeholders.description")+" (中文)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-neutral-700",children:r("admin.modal.labels.descriptionEn")}),e.jsx("textarea",{rows:3,value:n.description||"",onChange:t=>c(s=>({...s,description:t.target.value})),className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-primary-500",placeholder:r("admin.modal.placeholders.description")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-neutral-700",children:r("admin.modal.labels.descriptionPt")}),e.jsx("textarea",{rows:3,value:n.description_pt||"",onChange:t=>c(s=>({...s,description_pt:t.target.value})),className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-primary-500",placeholder:r("admin.modal.placeholders.description")+" (葡文)"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-neutral-700",children:[e.jsx("span",{className:"text-red-500 text-xs mr-1",children:r("common.requiredField")}),r("admin.modal.labels.addressZh")]}),e.jsx("input",{type:"text",required:!0,value:n.address_zh||"",onChange:t=>c(s=>({...s,address_zh:t.target.value})),className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-primary-500",placeholder:r("admin.modal.placeholders.address")+" (中文)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-neutral-700",children:r("admin.modal.labels.addressEn")}),e.jsx("input",{type:"text",value:n.address||"",onChange:t=>c(s=>({...s,address:t.target.value})),className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-primary-500",placeholder:r("admin.modal.placeholders.address")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-neutral-700",children:r("admin.modal.labels.addressPt")}),e.jsx("input",{type:"text",value:n.address_pt||"",onChange:t=>c(s=>({...s,address_pt:t.target.value})),className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-primary-500",placeholder:r("admin.modal.placeholders.address")+" (葡文)"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-neutral-700",children:r("admin.modal.labels.contactInfo")}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-neutral-500 font-medium",children:"+853"})}),e.jsx("input",{type:"text",value:n.contact_info?.replace(/^\+853\s?/,"")||"",onChange:t=>{const s=t.target.value.replace(/^\+853\s?/,"");c(l=>({...l,contact_info:`+853 ${s}`}))},className:"w-full pl-16 pr-4 py-2 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-primary-500",placeholder:"6666 6666"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium text-neutral-700",children:r("restaurant.socialMedia.title")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-neutral-500",children:r("restaurant.socialMedia.facebook")}),e.jsx("input",{type:"url",value:n.social_media?.facebook||"",onChange:t=>c(s=>({...s,social_media:{...s.social_media||{},facebook:t.target.value||void 0}})),className:"w-full px-3 py-2 border border-neutral-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-500",placeholder:"https://facebook.com/..."})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-neutral-500",children:r("restaurant.socialMedia.instagram")}),e.jsx("input",{type:"url",value:n.social_media?.instagram||"",onChange:t=>c(s=>({...s,social_media:{...s.social_media||{},instagram:t.target.value||void 0}})),className:"w-full px-3 py-2 border border-neutral-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-500",placeholder:"https://instagram.com/..."})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-neutral-500",children:r("restaurant.socialMedia.website")}),e.jsx("input",{type:"url",value:n.social_media?.website||"",onChange:t=>c(s=>({...s,social_media:{...s.social_media||{},website:t.target.value||void 0}})),className:"w-full px-3 py-2 border border-neutral-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-500",placeholder:"https://..."})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"text-sm font-medium text-neutral-700 flex items-center gap-2",children:[e.jsx(W,{size:16,className:"text-primary-500"}),r("openingHours.title")]}),e.jsx("div",{className:"space-y-2",children:K.map(t=>{const s=n.opening_hours?.[t],l=s!=null;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-24 text-sm text-neutral-600",children:r(`openingHours.days.${t}`)}),e.jsx("label",{className:"flex items-center gap-2",children:e.jsx("input",{type:"checkbox",checked:l,onChange:a=>{const i={...n.opening_hours||{}};a.target.checked?i[t]={open:"09:00",close:"22:00"}:i[t]=null,c(o=>({...o,opening_hours:i}))},className:"rounded border-neutral-300 text-primary-500 focus:ring-primary-500"})}),l?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"time",value:s?.open||"09:00",onChange:a=>{const i={...n.opening_hours||{}};i[t]={...i[t]||{},open:a.target.value},c(o=>({...o,opening_hours:i}))},className:"px-2 py-1 text-sm border border-neutral-200 rounded-lg focus:ring-2 focus:ring-primary-500"}),e.jsx("span",{className:"text-neutral-400",children:"-"}),e.jsx("input",{type:"time",value:s?.close||"22:00",onChange:a=>{const i={...n.opening_hours||{}};i[t]={...i[t]||{},close:a.target.value},c(o=>({...o,opening_hours:i}))},className:"px-2 py-1 text-sm border border-neutral-200 rounded-lg focus:ring-2 focus:ring-primary-500"}),e.jsxs("div",{className:"flex gap-1 ml-2",children:[e.jsx("button",{type:"button",onClick:()=>{const a=n.opening_hours?.[t];if(!a)return;const i=["monday","tuesday","wednesday","thursday","friday"],o={...n.opening_hours||{}};i.forEach(u=>{o[u]={...a}}),c(u=>({...u,opening_hours:o}))},className:"px-2 py-0.5 text-xs bg-neutral-100 hover:bg-neutral-200 text-neutral-600 rounded transition-colors",children:r("openingHours.applyToWeekdays")}),e.jsx("button",{type:"button",onClick:()=>{const a=n.opening_hours?.[t];if(!a)return;const i=["saturday","sunday"],o={...n.opening_hours||{}};i.forEach(u=>{o[u]={...a}}),c(u=>({...u,opening_hours:o}))},className:"px-2 py-0.5 text-xs bg-neutral-100 hover:bg-neutral-200 text-neutral-600 rounded transition-colors",children:r("openingHours.applyToWeekend")}),e.jsx("button",{type:"button",onClick:()=>{const a=n.opening_hours?.[t];if(!a)return;const i={...n.opening_hours||{}};K.forEach(o=>{i[o]={...a}}),c(o=>({...o,opening_hours:i}))},className:"px-2 py-0.5 text-xs bg-primary-100 hover:bg-primary-200 text-primary-600 rounded transition-colors",children:r("openingHours.applyToAll")})]})]}):e.jsx("span",{className:"text-sm text-neutral-400",children:r("openingHours.closed")})]},t)})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"text-sm font-medium text-neutral-700 flex items-center gap-2",children:[e.jsx(oe,{size:16,className:"text-primary-500"}),r("admin.modal.labels.location")," *"]}),e.jsxs("span",{className:"text-xs text-neutral-500",children:[n.latitude?.toFixed(6),", ",n.longitude?.toFixed(6)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ce,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400"}),e.jsx("input",{type:"text",value:d,onChange:t=>J(t.target.value),placeholder:"Paste Google Maps URL here...",className:"w-full pl-10 pr-4 py-2 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("p",{className:"text-xs text-neutral-500",children:["1. Search the restaurant on ",e.jsx("a",{href:"https://maps.google.com",target:"_blank",rel:"noopener noreferrer",className:"text-primary-600 hover:underline",children:"Google Maps"})," ","2. Copy the URL from your browser 3. Paste it above"]})]}),!d&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-neutral-500",children:"Latitude"}),e.jsx("input",{type:"number",step:"any",value:n.latitude||"",onChange:t=>c(s=>({...s,latitude:parseFloat(t.target.value)})),className:"w-full px-3 py-2 border border-neutral-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-neutral-500",children:"Longitude"}),e.jsx("input",{type:"number",step:"any",value:n.longitude||"",onChange:t=>c(s=>({...s,longitude:parseFloat(t.target.value)})),className:"w-full px-3 py-2 border border-neutral-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-500"})]})]}),e.jsx("div",{className:"h-64 rounded-xl overflow-hidden border border-neutral-200",children:e.jsx("iframe",{title:"Location preview",width:"100%",height:"100%",style:{border:0},loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",src:ge(d,n.latitude||22.1937,n.longitude||113.5399,n.name,p.language)})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-neutral-700",children:r("admin.modal.labels.imageUrl")}),e.jsxs("div",{className:"grid grid-cols-2 xs:grid-cols-3 md:grid-cols-4 gap-4",children:[k.map((t,s)=>e.jsxs("div",{className:"relative aspect-square group",children:[e.jsx("img",{src:t.preview,alt:`Preview ${s+1}`,className:`w-full h-full object-cover rounded-xl transition-all ${s===0?"ring-4 ring-primary-500":""}`}),s===0&&e.jsx("div",{className:"absolute top-2 left-2 px-2 py-1 bg-primary-500 text-white text-xs font-bold rounded-md shadow-sm",children:"Cover"}),e.jsxs("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity rounded-xl flex items-center justify-center gap-2",children:[s>0&&e.jsx("button",{type:"button",onClick:()=>Q(s,"left"),className:"p-1.5 bg-white/20 hover:bg-white text-white hover:text-neutral-900 rounded-full backdrop-blur-sm transition-all",title:"Move Left",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"m15 18-6-6 6-6"})})}),s<k.length-1&&e.jsx("button",{type:"button",onClick:()=>Q(s,"right"),className:"p-1.5 bg-white/20 hover:bg-white text-white hover:text-neutral-900 rounded-full backdrop-blur-sm transition-all",title:"Move Right",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"m9 18 6-6-6-6"})})}),s!==0&&e.jsx("button",{type:"button",onClick:()=>te(s),className:"p-1.5 bg-primary-500 hover:bg-primary-600 text-white rounded-full transition-all",title:"Make Cover",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})})}),e.jsx("button",{type:"button",onClick:()=>ee(t.id),className:"p-1.5 bg-red-500 hover:bg-red-600 text-white rounded-full transition-all",title:"Remove",children:e.jsx(q,{size:16})})]})]},t.id)),e.jsxs("div",{onClick:()=>f.current?.click(),className:`
                  border-2 border-dashed border-neutral-300
                  rounded-xl aspect-square
                  flex flex-col items-center justify-center
                  cursor-pointer
                  hover:border-primary-400 hover:bg-primary-50
                  transition-all
                `,children:[e.jsx("div",{className:"p-2 bg-neutral-100 rounded-full mb-2",children:e.jsx(H,{size:20,className:"text-neutral-400"})}),e.jsx("span",{className:"text-xs font-medium text-neutral-600 text-center px-2",children:k.length===0?"Upload Photos":"Add More"})]})]}),e.jsx("input",{ref:f,type:"file",accept:"image/*",multiple:!0,onChange:V,className:"hidden"}),e.jsx("input",{ref:f,type:"file",accept:"image/*",multiple:!0,onChange:V,className:"hidden"}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx("input",{type:"url",value:T,onChange:t=>g(t.target.value),placeholder:"Enter image URL (e.g., https://...)",className:"flex-1 px-4 py-2 border-2 border-neutral-200 rounded-xl focus:border-primary-400 focus:ring-4 focus:ring-primary-100 focus:outline-none transition-all text-sm"}),e.jsx("button",{type:"button",onClick:ne,className:"px-4 py-2 bg-primary-500 text-white rounded-xl hover:bg-primary-600 transition-colors text-sm font-medium",children:"Add Link"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-neutral-700",children:r("restaurant.menu")}),B.length>0?e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[B.map((t,s)=>e.jsxs("div",{className:"relative group",children:[t.startsWith("PDF:")||t.endsWith(".pdf")?e.jsxs("div",{className:"w-full h-32 rounded-xl border border-neutral-200 bg-neutral-50 flex flex-col items-center justify-center",children:[e.jsx(de,{size:32,className:"text-red-500 mb-2"}),e.jsx("span",{className:"text-xs text-neutral-600 truncate max-w-full px-2",children:t.startsWith("PDF:")?t.slice(4):"PDF Menu"})]}):e.jsx("img",{src:t,alt:`Menu ${s}`,className:"w-full h-32 object-cover rounded-xl border border-neutral-200"}),e.jsx("button",{type:"button",onClick:()=>re(s),className:"absolute top-2 right-2 p-1.5 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity shadow-lg",children:e.jsx(q,{size:14})})]},s)),e.jsxs("div",{onClick:()=>I.current?.click(),className:`
                    h-32 border-2 border-dashed border-neutral-300
                    rounded-xl flex flex-col items-center justify-center
                    cursor-pointer hover:border-primary-400 hover:bg-primary-50
                    transition-all
                  `,children:[e.jsx(H,{size:20,className:"text-neutral-400 mb-2"}),e.jsx("span",{className:"text-sm text-neutral-500",children:"Add More"})]})]}):e.jsx("div",{onClick:()=>I.current?.click(),className:`
                  border-2 border-dashed border-neutral-300
                  rounded-xl p-6
                  text-center cursor-pointer
                  hover:border-primary-400 hover:bg-primary-50
                  transition-all
                `,children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(H,{size:24,className:"text-neutral-400"}),e.jsx("p",{className:"text-sm text-neutral-600",children:"Upload menu images"})]})}),e.jsx("input",{ref:I,type:"file",accept:"image/*,.pdf,application/pdf",multiple:!0,onChange:se,className:"hidden"}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx("input",{type:"url",value:G,onChange:t=>Z(t.target.value),placeholder:"Enter PDF or image URL (e.g., https://...)",className:"flex-1 px-4 py-2 border-2 border-neutral-200 rounded-xl focus:border-primary-400 focus:ring-4 focus:ring-primary-100 focus:outline-none transition-all text-sm"}),e.jsx("button",{type:"button",onClick:ae,className:"px-4 py-2 bg-primary-500 text-white rounded-xl hover:bg-primary-600 transition-colors text-sm font-medium",children:"Add Link"})]})]}),F&&e.jsx("div",{className:"p-4 bg-red-50 text-red-600 rounded-xl text-sm",children:F}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:w,className:"px-6 py-2 text-neutral-600 font-medium hover:bg-neutral-50 rounded-xl transition-colors",children:r("admin.modal.buttons.cancel")}),e.jsxs("button",{type:"submit",disabled:b,className:"px-6 py-2 bg-primary-500 hover:bg-primary-600 disabled:bg-primary-300 text-white font-medium rounded-xl transition-colors flex items-center gap-2",children:[b&&e.jsx(ue,{size:18,className:"animate-spin"}),r(m?"admin.modal.buttons.save":"admin.modal.buttons.create")]})]})]})]})}):null}function je({searchQuery:y,setSearchQuery:w,filterStatus:z,setFilterStatus:m}){const{t:r}=O(),p=["all","pending","approved"];return e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(me,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:r("admin.restaurants.searchPlaceholder"),value:y,onChange:b=>w(b.target.value),className:"w-full pl-10 pr-4 py-2 bg-white border border-neutral-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsx("div",{className:"flex gap-2",children:p.map(b=>e.jsx("button",{onClick:()=>m(b),className:`px-4 py-2 rounded-xl text-sm font-medium transition-colors ${z===b?"bg-neutral-900 text-white":"bg-white border border-neutral-200 text-neutral-600 hover:bg-neutral-50"}`,children:r(`admin.restaurants.filters.${b}`)},b))})]})}function ve({restaurants:y,isLoading:w,onStatusUpdate:z,onEdit:m,onDelete:r}){const{t:p,i18n:b}=O(),{getLocalizedName:N}=ie(),F=b.language,$=({status:d})=>{const C={approved:"bg-green-100 text-green-700",pending:"bg-amber-100 text-amber-700",rejected:"bg-red-100 text-red-700"},S={approved:X,pending:W,rejected:Y}[d]||W;return e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-medium ${C[d]||C.pending}`,children:[e.jsx(S,{size:12}),d==="pending"?p("admin.restaurants.status.pending"):d==="approved"?p("admin.restaurants.status.approved"):d==="rejected"?p("admin.restaurants.status.rejected"):d]})};return e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-neutral-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-neutral-50 border-b border-neutral-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-neutral-500 uppercase tracking-wider",children:p("admin.restaurants.table.headers.restaurant")}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-neutral-500 uppercase tracking-wider",children:p("admin.restaurants.table.headers.status")}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-neutral-500 uppercase tracking-wider",children:p("admin.restaurants.table.headers.petPolicy")}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-neutral-500 uppercase tracking-wider",children:p("admin.restaurants.table.headers.submitted")}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-neutral-500 uppercase tracking-wider",children:p("admin.restaurants.table.headers.actions")})]})}),e.jsx("tbody",{className:"divide-y divide-neutral-200",children:w?[1,2,3].map(d=>e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-neutral-100 rounded w-3/4 animate-pulse"})})},d)):y.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-12 text-center text-neutral-500",children:p("admin.restaurants.table.noRestaurants")})}):y.map(d=>e.jsxs("tr",{className:"hover:bg-neutral-50/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:d.image_url||"https://via.placeholder.com/40",alt:"",className:"w-10 h-10 rounded-lg object-cover bg-neutral-100"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-neutral-900",children:d.name_zh||d.name}),e.jsx("p",{className:"text-sm text-neutral-500",children:Array.isArray(d.cuisine_type)?d.cuisine_type.map(C=>N(C,F)).join(", "):d.cuisine_type})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx($,{status:d.status||"approved"})}),e.jsx("td",{className:"px-6 py-4 text-sm text-neutral-600",children:p(`petPolicy.${d.pet_policy}`)}),e.jsx("td",{className:"px-6 py-4 text-sm text-neutral-600",children:new Date(d.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[d.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>z(d.id,"approved"),className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Approve",children:e.jsx(X,{size:18})}),e.jsx("button",{onClick:()=>z(d.id,"rejected"),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Reject",children:e.jsx(Y,{size:18})}),e.jsx("div",{className:"w-px h-4 bg-neutral-200 mx-1"})]}),e.jsx("button",{className:"p-2 text-neutral-400 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors",onClick:()=>m(d),children:e.jsx(pe,{size:18})}),e.jsx("button",{className:"p-2 text-neutral-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",onClick:()=>r(d.id),children:e.jsx(xe,{size:18})})]})})]},d.id))})]})})})}function Le(){const{t:y}=O(),[w,z]=x.useState([]),[m,r]=x.useState(!0),[p,b]=x.useState(""),[N,F]=x.useState("all"),[$,d]=x.useState(!1),[C,R]=x.useState(null),S=async()=>{r(!0);let g=_.from("restaurants").select("*").order("created_at",{ascending:!1});N!=="all"&&(g=g.eq("status",N));const{data:f,error:E}=await g;!E&&f&&z(f),r(!1)};x.useEffect(()=>{S()},[N]);const k=async g=>{if(!confirm("Are you sure you want to delete this restaurant?"))return;const{error:f}=await _.from("restaurants").delete().eq("id",g);f||(v.success("Restaurant deleted successfully"),S())},L=async(g,f)=>{const{error:E}=await _.from("restaurants").update({status:f}).eq("id",g);E||(v.success(`Restaurant ${f} successfully`),v.success(y(f==="approved"?"admin.restaurants.actions.approveSuccess":"admin.restaurants.actions.rejectSuccess")),S())},T=w.filter(g=>g.name.toLowerCase().includes(p.toLowerCase())||g.name_zh?.toLowerCase().includes(p.toLowerCase()));return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-neutral-900",children:y("admin.restaurants.title")}),e.jsx("p",{className:"text-neutral-500 mt-1",children:y("admin.restaurants.subtitle")})]}),e.jsxs("button",{className:"inline-flex items-center gap-2 px-4 py-2 bg-primary-500 hover:bg-primary-600 text-white font-medium rounded-xl transition-colors",onClick:()=>{R(null),d(!0)},children:[e.jsx(he,{size:20}),y("admin.restaurants.addRestaurant")]})]}),e.jsx(je,{searchQuery:p,setSearchQuery:b,filterStatus:N,setFilterStatus:F}),e.jsx(ve,{restaurants:T,isLoading:m,onStatusUpdate:L,onEdit:g=>{R(g),d(!0)},onDelete:k}),e.jsx(be,{isOpen:$,onClose:()=>d(!1),onSave:()=>{S(),d(!1)},restaurant:C})]})}export{Le as AdminRestaurants};
