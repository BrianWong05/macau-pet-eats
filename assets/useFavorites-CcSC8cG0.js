import{r as i}from"./react-vendor-7d_4YsRm.js";import{s as n,a as v}from"./index-Bsb3DvyY.js";async function _(t){const{data:{user:e}}=await n.auth.getUser();if(!e)throw new Error("User not authenticated");const{error:r}=await n.from("favorites").insert({user_id:e.id,restaurant_id:t});if(r){if(r.code==="23505")return!0;throw console.error("Error adding favorite:",r),r}return!0}async function h(t){const{data:{user:e}}=await n.auth.getUser();if(!e)throw new Error("User not authenticated");const{error:r}=await n.from("favorites").delete().eq("user_id",e.id).eq("restaurant_id",t);if(r)throw console.error("Error removing favorite:",r),r;return!0}async function g(t,e){return e?(await h(t),!1):(await _(t),!0)}async function F(){const{data:{user:t}}=await n.auth.getUser();if(!t)return[];const{data:e,error:r}=await n.from("favorites").select(`
      user_id,
      restaurant_id,
      created_at,
      restaurant:restaurants(*)
    `).eq("user_id",t.id).order("created_at",{ascending:!1});return r?(console.error("Error fetching favorites:",r),[]):(e||[]).map(s=>({user_id:s.user_id,restaurant_id:s.restaurant_id,created_at:s.created_at,restaurant:s.restaurant}))}function m(){const{user:t}=v(),[e,r]=i.useState([]),[s,f]=i.useState(!0),u=i.useCallback(async()=>{if(!t){r([]),f(!1);return}f(!0);try{const a=await F();r(a)}catch(a){console.error("Error fetching favorites:",a)}finally{f(!1)}},[t]);i.useEffect(()=>{u()},[u]);const d=i.useCallback(a=>e.some(c=>c.restaurant_id===a),[e]),l=i.useCallback(async a=>{if(!t)throw new Error("User not authenticated");const c=d(a);r(c?o=>o.filter(w=>w.restaurant_id!==a):o=>[...o,{user_id:t.id,restaurant_id:a,created_at:new Date().toISOString()}]);try{return await g(a,c)}catch(o){throw u(),o}},[t,d,u]);return{favorites:e,isLoading:s,isFavorited:d,toggleFavorite:l,refetch:u}}export{m as u};
