import{u as g,j as e,a as w,s as x}from"./index-IO_Hw95i.js";import{r as m}from"./react-vendor-B-2HpIm1.js";import{a as N,E as _,k as S,K as k,w as E,F as R,J as h}from"./ui-vendor-r0va27WY.js";import"./supabase-K6a4hp2a.js";function L({filterStatus:n,setFilterStatus:d}){const{t:i}=g(),o=["pending","approved","rejected","all"];return e.jsx("div",{className:"flex gap-2",children:o.map(l=>e.jsx("button",{onClick:()=>d(l),className:`px-4 py-2 rounded-lg font-medium transition-colors ${n===l?"bg-primary-500 text-white":"bg-neutral-100 text-neutral-600 hover:bg-neutral-200"}`,children:i(`admin.reports.status.${l}`)},l))})}function C({reports:n,isLoading:d,processingId:i,onApprove:o,onReject:l}){const{t:s}=g(),c=t=>{switch(t){case"approved":return e.jsx(E,{className:"w-5 h-5 text-green-500"});case"rejected":return e.jsx(k,{className:"w-5 h-5 text-red-500"});default:return e.jsx(S,{className:"w-5 h-5 text-amber-500"})}},f=t=>({pet_policy:s("restaurant.reportModal.fields.pet_policy"),contact_info:s("restaurant.reportModal.fields.contact_info"),address:s("restaurant.reportModal.fields.address"),cuisine_type:s("restaurant.reportModal.fields.cuisine_type"),other:s("restaurant.reportModal.fields.other")})[t]||t;return d?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(N,{className:"w-8 h-8 animate-spin text-primary-500"})}):n.length===0?e.jsx("div",{className:"text-center py-12 text-neutral-500",children:s("admin.reports.empty")}):e.jsx("div",{className:"space-y-4",children:n.map(t=>e.jsx("div",{className:"bg-white rounded-xl shadow-card p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c(t.status),e.jsx("span",{className:"font-semibold text-neutral-900",children:t.restaurant?.name_zh||t.restaurant?.name||"Unknown"}),e.jsx("a",{href:`/#/restaurants/${t.restaurant_id}`,target:"_blank",rel:"noopener noreferrer",className:"text-primary-500 hover:text-primary-600",children:e.jsx(_,{size:16})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-neutral-500",children:[s("admin.reports.fieldLabel"),":"]}),e.jsx("span",{className:"ml-2 font-medium",children:f(t.field_name)})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-neutral-500",children:[s("admin.reports.suggestedValue"),":"]}),e.jsx("span",{className:"ml-2 font-medium text-primary-600",children:t.suggested_value})]})]}),t.reason&&e.jsx("p",{className:"mt-2 text-sm text-neutral-600 bg-neutral-50 p-2 rounded-lg",children:t.reason}),e.jsx("p",{className:"mt-2 text-xs text-neutral-400",children:new Date(t.created_at).toLocaleString()})]}),t.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>o(t),disabled:i===t.id,className:"px-4 py-2 bg-green-500 hover:bg-green-600 disabled:bg-neutral-300 text-white rounded-lg font-medium transition-colors",children:i===t.id?"...":s("admin.reports.approve")}),e.jsx("button",{onClick:()=>l(t.id),disabled:i===t.id,className:"px-4 py-2 bg-red-500 hover:bg-red-600 disabled:bg-neutral-300 text-white rounded-lg font-medium transition-colors",children:i===t.id?"...":s("admin.reports.reject")})]})]})},t.id))})}function D(){const{t:n}=g(),{user:d}=w(),[i,o]=m.useState([]),[l,s]=m.useState(!0),[c,f]=m.useState("pending"),[t,u]=m.useState(null),j=async()=>{s(!0);let a=x.from("restaurant_reports").select(`
        *,
        restaurant:restaurants(id, name, name_zh)
      `).order("created_at",{ascending:!1});c!=="all"&&(a=a.eq("status",c));const{data:r,error:p}=await a;!p&&r&&o(r),s(!1)};m.useEffect(()=>{j()},[c]);const b=async a=>{u(a.id);try{const r={};r[a.field_name]=a.suggested_value;const{error:p}=await x.from("restaurants").update(r).eq("id",a.restaurant_id);if(p)throw p;const{error:v}=await x.from("restaurant_reports").update({status:"approved",reviewed_at:new Date().toISOString(),reviewed_by:d?.id}).eq("id",a.id);if(v)throw v;h.success(n("admin.reports.approveSuccess")),j()}catch(r){console.error("Approve error:",r),h.error(n("admin.reports.approveError"))}finally{u(null)}},y=async a=>{u(a);try{const{error:r}=await x.from("restaurant_reports").update({status:"rejected",reviewed_at:new Date().toISOString(),reviewed_by:d?.id}).eq("id",a);if(r)throw r;h.success(n("admin.reports.rejectSuccess")),j()}catch(r){console.error("Reject error:",r),h.error(n("admin.reports.rejectError"))}finally{u(null)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h1",{className:"text-2xl font-bold text-neutral-900 flex items-center gap-3",children:[e.jsx(R,{className:"text-primary-500"}),n("admin.reports.title")]})}),e.jsx(L,{filterStatus:c,setFilterStatus:f}),e.jsx(C,{reports:i,isLoading:l,processingId:t,onApprove:b,onReject:y})]})}export{D as AdminReports};
