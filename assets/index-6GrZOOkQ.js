import{u as O,j as e,s as N,b as ae}from"./index-D0_Up7zE.js";import{r as x}from"./react-vendor-B-2HpIm1.js";import{X as D,k as q,g as ne,B as le,c as H,l as ie,a as oe,J as j,d as ce,w as V,K as Z,O as de,q as ue,Q as me}from"./ui-vendor-r0va27WY.js";import{g as pe,e as xe}from"./mapUtils-Dr1D9bNV.js";import"./supabase-K6a4hp2a.js";const K=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],he=["indoors_allowed","patio_only","small_pets_only","all_pets_welcome","dogs_only","cats_only"];function ge({isOpen:f,onClose:_,onSave:k,restaurant:m}){const{t:n,i18n:p}=O(),[y,v]=x.useState(!1),[E,F]=x.useState(null),[c,w]=x.useState(""),[L,z]=x.useState([]),[C,S]=x.useState([]),P=x.useRef(null),[g,b]=x.useState([]),[I,R]=x.useState([]),[W,B]=x.useState(""),T=x.useRef(null);x.useEffect(()=>{(async()=>{const{data:t}=await N.from("cuisine_types").select("*").order("sort_order",{ascending:!0});t&&z(t)})()},[]);const X=s=>{w(s);const t=xe(s);t?(d(l=>({...l,latitude:t.lat,longitude:t.lng,google_maps_url:s})),j.success("Location extracted from URL!")):s&&d(l=>({...l,google_maps_url:s}))},[a,d]=x.useState({name:"",name_zh:"",name_pt:"",address:"",address_zh:"",address_pt:"",description:"",description_zh:"",description_pt:"",pet_policy:"patio_only",cuisine_type:[],contact_info:"",image_url:"",gallery_images:[],menu_images:[],latitude:22.1937,longitude:113.5399,status:"approved"});x.useEffect(()=>{if(m){if(d(m),w(m.google_maps_url||""),m.cuisine_type&&m.cuisine_type.length>0&&L.length>0){const t=L.map(r=>r.name),l=m.cuisine_type.find(r=>!t.includes(r)&&r!=="Other");if(l){const r=m.cuisine_type.map(i=>i===l?"Other":i);d(i=>({...i,cuisine_type:r,cuisine_type_other:l}))}}let s=[];m.gallery_images&&m.gallery_images.length>0?s=m.gallery_images.map((t,l)=>({id:`existing-${l}-${Date.now()}`,preview:t,url:t})):m.image_url&&(s=[{id:`legacy-${Date.now()}`,preview:m.image_url,url:m.image_url}]),S(s),R(m.menu_images||[])}else d({name:"",name_zh:"",name_pt:"",address:"",address_zh:"",address_pt:"",description:"",description_zh:"",description_pt:"",pet_policy:"patio_only",cuisine_type:[],contact_info:"",image_url:"",gallery_images:[],menu_images:[],latitude:22.1937,longitude:113.5399,status:"approved"}),S([]),R([]);b([])},[m,f]);const G=s=>{const t=Array.from(s.target.files||[]);if(t.length>0){const l=t.filter(r=>r.size>5242880?(j.error(`Image ${r.name} is too large (max 5MB)`),!1):!0);l.length>0&&l.forEach(r=>{const i=new FileReader;i.onloadend=()=>{S(o=>[...o,{id:`new-${Math.random().toString(36).substr(2,9)}`,preview:i.result,file:r}])},i.readAsDataURL(r)})}P.current&&(P.current.value="")},J=s=>{S(t=>t.filter(l=>l.id!==s))},Q=(s,t)=>{if(t==="left"&&s===0||t==="right"&&s===C.length-1)return;const l=[...C],r=t==="left"?s-1:s+1,i=l[s];l[s]=l[r],l[r]=i,S(l)},Y=s=>{if(s===0)return;const t=[...C],l=t.splice(s,1)[0];t.unshift(l),S(t)},ee=s=>{const t=Array.from(s.target.files||[]);if(t.length>0){const l=t.filter(r=>r.type.startsWith("image/")||r.type==="application/pdf"?r.size>5242880?(j.error(`File ${r.name} is too large (max 5MB)`),!1):!0:(j.error(`File ${r.name} is not a supported format (images or PDF)`),!1));if(l.length===0)return;b(r=>[...r,...l]),l.forEach(r=>{if(r.type==="application/pdf")R(i=>[...i,"PDF:"+r.name]);else{const i=new FileReader;i.onloadend=()=>{R(o=>[...o,i.result])},i.readAsDataURL(r)}})}},se=s=>{const t=(a.menu_images||[]).length;if(s<t){const l=[...a.menu_images||[]];l.splice(s,1),d(r=>({...r,menu_images:l})),R(r=>r.filter((i,o)=>o!==s))}else{const l=s-t;b(r=>r.filter((i,o)=>o!==l)),R(r=>r.filter((i,o)=>o!==s))}T.current&&(T.current.value="")},te=()=>{const s=W.trim();if(!s)return;if(!s.startsWith("http://")&&!s.startsWith("https://")){j.error("Please enter a valid URL starting with http:// or https://");return}const t=[...a.menu_images||[],s];d(l=>({...l,menu_images:t})),R(l=>[...l,s]),B("")},re=async s=>{s.preventDefault(),v(!0),F(null);try{if(!a.cuisine_type||a.cuisine_type.length===0){j.error(n("submit.form.selectAtLeastOne")||"Please select at least one cuisine type"),v(!1);return}const t=[];for(const u of C)if(u.url)t.push(u.url);else if(u.file){const $=u.file.name.split(".").pop(),h=`${`${Math.random().toString(36).substring(2)}_${Date.now()}.${$}`}`,{error:U}=await N.storage.from("restaurants").upload(h,u.file);if(U)throw new Error(`Image upload failed: ${U.message}`);const{data:{publicUrl:A}}=N.storage.from("restaurants").getPublicUrl(h);t.push(A)}let l=t.length>0?t[0]:"";const r=[];if(g.length>0)for(const u of g){const $=u.name.split(".").pop(),h=`${`menu_${Math.random().toString(36).substring(2)}_${Date.now()}.${$}`}`,{error:U}=await N.storage.from("restaurants").upload(h,u);if(U)throw new Error(`Menu upload failed: ${U.message}`);const{data:{publicUrl:A}}=N.storage.from("restaurants").getPublicUrl(h);r.push(A)}const i=[...a.menu_images||[],...r],o={...a,gallery_images:t,menu_images:i,image_url:l};if(delete o.cuisine_type_other,a.cuisine_type&&Array.isArray(a.cuisine_type)){const u=$=>a.cuisine_type.map(M=>M==="Other"?a.cuisine_type_other||"Other":p.getFixedT($)(`cuisineTypes.${M.toLowerCase()}`));if(o.cuisine_type_zh=u("zh"),o.cuisine_type_pt=u("pt"),o.cuisine_type?.includes("Other")&&a.cuisine_type_other){const $=a.cuisine_type_other;o.cuisine_type=o.cuisine_type.map(h=>h==="Other"?$:h);const M=a.cuisine_type_other;M&&(o.cuisine_type_zh=o.cuisine_type_zh.map(h=>h==="其他"||h==="Other"?M:h),o.cuisine_type_pt=o.cuisine_type_pt.map(h=>h==="Outros"||h==="Other"?M:h))}}if(m?.id){const{error:u}=await N.from("restaurants").update(o).eq("id",m.id);if(u)throw u}else{const{error:u}=await N.from("restaurants").insert(o);if(u)throw u}k(),_(),j.success(m?"Restaurant updated successfully":"Restaurant created successfully")}catch(t){console.error("Submission error:",t);const l=t instanceof Error?t.message:"An error occurred";F(l),j.error(l)}finally{v(!1)}};return f?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-neutral-100 p-6 flex items-center justify-between z-10",children:[e.jsx("h2",{className:"text-xl font-bold text-neutral-900",children:m?"Edit Restaurant":"Add Restaurant"}),e.jsx("button",{onClick:_,className:"p-2 text-neutral-400 hover:bg-neutral-100 rounded-lg transition-colors",children:e.jsx(D,{size:20})})]}),e.jsxs("form",{onSubmit:re,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-neutral-700",children:[n("admin.modal.labels.nameEn")," *"]}),e.jsx("input",{type:"text",required:!0,value:a.name||"",onChange:s=>d(t=>({...t,name:s.target.value})),className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-neutral-700",children:n("admin.modal.labels.nameZh")}),e.jsx("input",{type:"text",value:a.name_zh||"",onChange:s=>d(t=>({...t,name_zh:s.target.value})),className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-neutral-700",children:n("admin.modal.labels.namePt")}),e.jsx("input",{type:"text",value:a.name_pt||"",onChange:s=>d(t=>({...t,name_pt:s.target.value})),className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-primary-500"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-neutral-700",children:[n("admin.modal.labels.cuisineType")," *"]}),e.jsxs("div",{className:"grid grid-cols-2 xs:grid-cols-3 gap-2",children:[L.filter(s=>s.name!=="Other").map(s=>{const t=p.language==="zh"?s.name_zh||s.name:p.language==="pt"&&s.name_pt||s.name,r=(a.cuisine_type||[]).includes(s.name);return e.jsx("button",{type:"button",onClick:()=>{const i=a.cuisine_type||[],o=i.includes(s.name)?i.filter(u=>u!==s.name):[...i,s.name];d(u=>({...u,cuisine_type:o}))},className:`
                          px-2 py-1.5 rounded-lg text-xs font-medium transition-all border text-center truncate
                          ${r?"bg-primary-500 text-white border-primary-500 shadow-sm":"bg-white text-neutral-600 border-neutral-200 hover:border-primary-300 hover:bg-neutral-50"}
                        `,children:t},s.id)}),e.jsx("button",{type:"button",onClick:()=>{const s=a.cuisine_type||[],t=s.includes("Other")?s.filter(l=>l!=="Other"):[...s,"Other"];d(l=>({...l,cuisine_type:t}))},className:`
                      px-2 py-1.5 rounded-lg text-xs font-medium transition-all border text-center truncate
                      ${(a.cuisine_type||[]).includes("Other")?"bg-primary-500 text-white border-primary-500 shadow-sm":"bg-white text-neutral-600 border-neutral-200 hover:border-primary-300 hover:bg-neutral-50"}
                    `,children:n("common.other")||"Other"})]}),(a.cuisine_type||[]).includes("Other")&&e.jsx("input",{type:"text",required:!0,value:a.cuisine_type_other||"",onChange:s=>d(t=>({...t,cuisine_type_other:s.target.value})),placeholder:n("submit.form.otherCuisinePlaceholder")||"Please specify",className:"w-full mt-2 px-4 py-2 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-neutral-700",children:[n("admin.modal.labels.petPolicy")," *"]}),e.jsx("select",{required:!0,value:a.pet_policy||"patio_only",onChange:s=>d(t=>({...t,pet_policy:s.target.value})),className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-primary-500",children:he.map(s=>e.jsx("option",{value:s,children:n(`petPolicy.${s}`)},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-neutral-700",children:n("admin.modal.labels.status")}),e.jsxs("select",{value:a.status||"pending",onChange:s=>d(t=>({...t,status:s.target.value})),className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"pending",children:n("admin.restaurants.status.pending")}),e.jsx("option",{value:"approved",children:n("admin.restaurants.status.approved")}),e.jsx("option",{value:"rejected",children:n("admin.restaurants.status.rejected")})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-neutral-700",children:[n("admin.modal.labels.descriptionEn")," *"]}),e.jsx("textarea",{required:!0,rows:3,value:a.description||"",onChange:s=>d(t=>({...t,description:s.target.value})),className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-primary-500",placeholder:n("admin.modal.placeholders.description")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-neutral-700",children:n("admin.modal.labels.descriptionZh")}),e.jsx("textarea",{rows:3,value:a.description_zh||"",onChange:s=>d(t=>({...t,description_zh:s.target.value})),className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-primary-500",placeholder:n("admin.modal.placeholders.description")+" (中文)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-neutral-700",children:n("admin.modal.labels.descriptionPt")}),e.jsx("textarea",{rows:3,value:a.description_pt||"",onChange:s=>d(t=>({...t,description_pt:s.target.value})),className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-primary-500",placeholder:n("admin.modal.placeholders.description")+" (葡文)"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-neutral-700",children:[n("admin.modal.labels.addressEn")," *"]}),e.jsx("input",{type:"text",required:!0,value:a.address||"",onChange:s=>d(t=>({...t,address:s.target.value})),className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-primary-500",placeholder:n("admin.modal.placeholders.address")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-neutral-700",children:n("admin.modal.labels.addressZh")}),e.jsx("input",{type:"text",value:a.address_zh||"",onChange:s=>d(t=>({...t,address_zh:s.target.value})),className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-primary-500",placeholder:n("admin.modal.placeholders.address")+" (中文)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-neutral-700",children:n("admin.modal.labels.addressPt")}),e.jsx("input",{type:"text",value:a.address_pt||"",onChange:s=>d(t=>({...t,address_pt:s.target.value})),className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-primary-500",placeholder:n("admin.modal.placeholders.address")+" (葡文)"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-neutral-700",children:n("admin.modal.labels.contactInfo")}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-neutral-500 font-medium",children:"+853"})}),e.jsx("input",{type:"text",value:a.contact_info?.replace(/^\+853\s?/,"")||"",onChange:s=>{const t=s.target.value.replace(/^\+853\s?/,"");d(l=>({...l,contact_info:`+853 ${t}`}))},className:"w-full pl-16 pr-4 py-2 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-primary-500",placeholder:"6666 6666"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium text-neutral-700",children:n("restaurant.socialMedia.title")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-neutral-500",children:n("restaurant.socialMedia.facebook")}),e.jsx("input",{type:"url",value:a.social_media?.facebook||"",onChange:s=>d(t=>({...t,social_media:{...t.social_media||{},facebook:s.target.value||void 0}})),className:"w-full px-3 py-2 border border-neutral-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-500",placeholder:"https://facebook.com/..."})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-neutral-500",children:n("restaurant.socialMedia.instagram")}),e.jsx("input",{type:"url",value:a.social_media?.instagram||"",onChange:s=>d(t=>({...t,social_media:{...t.social_media||{},instagram:s.target.value||void 0}})),className:"w-full px-3 py-2 border border-neutral-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-500",placeholder:"https://instagram.com/..."})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-neutral-500",children:n("restaurant.socialMedia.website")}),e.jsx("input",{type:"url",value:a.social_media?.website||"",onChange:s=>d(t=>({...t,social_media:{...t.social_media||{},website:s.target.value||void 0}})),className:"w-full px-3 py-2 border border-neutral-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-500",placeholder:"https://..."})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"text-sm font-medium text-neutral-700 flex items-center gap-2",children:[e.jsx(q,{size:16,className:"text-primary-500"}),n("openingHours.title")]}),e.jsx("div",{className:"space-y-2",children:K.map(s=>{const t=a.opening_hours?.[s],l=t!=null;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-24 text-sm text-neutral-600",children:n(`openingHours.days.${s}`)}),e.jsx("label",{className:"flex items-center gap-2",children:e.jsx("input",{type:"checkbox",checked:l,onChange:r=>{const i={...a.opening_hours||{}};r.target.checked?i[s]={open:"09:00",close:"22:00"}:i[s]=null,d(o=>({...o,opening_hours:i}))},className:"rounded border-neutral-300 text-primary-500 focus:ring-primary-500"})}),l?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"time",value:t?.open||"09:00",onChange:r=>{const i={...a.opening_hours||{}};i[s]={...i[s]||{},open:r.target.value},d(o=>({...o,opening_hours:i}))},className:"px-2 py-1 text-sm border border-neutral-200 rounded-lg focus:ring-2 focus:ring-primary-500"}),e.jsx("span",{className:"text-neutral-400",children:"-"}),e.jsx("input",{type:"time",value:t?.close||"22:00",onChange:r=>{const i={...a.opening_hours||{}};i[s]={...i[s]||{},close:r.target.value},d(o=>({...o,opening_hours:i}))},className:"px-2 py-1 text-sm border border-neutral-200 rounded-lg focus:ring-2 focus:ring-primary-500"}),e.jsxs("div",{className:"flex gap-1 ml-2",children:[e.jsx("button",{type:"button",onClick:()=>{const r=a.opening_hours?.[s];if(!r)return;const i=["monday","tuesday","wednesday","thursday","friday"],o={...a.opening_hours||{}};i.forEach(u=>{o[u]={...r}}),d(u=>({...u,opening_hours:o}))},className:"px-2 py-0.5 text-xs bg-neutral-100 hover:bg-neutral-200 text-neutral-600 rounded transition-colors",children:n("openingHours.applyToWeekdays")}),e.jsx("button",{type:"button",onClick:()=>{const r=a.opening_hours?.[s];if(!r)return;const i=["saturday","sunday"],o={...a.opening_hours||{}};i.forEach(u=>{o[u]={...r}}),d(u=>({...u,opening_hours:o}))},className:"px-2 py-0.5 text-xs bg-neutral-100 hover:bg-neutral-200 text-neutral-600 rounded transition-colors",children:n("openingHours.applyToWeekend")}),e.jsx("button",{type:"button",onClick:()=>{const r=a.opening_hours?.[s];if(!r)return;const i={...a.opening_hours||{}};K.forEach(o=>{i[o]={...r}}),d(o=>({...o,opening_hours:i}))},className:"px-2 py-0.5 text-xs bg-primary-100 hover:bg-primary-200 text-primary-600 rounded transition-colors",children:n("openingHours.applyToAll")})]})]}):e.jsx("span",{className:"text-sm text-neutral-400",children:n("openingHours.closed")})]},s)})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"text-sm font-medium text-neutral-700 flex items-center gap-2",children:[e.jsx(ne,{size:16,className:"text-primary-500"}),n("admin.modal.labels.location")," *"]}),e.jsxs("span",{className:"text-xs text-neutral-500",children:[a.latitude?.toFixed(6),", ",a.longitude?.toFixed(6)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(le,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400"}),e.jsx("input",{type:"text",value:c,onChange:s=>X(s.target.value),placeholder:"Paste Google Maps URL here...",className:"w-full pl-10 pr-4 py-2 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("p",{className:"text-xs text-neutral-500",children:["1. Search the restaurant on ",e.jsx("a",{href:"https://maps.google.com",target:"_blank",rel:"noopener noreferrer",className:"text-primary-600 hover:underline",children:"Google Maps"})," ","2. Copy the URL from your browser 3. Paste it above"]})]}),!c&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-neutral-500",children:"Latitude"}),e.jsx("input",{type:"number",step:"any",value:a.latitude||"",onChange:s=>d(t=>({...t,latitude:parseFloat(s.target.value)})),className:"w-full px-3 py-2 border border-neutral-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-neutral-500",children:"Longitude"}),e.jsx("input",{type:"number",step:"any",value:a.longitude||"",onChange:s=>d(t=>({...t,longitude:parseFloat(s.target.value)})),className:"w-full px-3 py-2 border border-neutral-200 rounded-lg text-sm focus:ring-2 focus:ring-primary-500"})]})]}),e.jsx("div",{className:"h-64 rounded-xl overflow-hidden border border-neutral-200",children:e.jsx("iframe",{title:"Location preview",width:"100%",height:"100%",style:{border:0},loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",src:pe(c,a.latitude||22.1937,a.longitude||113.5399,a.name,p.language)})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-neutral-700",children:n("admin.modal.labels.imageUrl")}),e.jsxs("div",{className:"grid grid-cols-2 xs:grid-cols-3 md:grid-cols-4 gap-4",children:[C.map((s,t)=>e.jsxs("div",{className:"relative aspect-square group",children:[e.jsx("img",{src:s.preview,alt:`Preview ${t+1}`,className:`w-full h-full object-cover rounded-xl transition-all ${t===0?"ring-4 ring-primary-500":""}`}),t===0&&e.jsx("div",{className:"absolute top-2 left-2 px-2 py-1 bg-primary-500 text-white text-xs font-bold rounded-md shadow-sm",children:"Cover"}),e.jsxs("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity rounded-xl flex items-center justify-center gap-2",children:[t>0&&e.jsx("button",{type:"button",onClick:()=>Q(t,"left"),className:"p-1.5 bg-white/20 hover:bg-white text-white hover:text-neutral-900 rounded-full backdrop-blur-sm transition-all",title:"Move Left",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"m15 18-6-6 6-6"})})}),t<C.length-1&&e.jsx("button",{type:"button",onClick:()=>Q(t,"right"),className:"p-1.5 bg-white/20 hover:bg-white text-white hover:text-neutral-900 rounded-full backdrop-blur-sm transition-all",title:"Move Right",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"m9 18 6-6-6-6"})})}),t!==0&&e.jsx("button",{type:"button",onClick:()=>Y(t),className:"p-1.5 bg-primary-500 hover:bg-primary-600 text-white rounded-full transition-all",title:"Make Cover",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})})}),e.jsx("button",{type:"button",onClick:()=>J(s.id),className:"p-1.5 bg-red-500 hover:bg-red-600 text-white rounded-full transition-all",title:"Remove",children:e.jsx(D,{size:16})})]})]},s.id)),e.jsxs("div",{onClick:()=>P.current?.click(),className:`
                  border-2 border-dashed border-neutral-300
                  rounded-xl aspect-square
                  flex flex-col items-center justify-center
                  cursor-pointer
                  hover:border-primary-400 hover:bg-primary-50
                  transition-all
                `,children:[e.jsx("div",{className:"p-2 bg-neutral-100 rounded-full mb-2",children:e.jsx(H,{size:20,className:"text-neutral-400"})}),e.jsx("span",{className:"text-xs font-medium text-neutral-600 text-center px-2",children:C.length===0?"Upload Photos":"Add More"})]})]}),e.jsx("input",{ref:P,type:"file",accept:"image/*",multiple:!0,onChange:G,className:"hidden"}),e.jsx("input",{ref:P,type:"file",accept:"image/*",multiple:!0,onChange:G,className:"hidden"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-neutral-700",children:n("restaurant.menu")}),I.length>0?e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[I.map((s,t)=>e.jsxs("div",{className:"relative group",children:[s.startsWith("PDF:")||s.endsWith(".pdf")?e.jsxs("div",{className:"w-full h-32 rounded-xl border border-neutral-200 bg-neutral-50 flex flex-col items-center justify-center",children:[e.jsx(ie,{size:32,className:"text-red-500 mb-2"}),e.jsx("span",{className:"text-xs text-neutral-600 truncate max-w-full px-2",children:s.startsWith("PDF:")?s.slice(4):"PDF Menu"})]}):e.jsx("img",{src:s,alt:`Menu ${t}`,className:"w-full h-32 object-cover rounded-xl border border-neutral-200"}),e.jsx("button",{type:"button",onClick:()=>se(t),className:"absolute top-2 right-2 p-1.5 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity shadow-lg",children:e.jsx(D,{size:14})})]},t)),e.jsxs("div",{onClick:()=>T.current?.click(),className:`
                    h-32 border-2 border-dashed border-neutral-300
                    rounded-xl flex flex-col items-center justify-center
                    cursor-pointer hover:border-primary-400 hover:bg-primary-50
                    transition-all
                  `,children:[e.jsx(H,{size:20,className:"text-neutral-400 mb-2"}),e.jsx("span",{className:"text-sm text-neutral-500",children:"Add More"})]})]}):e.jsx("div",{onClick:()=>T.current?.click(),className:`
                  border-2 border-dashed border-neutral-300
                  rounded-xl p-6
                  text-center cursor-pointer
                  hover:border-primary-400 hover:bg-primary-50
                  transition-all
                `,children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(H,{size:24,className:"text-neutral-400"}),e.jsx("p",{className:"text-sm text-neutral-600",children:"Upload menu images"})]})}),e.jsx("input",{ref:T,type:"file",accept:"image/*,.pdf,application/pdf",multiple:!0,onChange:ee,className:"hidden"}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx("input",{type:"url",value:W,onChange:s=>B(s.target.value),placeholder:"Enter PDF or image URL (e.g., https://...)",className:"flex-1 px-4 py-2 border-2 border-neutral-200 rounded-xl focus:border-primary-400 focus:ring-4 focus:ring-primary-100 focus:outline-none transition-all text-sm"}),e.jsx("button",{type:"button",onClick:te,className:"px-4 py-2 bg-primary-500 text-white rounded-xl hover:bg-primary-600 transition-colors text-sm font-medium",children:"Add Link"})]})]}),E&&e.jsx("div",{className:"p-4 bg-red-50 text-red-600 rounded-xl text-sm",children:E}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:_,className:"px-6 py-2 text-neutral-600 font-medium hover:bg-neutral-50 rounded-xl transition-colors",children:n("admin.modal.buttons.cancel")}),e.jsxs("button",{type:"submit",disabled:y,className:"px-6 py-2 bg-primary-500 hover:bg-primary-600 disabled:bg-primary-300 text-white font-medium rounded-xl transition-colors flex items-center gap-2",children:[y&&e.jsx(oe,{size:18,className:"animate-spin"}),n(m?"admin.modal.buttons.save":"admin.modal.buttons.create")]})]})]})]})}):null}function fe({searchQuery:f,setSearchQuery:_,filterStatus:k,setFilterStatus:m}){const{t:n}=O(),p=["all","pending","approved"];return e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:n("admin.restaurants.searchPlaceholder"),value:f,onChange:y=>_(y.target.value),className:"w-full pl-10 pr-4 py-2 bg-white border border-neutral-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsx("div",{className:"flex gap-2",children:p.map(y=>e.jsx("button",{onClick:()=>m(y),className:`px-4 py-2 rounded-xl text-sm font-medium transition-colors ${k===y?"bg-neutral-900 text-white":"bg-white border border-neutral-200 text-neutral-600 hover:bg-neutral-50"}`,children:n(`admin.restaurants.filters.${y}`)},y))})]})}function ye({restaurants:f,isLoading:_,onStatusUpdate:k,onEdit:m,onDelete:n}){const{t:p,i18n:y}=O(),{getLocalizedName:v}=ae(),E=y.language,F=({status:c})=>{const w={approved:"bg-green-100 text-green-700",pending:"bg-amber-100 text-amber-700",rejected:"bg-red-100 text-red-700"},z={approved:V,pending:q,rejected:Z}[c]||q;return e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-medium ${w[c]||w.pending}`,children:[e.jsx(z,{size:12}),c==="pending"?p("admin.restaurants.status.pending"):c==="approved"?p("admin.restaurants.status.approved"):c==="rejected"?p("admin.restaurants.status.rejected"):c]})};return e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-neutral-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-neutral-50 border-b border-neutral-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-neutral-500 uppercase tracking-wider",children:p("admin.restaurants.table.headers.restaurant")}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-neutral-500 uppercase tracking-wider",children:p("admin.restaurants.table.headers.status")}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-neutral-500 uppercase tracking-wider",children:p("admin.restaurants.table.headers.petPolicy")}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-neutral-500 uppercase tracking-wider",children:p("admin.restaurants.table.headers.submitted")}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-neutral-500 uppercase tracking-wider",children:p("admin.restaurants.table.headers.actions")})]})}),e.jsx("tbody",{className:"divide-y divide-neutral-200",children:_?[1,2,3].map(c=>e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-neutral-100 rounded w-3/4 animate-pulse"})})},c)):f.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-12 text-center text-neutral-500",children:p("admin.restaurants.table.noRestaurants")})}):f.map(c=>e.jsxs("tr",{className:"hover:bg-neutral-50/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:c.image_url||"https://via.placeholder.com/40",alt:"",className:"w-10 h-10 rounded-lg object-cover bg-neutral-100"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-neutral-900",children:c.name_zh||c.name}),e.jsx("p",{className:"text-sm text-neutral-500",children:Array.isArray(c.cuisine_type)?c.cuisine_type.map(w=>v(w,E)).join(", "):c.cuisine_type})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(F,{status:c.status||"approved"})}),e.jsx("td",{className:"px-6 py-4 text-sm text-neutral-600",children:p(`petPolicy.${c.pet_policy}`)}),e.jsx("td",{className:"px-6 py-4 text-sm text-neutral-600",children:new Date(c.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[c.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>k(c.id,"approved"),className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Approve",children:e.jsx(V,{size:18})}),e.jsx("button",{onClick:()=>k(c.id,"rejected"),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Reject",children:e.jsx(Z,{size:18})}),e.jsx("div",{className:"w-px h-4 bg-neutral-200 mx-1"})]}),e.jsx("button",{className:"p-2 text-neutral-400 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors",onClick:()=>m(c),children:e.jsx(de,{size:18})}),e.jsx("button",{className:"p-2 text-neutral-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",onClick:()=>n(c.id),children:e.jsx(ue,{size:18})})]})})]},c.id))})]})})})}function we(){const{t:f}=O(),[_,k]=x.useState([]),[m,n]=x.useState(!0),[p,y]=x.useState(""),[v,E]=x.useState("all"),[F,c]=x.useState(!1),[w,L]=x.useState(null),z=async()=>{n(!0);let g=N.from("restaurants").select("*").order("created_at",{ascending:!1});v!=="all"&&(g=g.eq("status",v));const{data:b,error:I}=await g;!I&&b&&k(b),n(!1)};x.useEffect(()=>{z()},[v]);const C=async g=>{if(!confirm("Are you sure you want to delete this restaurant?"))return;const{error:b}=await N.from("restaurants").delete().eq("id",g);b||(j.success("Restaurant deleted successfully"),z())},S=async(g,b)=>{const{error:I}=await N.from("restaurants").update({status:b}).eq("id",g);I||(j.success(`Restaurant ${b} successfully`),j.success(f(b==="approved"?"admin.restaurants.actions.approveSuccess":"admin.restaurants.actions.rejectSuccess")),z())},P=_.filter(g=>g.name.toLowerCase().includes(p.toLowerCase())||g.name_zh?.toLowerCase().includes(p.toLowerCase()));return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-neutral-900",children:f("admin.restaurants.title")}),e.jsx("p",{className:"text-neutral-500 mt-1",children:f("admin.restaurants.subtitle")})]}),e.jsxs("button",{className:"inline-flex items-center gap-2 px-4 py-2 bg-primary-500 hover:bg-primary-600 text-white font-medium rounded-xl transition-colors",onClick:()=>{L(null),c(!0)},children:[e.jsx(me,{size:20}),f("admin.restaurants.addRestaurant")]})]}),e.jsx(fe,{searchQuery:p,setSearchQuery:y,filterStatus:v,setFilterStatus:E}),e.jsx(ye,{restaurants:P,isLoading:m,onStatusUpdate:S,onEdit:g=>{L(g),c(!0)},onDelete:C}),e.jsx(ge,{isOpen:F,onClose:()=>c(!1),onSave:()=>{z(),c(!1)},restaurant:w})]})}export{we as AdminRestaurants};
