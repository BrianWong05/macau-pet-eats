import{u as C,a as G,j as e,c as ie,s as R}from"./index-8xtluKpC.js";import{g as ce,L as W,r as o,i as de}from"./react-vendor-7d_4YsRm.js";import{A as me}from"./index-CUP_8I3R.js";import{L as ue}from"./index-D5lAP1Eg.js";import{A as xe,h as B,L as pe,i as T,U as re,o as ae,H as he,N as fe,p as ne,F as ge,t as O,m as le,E as be,q as je,r as ve,I as we,G as Ne,s as ye,u as X,X as Y,v as Q,M as te,a as K,w as ke,x as _e,y as J,z as Re,D as se}from"./ui-vendor-uHOkKSV_.js";import{g as V,P as Ce}from"./index-DZvAOBsV.js";import{u as Se}from"./useFavorites-BWcPNBfj.js";import{g as ze,R as Me}from"./index-ZVmtaDzW.js";import{R as $e}from"./index-7KHcT_0f.js";import"./supabase-K6a4hp2a.js";function Ee({isScrolled:t,onLoginClick:r}){const{t:n}=C(["restaurant","common","profile","auth"]),{user:i,username:a,signOut:s}=G(),d=ce();return e.jsx("header",{className:`
        fixed top-0 left-0 right-0 z-50 transition-all duration-300
        ${t?"bg-white/80 backdrop-blur-md shadow-sm py-3":"bg-transparent py-4"}
      `,children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>d(-1),className:`flex items-center gap-2 px-4 py-2 rounded-full transition-all ${t?"text-neutral-600 hover:bg-neutral-100":"bg-white/20 backdrop-blur-sm text-white hover:bg-white/30"}`,children:[e.jsx(xe,{size:20}),e.jsx("span",{className:"font-medium hidden sm:block",children:n("restaurant:backToList")})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[i?e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx("span",{className:`text-sm font-medium hidden sm:block ${t?"text-neutral-700":"text-white drop-shadow-md"}`,children:a||i.email}),e.jsx(W,{to:"/profile",className:`p-2 rounded-full transition-all ${t?"bg-white shadow-sm text-neutral-600 hover:text-primary-600":"bg-white/20 backdrop-blur-sm text-white hover:bg-white/30"}`,title:n("profile:title")||"Profile",children:e.jsx(B,{size:20})}),e.jsx("button",{onClick:()=>s(),className:`p-2 rounded-full transition-all ${t?"bg-white shadow-sm text-neutral-600 hover:text-red-600":"bg-white/20 backdrop-blur-sm text-white hover:bg-white/30"}`,title:n("auth:logout")||"Logout",children:e.jsx(pe,{size:20})})]}):e.jsxs("button",{onClick:r,className:`flex items-center gap-2 px-4 py-2 rounded-full shadow-sm hover:shadow-md transition-all font-medium ${t?"bg-white text-neutral-700":"bg-white/90 backdrop-blur-sm text-neutral-700"}`,children:[e.jsx(B,{size:18}),e.jsx("span",{children:n("auth:login")||"Login"})]}),e.jsxs(W,{to:"/submit",className:`flex items-center gap-2 px-4 py-2 rounded-full shadow-sm hover:shadow-md transition-all font-medium ${t?"bg-white text-neutral-700":"bg-white/90 backdrop-blur-sm text-neutral-700"}`,children:[e.jsx(T,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:n("common:nav.submit")})]}),e.jsx("div",{className:t?"":"bg-white/20 backdrop-blur-sm rounded-lg",children:e.jsx(ue,{})})]})]})})}function Fe({restaurant:t,lang:r}){const{getLocalizedName:n}=ie(),i=V(t,"name",r),a=V(t,"cuisine_type","en");return e.jsxs("div",{className:"relative h-64 md:h-96",children:[e.jsx("img",{src:t.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=1200",alt:i,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-6 md:p-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-white mb-3 drop-shadow-lg",children:i}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-2",children:[e.jsx(Ce,{policy:t.pet_policy,size:"lg"}),a.map((s,d)=>e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-white/90 backdrop-blur-sm text-sm font-medium text-neutral-700 rounded-full",children:[e.jsx(re,{size:14}),n(s,r)]},d))]}),e.jsxs("div",{className:"mt-3 inline-flex items-center gap-2 bg-amber-400/95 backdrop-blur-sm px-4 py-2 rounded-lg shadow-lg",children:[e.jsx(ae,{className:"w-4 h-4 text-amber-900 flex-shrink-0"}),e.jsx("p",{className:"text-sm font-semibold text-amber-900",children:r==="zh"?"請致電餐廳確認寵物政策":r==="pt"?"Por favor confirme a política de animais com o restaurante":"Please confirm pet policy with the restaurant"})]})]})})]})}function Le({restaurant:t,onReportClick:r,onEditClick:n,onAuthRequired:i,isAdmin:a}){const{t:s}=C(["restaurant","common","profile"]),{user:d}=G(),{isFavorited:b,toggleFavorite:g}=Se(),j=b(t.id),v=async()=>{if(!d){i?i():O.error(s("common:loginRequired"));return}try{await g(t.id),O.success(s(j?"profile:favorites.removed":"profile:favorites.added"))}catch{O.error(s("common:error"))}},M=()=>{if(!t)return"#";const{latitude:k,longitude:$,name:F}=t;return`https://www.google.com/maps/search/?api=1&query=${k},${$}&query_place_id=${encodeURIComponent(F)}`},S=()=>t?.contact_info?`tel:${t.contact_info.replace(/\s/g,"")}`:"#";return e.jsxs("div",{className:"flex flex-wrap gap-4 mb-8",children:[e.jsxs("button",{onClick:v,className:`flex-1 min-w-[140px] inline-flex items-center justify-center gap-2 px-6 py-4 font-semibold rounded-xl shadow-soft hover:shadow-lg transition-all ${j?"bg-red-50 border-2 border-red-200 text-red-600 hover:bg-red-100":"bg-white border-2 border-neutral-200 hover:border-red-300 text-neutral-700"}`,children:[e.jsx(he,{size:20,className:j?"fill-red-500":""}),s(j?"profile:favorites.saved":"profile:favorites.save")]}),e.jsxs("a",{href:M(),target:"_blank",rel:"noopener noreferrer",className:"flex-1 min-w-[140px] inline-flex items-center justify-center gap-2 px-6 py-4 bg-primary-500 hover:bg-primary-600 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all",children:[e.jsx(fe,{size:20}),s("restaurant:getDirections")]}),t.contact_info&&e.jsxs("a",{href:S(),className:"flex-1 min-w-[140px] inline-flex items-center justify-center gap-2 px-6 py-4 bg-white border-2 border-neutral-200 hover:border-primary-300 text-neutral-700 font-semibold rounded-xl shadow-soft hover:shadow-lg transition-all",children:[e.jsx(ne,{size:20}),s("restaurant:callNow")]}),e.jsxs("button",{onClick:r,className:"flex-1 min-w-[140px] inline-flex items-center justify-center gap-2 px-6 py-4 bg-white border-2 border-neutral-200 hover:border-amber-300 text-neutral-700 font-semibold rounded-xl shadow-soft hover:shadow-lg transition-all",children:[e.jsx(ge,{size:20}),s("restaurant:reportUpdate")]}),a&&e.jsx("button",{onClick:n,className:"flex-1 min-w-[140px] inline-flex items-center justify-center gap-2 px-6 py-4 bg-neutral-800 hover:bg-neutral-900 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all",children:s("common:edit")||"Edit"})]})}function Ie({restaurant:t,lang:r}){const{t:n}=C(["restaurant","common"]),i=V(t,"description",r),a=V(t,"address",r),s=()=>{if(!t)return"#";const{latitude:b,longitude:g,name:j}=t;return`https://www.google.com/maps/search/?api=1&query=${b},${g}&query_place_id=${encodeURIComponent(j)}`},d=()=>t?.contact_info?`tel:${t.contact_info.replace(/\s/g,"")}`:"#";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-card p-6 mb-6",children:[e.jsx("p",{className:"text-lg text-neutral-700 leading-relaxed mb-4",children:i}),e.jsxs("div",{className:"flex items-start gap-2 pt-3 border-t border-neutral-100",children:[e.jsx(ae,{className:"w-4 h-4 text-neutral-400 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-xs text-neutral-500 italic",children:r==="zh"?"此描述可能由 AI 生成，請以實際為準":r==="pt"?"Esta descrição pode ser gerada por IA, por favor confirme com o local":"This description may be AI-generated, please verify with the restaurant"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"bg-white rounded-2xl shadow-card p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-primary-100 rounded-xl",children:e.jsx(le,{className:"w-6 h-6 text-primary-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-neutral-900 mb-1",children:n("restaurant:address")}),e.jsx("p",{className:"text-neutral-600 mb-3",children:a}),e.jsxs("a",{href:s(),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1.5 text-primary-600 hover:text-primary-700 font-medium text-sm",children:[n("restaurant:openInMaps"),e.jsx(be,{size:14})]})]})]})}),t.contact_info&&e.jsx("div",{className:"bg-white rounded-2xl shadow-card p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-secondary-100 rounded-xl",children:e.jsx(ne,{className:"w-6 h-6 text-secondary-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-neutral-900 mb-1",children:n("restaurant:contact")}),e.jsx("a",{href:d(),className:"text-neutral-600 hover:text-primary-600 transition-colors",children:t.contact_info})]})]})})]})]})}function Ue({restaurant:t}){const{t:r}=C(["restaurant","common"]);return!t.social_media||!Object.values(t.social_media).some(n=>n)?null:e.jsxs("div",{className:"mt-4 bg-white rounded-2xl shadow-card p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-neutral-900 mb-6 flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5 text-primary-500"}),r("restaurant:socialMedia.title")]}),e.jsxs("div",{className:"flex gap-4",children:[t.social_media.facebook&&e.jsxs("a",{href:t.social_media.facebook,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-4 py-2 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 transition-colors",children:[e.jsx(ve,{size:18}),e.jsx("span",{className:"text-sm font-medium",children:"Facebook"})]}),t.social_media.instagram&&e.jsxs("a",{href:t.social_media.instagram,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-4 py-2 bg-pink-50 text-pink-600 rounded-lg hover:bg-pink-100 transition-colors",children:[e.jsx(we,{size:18}),e.jsx("span",{className:"text-sm font-medium",children:"Instagram"})]}),t.social_media.website&&e.jsxs("a",{href:t.social_media.website,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-4 py-2 bg-neutral-100 text-neutral-700 rounded-lg hover:bg-neutral-200 transition-colors",children:[e.jsx(Ne,{size:18}),e.jsx("span",{className:"text-sm font-medium",children:r("restaurant:socialMedia.website")})]})]})]})}const Pe=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"];function De({restaurant:t}){const{t:r}=C(["restaurant","common"]);if(!t.opening_hours)return null;const n=t.opening_hours,i=[];Pe.forEach(s=>{const d=n[s]||null,b=d?`${d.open}-${d.close}`:"closed",g=i[i.length-1];(g?.hours?`${g.hours.open}-${g.hours.close}`:g?.hours===null?"closed":null)===b?g.days.push(s):i.push({days:[s],hours:d})});const a=s=>{if(s.length===1)return r(`common:openingHours.days.${s[0]}`);if(s.length===7)return r("common:openingHours.everyday")||"Every day";const d=r(`common:openingHours.days.${s[0]}`),b=r(`common:openingHours.days.${s[s.length-1]}`);return`${d.substring(0,3)} - ${b.substring(0,3)}`};return e.jsxs("div",{className:"mt-6 bg-white rounded-2xl shadow-card p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-neutral-900 mb-6 flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5 text-primary-500"}),r("common:openingHours.title")]}),e.jsx("div",{className:"space-y-2",children:i.map((s,d)=>e.jsxs("div",{className:"flex justify-between text-sm py-1 border-b border-neutral-100 last:border-0",children:[e.jsx("span",{className:"font-medium text-neutral-700",children:a(s.days)}),e.jsx("span",{className:s.hours?"text-neutral-600":"text-neutral-400",children:s.hours?`${s.hours.open} - ${s.hours.close}`:r("common:openingHours.closed")})]},d))})]})}function qe({restaurant:t}){const{t:r}=C(["restaurant","common"]),[n,i]=o.useState(null);if(!t.menu_images||t.menu_images.length===0)return null;const a=s=>s.toLowerCase().endsWith(".pdf");return e.jsxs("div",{className:"mt-6 bg-white rounded-2xl shadow-card p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-neutral-900 mb-6 flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-primary-500"}),r("restaurant:menu")]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:t.menu_images.map((s,d)=>e.jsx("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"block overflow-hidden rounded-xl border border-neutral-200 hover:shadow-lg transition-shadow",children:a(s)?e.jsxs("div",{className:"w-full h-40 bg-neutral-50 flex flex-col items-center justify-center",children:[e.jsx(X,{size:40,className:"text-red-500 mb-2"}),e.jsx("span",{className:"text-sm font-medium text-neutral-700",children:r("restaurant:viewMenu")||"View Menu"}),e.jsx("span",{className:"text-xs text-neutral-500 mt-1",children:"PDF"})]}):e.jsx("img",{src:s,alt:`Menu ${d+1}`,className:"w-full h-40 object-cover hover:scale-105 transition-transform"})},d))}),n&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-75 p-4",children:e.jsxs("div",{className:"relative max-w-3xl max-h-full overflow-auto",children:[e.jsx("button",{className:"absolute top-4 right-4 p-2 text-white hover:bg-white/10 rounded-full transition-colors",onClick:()=>i(null),"aria-label":r("common:close"),children:e.jsx(Y,{size:24})}),e.jsx("img",{src:n,alt:"Full size menu",className:"max-w-full max-h-full object-contain"})]})})]})}function Ae({restaurant:t,lang:r}){const{t:n}=C(["restaurant","common"]),i=V(t,"name",r),a=()=>ze(t.google_maps_url,t.latitude,t.longitude,t.name,r);return e.jsxs("div",{className:"mt-8 bg-white rounded-2xl shadow-card p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-neutral-900 mb-6 flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5 text-primary-500"}),n("restaurant:location")]}),e.jsx("div",{className:"aspect-video rounded-xl overflow-hidden bg-neutral-100",children:e.jsx("iframe",{title:`${i} location`,width:"100%",height:"100%",style:{border:0},loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",src:a()})})]})}function He({restaurant:t}){const{t:r}=C(["restaurant","common"]),[n,i]=o.useState(null);return!t.gallery_images||t.gallery_images.length===0?null:e.jsxs("div",{className:"mt-8 bg-white rounded-2xl shadow-card p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-neutral-900 mb-6 flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5 text-primary-500"}),r("restaurant:gallery.title")]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:t.gallery_images.map((a,s)=>e.jsxs("div",{className:"aspect-square rounded-xl overflow-hidden bg-neutral-100 group relative",children:[e.jsx("img",{src:a,alt:`Restaurant photo ${s+1}`,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110 cursor-pointer",onClick:()=>i(a)}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors pointer-events-none"})]},s))}),n&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-90 p-4",onClick:()=>i(null),children:[e.jsx("button",{className:"absolute top-4 right-4 p-2 text-white hover:bg-white/10 rounded-full transition-colors",onClick:()=>i(null),"aria-label":r("common:close"),children:e.jsx(Y,{size:32})}),e.jsx("img",{src:n,alt:"Full size view",className:"max-w-full max-h-full object-contain",onClick:a=>a.stopPropagation()})]})]})}function Te({restaurantId:t}){const{user:r}=G(),[n,i]=o.useState([]),[a,s]=o.useState(null),[d,b]=o.useState(!0),[g,j]=o.useState(null),v=o.useCallback(async()=>{b(!0),j(null);try{const{data:p,error:m}=await R.from("reviews").select("*, users:profiles(name, avatar_url)").eq("restaurant_id",t).order("created_at",{ascending:!1});if(m)throw m;const h=(p||[]).filter(u=>!u.is_hidden||r&&u.user_id===r.id);i(h);const{data:f}=await R.from("restaurant_ratings").select("*").eq("restaurant_id",t).maybeSingle();s(f)}catch(p){const m=p instanceof Error?p.message:"Failed to load reviews";j(m)}finally{b(!1)}},[t,r?.id]);o.useEffect(()=>{v()},[v]);const M=r&&n.find(p=>p.user_id===r.id)||null;return{reviews:n,rating:a,isLoading:d,error:g,hasUserReviewed:!!M,userReview:M,submitReview:async(p,m,w)=>{if(!r)return{error:"You must be logged in to submit a review"};if(p<1||p>5)return{error:"Rating must be between 1 and 5"};try{const h=[];if(w&&w.length>0)for(const N of w){const E=N.name.split(".").pop(),y=`${r.id}/${Math.random().toString(36).substring(2)}_${Date.now()}.${E}`,{error:z}=await R.storage.from("review-images").upload(y,N);if(z)throw z;const{data:{publicUrl:L}}=R.storage.from("review-images").getPublicUrl(y);h.push(L)}const f={restaurant_id:t,user_id:r.id,rating:p,comment:m||null,images:h,image_url:h.length>0?h[0]:null},{error:u}=await R.from("reviews").insert(f);if(u)throw u;return await v(),{error:null}}catch(h){return{error:h instanceof Error?h.message:"Failed to submit review"}}},updateReview:async(p,m,w,h,f)=>{if(!r)return{error:"You must be logged in to update a review"};if(m<1||m>5)return{error:"Rating must be between 1 and 5"};try{const{data:u,error:N}=await R.from("reviews").select("images, image_url").eq("id",p).eq("user_id",r.id).single();if(N)throw N;const E=u;let y=E.images||[];if(y.length===0&&E.image_url&&(y=[E.image_url]),f&&f.length>0&&(y=y.filter(L=>!f.includes(L))),h&&h.length>0)for(const L of h){const P=L.name.split(".").pop(),I=`${r.id}/${Math.random().toString(36).substring(2)}_${Date.now()}.${P}`,{error:D}=await R.storage.from("review-images").upload(I,L);if(D)throw D;const{data:{publicUrl:q}}=R.storage.from("review-images").getPublicUrl(I);y.push(q)}const{error:z}=await R.from("reviews").update({rating:m,comment:w||null,images:y,image_url:y.length>0?y[0]:null}).eq("id",p).eq("user_id",r.id);if(z)throw z;return await v(),{error:null}}catch(u){return{error:u instanceof Error?u.message:"Failed to update review"}}},deleteReview:async p=>{if(!r)return{error:"You must be logged in to delete a review"};try{const{error:m}=await R.from("reviews").delete().eq("id",p).eq("user_id",r.id);if(m)throw m;return await v(),{error:null}}catch(m){return{error:m instanceof Error?m.message:"Failed to delete review"}}},refetch:v}}function Oe({user:t,className:r="",size:n="md"}){const[i,a]=o.useState(!1),s={sm:"w-8 h-8",md:"w-10 h-10",lg:"w-12 h-12"},d=`${s[n]} bg-neutral-200 rounded-full flex items-center justify-center text-neutral-500 ${r}`;return t?.avatar_url&&!i?e.jsx("img",{src:t.avatar_url,alt:t.name||"User",className:`${s[n]} rounded-full object-cover border border-neutral-200 ${r}`,referrerPolicy:"no-referrer",onError:()=>a(!0)}):e.jsx("div",{className:d,children:t?.name?e.jsx("span",{className:"font-semibold text-sm",children:t.name.charAt(0).toUpperCase()}):e.jsx(B,{className:n==="sm"?"w-4 h-4":"w-5 h-5"})})}function Ve({restaurantId:t,onAuthRequired:r}){const{t:n}=C(["restaurant","common","auth","profile"]),{user:i}=G(),{reviews:a,isLoading:s,submitReview:d,deleteReview:b,refetch:g}=Te({restaurantId:t||""}),[j,v]=o.useState(!1),[M,S]=o.useState(5),[k,$]=o.useState(""),[F,p]=o.useState(!1),[m,w]=o.useState(null),[h,f]=o.useState([]),[u,N]=o.useState([]),[E,y]=o.useState(!1),[z,L]=o.useState(null),P=()=>{i?v(!0):r()},I=l=>{const x=l.target.files;if(x){const _=Array.from(x);if(_.some(U=>U.size>2*1024*1024)){w(n("submit:form.uploadHint")||"Max 2MB per file");return}f(U=>[...U,..._]);const H=_.map(U=>URL.createObjectURL(U));N(U=>[...U,...H])}},D=l=>{f(x=>x.filter((_,A)=>A!==l)),N(x=>{const _=x[l];return URL.revokeObjectURL(_),x.filter((A,H)=>H!==l)})};o.useEffect(()=>()=>{u.forEach(l=>URL.revokeObjectURL(l))},[u]);const q=async l=>{l.preventDefault(),p(!0),w(null);const{error:x}=await d(M,k,h);x?w(x):(v(!1),$(""),S(5),f([]),N([])),p(!1)},c=async l=>{await b(l)};return e.jsxs("div",{className:"mt-8 bg-white rounded-2xl shadow-card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-neutral-900 flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5 text-primary-500"}),n("restaurant:reviews.title",{count:a.length})]}),e.jsxs("button",{onClick:P,className:"flex items-center gap-2 px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:[e.jsx(K,{size:16}),n("restaurant:reviews.writeReview")]})]}),j&&i&&e.jsxs("form",{onSubmit:q,className:"mb-6 p-4 bg-neutral-50 rounded-xl",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:n("restaurant:reviews.yourRating")}),e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(l=>e.jsx("button",{type:"button",onClick:()=>S(l),className:"transition-colors",children:e.jsx(K,{size:28,className:l<=M?"fill-amber-400 text-amber-400":"text-neutral-300"})},l))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"comment",className:"block text-sm font-medium text-neutral-700 mb-2",children:n("restaurant:reviews.yourReview")}),e.jsx("textarea",{id:"comment",value:k,onChange:l=>$(l.target.value),placeholder:n("restaurant:reviews.reviewPlaceholder"),rows:3,required:!0,className:"w-full px-4 py-3 border-2 border-neutral-200 rounded-xl focus:border-primary-400 focus:ring-4 focus:ring-primary-100 focus:outline-none transition-all resize-none"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:n("restaurant:reviews.addPhoto")}),u.length>0&&e.jsx("div",{className:"flex gap-2 flex-wrap mt-2",children:u.map((l,x)=>e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:l,alt:`Preview ${x+1}`,className:"h-24 w-24 rounded-lg object-cover border border-neutral-200"}),e.jsx("button",{type:"button",onClick:()=>D(x),className:"absolute -top-2 -right-2 p-1 bg-white rounded-full shadow-md text-neutral-500 hover:text-red-500 transition-colors","aria-label":"Remove photo",children:e.jsx(Y,{size:14})})]},x))}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsxs("label",{className:"cursor-pointer inline-flex items-center gap-2 px-4 py-2 bg-white border border-neutral-300 rounded-xl text-sm font-medium text-neutral-700 hover:bg-neutral-50 transition-colors",children:[e.jsx(Q,{size:18}),n("restaurant:reviews.uploadPhoto"),e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:I,className:"hidden"})]}),e.jsxs("label",{className:"cursor-pointer inline-flex items-center gap-2 px-4 py-2 bg-white border border-neutral-300 rounded-xl text-sm font-medium text-neutral-700 hover:bg-neutral-50 transition-colors",children:[e.jsx(ke,{size:18}),n("restaurant:reviews.takePhoto"),e.jsx("input",{type:"file",accept:"image/*",capture:"environment",multiple:!0,onChange:I,className:"hidden"})]})]}),e.jsx("p",{className:"mt-1 text-xs text-neutral-400",children:n("restaurant:reviews.photoHint")})]}),m&&e.jsx("p",{className:"text-red-600 text-sm mb-4",children:m}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",disabled:F,className:"px-6 py-2 bg-primary-500 hover:bg-primary-600 disabled:bg-primary-300 text-white font-medium rounded-xl transition-colors",children:n(F?"common:loading":"restaurant:reviews.submitReview")}),e.jsx("button",{type:"button",onClick:()=>v(!1),className:"px-6 py-2 bg-neutral-200 hover:bg-neutral-300 text-neutral-700 font-medium rounded-xl transition-colors",children:n("common:cancel")})]})]}),s?e.jsx("div",{className:"space-y-4",children:[1,2].map(l=>e.jsx("div",{className:"h-24 rounded-xl animate-shimmer"},l))}):a.length===0?e.jsxs("div",{className:"text-center py-8 text-neutral-500",children:[e.jsx(te,{className:"w-12 h-12 mx-auto mb-3 text-neutral-300"}),e.jsx("p",{children:n("restaurant:reviews.noReviews")}),!i&&e.jsx("button",{onClick:P,className:"text-primary-600 font-medium hover:text-primary-700 transition-colors mt-2",children:n("restaurant:reviews.loginToReview")})]}):e.jsx("div",{className:"space-y-4",children:a.map(l=>e.jsxs("div",{className:"p-4 bg-neutral-50 rounded-xl",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Oe,{user:l.users}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-neutral-900 text-sm mb-0.5",children:l.users?.name||n("common:user")}),e.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(x=>e.jsx(K,{size:14,className:x<=l.rating?"fill-amber-400 text-amber-400":"text-neutral-300"},x))}),e.jsxs("div",{className:"text-xs text-neutral-400 flex items-center gap-2",children:[new Date(l.created_at).toLocaleDateString(navigator.language),l.is_hidden&&e.jsx("span",{className:"px-2 py-0.5 bg-red-100 text-red-600 text-[10px] rounded-full",children:n("common:hidden")})]})]})]}),l.user_id===i?.id&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>{L(l),y(!0)},className:"p-1 text-primary-500 hover:bg-primary-50 rounded-full transition-colors",title:n("common:edit"),children:e.jsx(_e,{size:16})}),e.jsx("button",{onClick:()=>{confirm(n("common:confirmDelete"))&&c(l.id)},className:"p-1 text-neutral-400 hover:text-red-500 transition-colors rounded-full hover:bg-neutral-100",title:n("common:delete"),children:e.jsx(J,{size:16})})]})]}),e.jsx("p",{className:"text-neutral-700",children:l.comment}),l.images&&l.images.length>0?e.jsx("div",{className:"mt-3 flex gap-2 overflow-x-auto pb-2 scrollbar-thin",children:l.images.map((x,_)=>e.jsx("img",{src:x,alt:`Review attachment ${_+1}`,className:"h-32 w-32 rounded-lg object-cover border border-neutral-200 flex-shrink-0"},_))}):l.image_url&&e.jsx("div",{className:"mt-3",children:e.jsx("img",{src:l.image_url,alt:"Review attachment",className:"max-h-48 rounded-lg object-cover border border-neutral-200"})}),l.is_hidden&&l.admin_comment&&e.jsxs("div",{className:"mt-3 p-3 bg-red-50 rounded-lg border border-red-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Re,{size:14,className:"text-red-500"}),e.jsx("p",{className:"text-xs font-medium text-red-700",children:n("common:adminComment")})]}),e.jsx("p",{className:"text-sm text-red-800",children:l.admin_comment})]})]},l.id))}),E&&z&&e.jsx($e,{isOpen:E,onClose:()=>y(!1),onSuccess:()=>{g(),y(!1)},review:z})]})}function Ge({isOpen:t,onClose:r,restaurantId:n,userId:i}){const{t:a}=C(["restaurant","common"]),[s,d]=o.useState(""),[b,g]=o.useState(""),[j,v]=o.useState(""),[M,S]=o.useState(!1),[k,$]=o.useState([]),[F,p]=o.useState(!1),[m,w]=o.useState("upload"),[h,f]=o.useState(""),[u,N]=o.useState("upload"),[E,y]=o.useState(""),z=o.useRef(null);if(!t)return null;const L=s==="image"||s==="menu",P=s==="menu"?"image/*,.pdf":"image/*",I=async c=>{const l=c.target.files;if(!(!l||l.length===0)){p(!0);try{const x=[];for(const _ of Array.from(l)){const A=_.name.split(".").pop(),H=`${Date.now()}-${Math.random().toString(36).substring(7)}.${A}`,Z=`${s==="menu"?"menus":"gallery"}/${H}`,{error:ee}=await R.storage.from("restaurants").upload(Z,_);if(ee)throw ee;const{data:{publicUrl:oe}}=R.storage.from("restaurants").getPublicUrl(Z);x.push(oe)}$(_=>[..._,...x])}catch(x){console.error("Upload error:",x),alert(a("common:uploadError")||"Upload failed")}finally{p(!1),z.current&&(z.current.value="")}}},D=c=>{$(l=>l.filter((x,_)=>_!==c))},q=async c=>{if(c.preventDefault(),!!s&&!(!L&&!b)&&!(s==="image"&&(u==="upload"&&k.length===0||u==="link"&&!E))&&!(s==="menu"&&(m==="upload"&&k.length===0||m==="link"&&!h))){S(!0);try{let l=b;s==="image"?l=u==="link"?E:k.join(","):s==="menu"&&(l=m==="link"?h:k.join(","));const{error:x}=await R.from("restaurant_reports").insert({restaurant_id:n,user_id:i||null,field_name:s,suggested_value:l,reason:j||null});if(x)throw x;r(),d(""),g(""),v(""),$([]),f(""),O.success(a("restaurant:reportModal.success"))}catch(l){console.error("Report submission error:",l),O.error(a("restaurant:reportModal.error"))}finally{S(!1)}}};return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-fade-in",style:{zIndex:100},children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-neutral-100 flex items-center justify-between sticky top-0 bg-white",children:[e.jsx("h2",{className:"text-xl font-bold text-neutral-900",children:a("restaurant:reportModal.title")}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-neutral-100 rounded-full transition-colors","aria-label":a("common:close"),children:e.jsx(Y,{size:20,className:"text-neutral-500"})})]}),e.jsxs("form",{onSubmit:q,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:a("restaurant:reportModal.fieldLabel")}),e.jsxs("select",{value:s,onChange:c=>{d(c.target.value),$([]),f(""),g("")},required:!0,onInvalid:c=>c.target.setCustomValidity(a("restaurant:reportModal.selectField")),onInput:c=>c.target.setCustomValidity(""),className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:a("restaurant:reportModal.selectField")}),e.jsx("option",{value:"pet_policy",children:a("restaurant:reportModal.fields.pet_policy")}),e.jsx("option",{value:"contact_info",children:a("restaurant:reportModal.fields.contact_info")}),e.jsx("option",{value:"address",children:a("restaurant:reportModal.fields.address")}),e.jsx("option",{value:"cuisine_type",children:a("restaurant:reportModal.fields.cuisine_type")}),e.jsx("option",{value:"image",children:a("restaurant:reportModal.fields.image")||"相片"}),e.jsx("option",{value:"menu",children:a("restaurant:reportModal.fields.menu")||"菜單"}),e.jsx("option",{value:"other",children:a("restaurant:reportModal.fields.other")})]})]}),s==="image"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:[e.jsx(Q,{size:16,className:"inline mr-1"}),a("restaurant:reportModal.uploadImages")||"相片"]}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsxs("button",{type:"button",onClick:()=>N("upload"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-1 ${u==="upload"?"bg-primary-500 text-white":"bg-neutral-100 text-neutral-600 hover:bg-neutral-200"}`,children:[e.jsx(T,{size:14}),a("common:upload")||"上傳"]}),e.jsxs("button",{type:"button",onClick:()=>N("link"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-1 ${u==="link"?"bg-primary-500 text-white":"bg-neutral-100 text-neutral-600 hover:bg-neutral-200"}`,children:[e.jsx(se,{size:14}),a("common:link")||"連結"]})]}),u==="upload"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:z,type:"file",accept:P,multiple:!0,onChange:I,className:"hidden",id:"report-file-upload"}),e.jsxs("label",{htmlFor:"report-file-upload",className:"flex items-center justify-center gap-2 w-full p-4 border-2 border-dashed border-neutral-300 rounded-xl cursor-pointer hover:border-primary-400 hover:bg-primary-50 transition-colors",children:[e.jsx(T,{size:20,className:"text-neutral-500"}),e.jsx("span",{className:"text-neutral-600",children:F?a("common:uploading")||"上傳中...":a("common:clickToUpload")||"點擊上傳"})]}),k.length>0&&e.jsx("div",{className:"mt-3 grid grid-cols-3 gap-2",children:k.map((c,l)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:c,alt:"",className:"w-full h-20 object-cover rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>D(l),className:"absolute top-1 right-1 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(J,{size:12})})]},l))})]}),u==="link"&&e.jsx("input",{type:"url",value:E,onChange:c=>y(c.target.value),placeholder:"https://...",className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),s==="menu"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:[e.jsx(X,{size:16,className:"inline mr-1"}),a("restaurant:reportModal.menuUpload")||"菜單"]}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsxs("button",{type:"button",onClick:()=>w("upload"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-1 ${m==="upload"?"bg-primary-500 text-white":"bg-neutral-100 text-neutral-600 hover:bg-neutral-200"}`,children:[e.jsx(T,{size:14}),a("common:upload")||"上傳"]}),e.jsxs("button",{type:"button",onClick:()=>w("link"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-1 ${m==="link"?"bg-primary-500 text-white":"bg-neutral-100 text-neutral-600 hover:bg-neutral-200"}`,children:[e.jsx(se,{size:14}),a("common:link")||"連結"]})]}),m==="link"&&e.jsx("input",{type:"url",value:h,onChange:c=>f(c.target.value),placeholder:"https://...",className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500"}),m==="upload"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:z,type:"file",accept:P,multiple:!0,onChange:I,className:"hidden",id:"report-menu-upload"}),e.jsxs("label",{htmlFor:"report-menu-upload",className:"flex items-center justify-center gap-2 w-full p-4 border-2 border-dashed border-neutral-300 rounded-xl cursor-pointer hover:border-primary-400 hover:bg-primary-50 transition-colors",children:[e.jsx(T,{size:20,className:"text-neutral-500"}),e.jsx("span",{className:"text-neutral-600",children:F?a("common:uploading")||"上傳中...":a("common:uploadImageOrPdf")||"上傳圖片或 PDF"})]}),k.length>0&&e.jsx("div",{className:"mt-3 space-y-2",children:k.map((c,l)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-neutral-50 rounded-lg",children:[c.endsWith(".pdf")?e.jsx(X,{size:20,className:"text-red-500"}):e.jsx("img",{src:c,alt:"",className:"w-12 h-12 object-cover rounded"}),e.jsx("span",{className:"flex-1 text-sm text-neutral-600 truncate",children:c.split("/").pop()}),e.jsx("button",{type:"button",onClick:()=>D(l),className:"p-1 text-red-500 hover:bg-red-50 rounded",children:e.jsx(J,{size:16})})]},l))})]})]}),!L&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:a("restaurant:reportModal.suggestedValue")}),e.jsx("textarea",{value:b,onChange:c=>g(c.target.value),required:!0,onInvalid:c=>c.target.setCustomValidity(a("restaurant:reportModal.validation.required")),onInput:c=>c.target.setCustomValidity(""),rows:3,className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:a("restaurant:reportModal.reason")}),e.jsx("textarea",{value:j,onChange:c=>v(c.target.value),placeholder:a("restaurant:reportModal.reasonPlaceholder"),rows:2,className:"w-full px-4 py-2 border border-neutral-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{className:"pt-2 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 text-neutral-600 hover:bg-neutral-50 rounded-lg font-medium transition-colors",children:a("common:cancel")}),e.jsx("button",{type:"submit",disabled:M||F,className:"px-4 py-2 bg-primary-500 text-white rounded-lg font-medium hover:bg-primary-600 transition-colors disabled:opacity-50",children:a(M?"common:loading":"common:submit")})]})]})]})})}function Ye(){const{t}=C(["common"]);return e.jsx("footer",{className:"bg-white border-t border-neutral-200 py-8 mt-12",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 text-center text-neutral-500 text-sm",children:e.jsxs("p",{children:["© ",new Date().getFullYear()," ",t("common:appName"),". ",t("common:allRightsReserved")]})})})}function Ke(){const{t}=C(["common"]);return e.jsxs("div",{className:"min-h-screen bg-neutral-50",children:[e.jsx("div",{className:"h-64 md:h-96 animate-shimmer"}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-primary-200 border-t-primary-500 rounded-full animate-spin"}),e.jsx("p",{className:"text-neutral-500 font-medium",children:t("common:loading")})]})})]})}function We({error:t}){const{t:r}=C(["common"]);return e.jsx("div",{className:"min-h-screen bg-neutral-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center px-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-neutral-900 mb-4",children:r("common:errors.loadingRestaurants")}),e.jsx("p",{className:"text-neutral-600 mb-6 max-w-md",children:t}),e.jsx(W,{to:"/",className:"px-6 py-3 bg-primary-500 text-white font-medium rounded-xl hover:bg-primary-600 transition-colors",children:r("common:backToHome")})]})})}function nt(){const{id:t}=de(),{i18n:r}=C(),n=r.language,{user:i,isAdmin:a}=G(),[s,d]=o.useState(null),[b,g]=o.useState(!0),[j,v]=o.useState(null),[M,S]=o.useState(!1),[k,$]=o.useState(!1),[F,p]=o.useState(!1),[m,w]=o.useState(!1);o.useEffect(()=>{const f=()=>{$(window.scrollY>10)};return window.addEventListener("scroll",f),()=>window.removeEventListener("scroll",f)},[]);const h=o.useCallback(async(f=!1)=>{if(t){f||g(!0),v(null);try{const{data:u,error:N}=await R.from("restaurants").select("*").eq("id",t).single();if(N)throw N;d(u)}catch(u){const N=u instanceof Error?u.message:"Failed to load restaurant";v(N)}finally{f||g(!1)}}},[t]);return o.useEffect(()=>{h()},[h]),b?e.jsx(Ke,{}):j||!s?e.jsx(We,{error:j||"Restaurant not found"}):e.jsxs("div",{className:"min-h-screen bg-neutral-50",children:[e.jsx(Ee,{isScrolled:k,onLoginClick:()=>S(!0)}),e.jsx(Fe,{restaurant:s,lang:n}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[e.jsx(Le,{restaurant:s,onReportClick:()=>p(!0),onAuthRequired:()=>S(!0),isAdmin:a,onEditClick:()=>w(!0)}),e.jsx(Ie,{restaurant:s,lang:n}),e.jsx(Ue,{restaurant:s}),e.jsx(De,{restaurant:s}),e.jsx(qe,{restaurant:s}),e.jsx(Ae,{restaurant:s,lang:n}),e.jsx(He,{restaurant:s}),e.jsx(Ve,{restaurantId:s.id,onAuthRequired:()=>S(!0)})]}),e.jsx(Ye,{}),e.jsx(me,{isOpen:M,onClose:()=>S(!1)}),e.jsx(Ge,{isOpen:F,onClose:()=>p(!1),restaurantId:s.id,userId:i?.id}),e.jsx(Me,{isOpen:m,onClose:()=>w(!1),onSave:()=>{h(!0),w(!1)},restaurant:s})]})}export{nt as RestaurantDetail};
