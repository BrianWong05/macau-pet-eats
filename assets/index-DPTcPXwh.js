import{u as C,j as e,s as v}from"./index-da4C4Nok.js";import{L as P,r as d}from"./react-vendor-B-2HpIm1.js";import{L as R}from"./index-DvGUM6NA.js";import{A as E,O as U,n as F,X as A,h as M,e as q,P as H}from"./ui-vendor-BzBFCVgS.js";import"./supabase-K6a4hp2a.js";function V({isScrolled:r}){const{t:a}=C();return e.jsx("header",{className:`
        fixed top-0 left-0 right-0 z-50 transition-all duration-300 border-b
        ${r?"bg-white/90 backdrop-blur-md border-neutral-200 py-3 shadow-sm":"bg-white border-neutral-200 py-4"}
      `,children:e.jsxs("div",{className:"max-w-3xl mx-auto px-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(P,{to:"/",className:"p-2 hover:bg-neutral-100 rounded-xl transition-colors","aria-label":a("restaurant.backToList"),children:e.jsx(E,{size:20,className:"text-neutral-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-neutral-900",children:a("submit.title")}),e.jsx("p",{className:"text-sm text-neutral-500 hidden sm:block",children:a("submit.subtitle")})]})]}),e.jsx(R,{})]})})}function B({onReset:r}){const{t:a}=C();return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 via-white to-secondary-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-md w-full text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-secondary-100 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(U,{className:"w-10 h-10 text-secondary-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-neutral-900 mb-3",children:a("submit.successTitle")}),e.jsx("p",{className:"text-neutral-600 mb-8",children:a("submit.successMessage")}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsx(P,{to:"/",className:"px-6 py-3 bg-primary-500 text-white font-semibold rounded-xl hover:bg-primary-600 transition-colors",children:a("submit.backToHome")}),e.jsx("button",{onClick:r,className:"px-6 py-3 bg-white border-2 border-neutral-200 text-neutral-700 font-semibold rounded-xl hover:bg-neutral-50 transition-colors",children:a("nav.submit")})]})]})})}const W=["indoors_allowed","patio_only","small_pets_only","all_pets_welcome","dogs_only","cats_only"];function Y({formData:r,setFormData:a,cuisineTypes:k,formState:f,setFormState:p,imageFiles:g,setImageFiles:_,imagePreviews:b,setImagePreviews:w}){const{t:n,i18n:y}=C(),h=d.useRef(null),u=s=>{const{name:i,value:l}=s.target;a(t=>({...t,[i]:l}))},j=s=>{const i=Array.from(s.target.files||[]);if(i.length>0){const l=i.filter(t=>!(!t.type.startsWith("image/")||t.size>5242880));l.length>0&&(_(t=>[...t,...l]),l.forEach(t=>{const m=new FileReader;m.onloadend=()=>{w(c=>[...c,m.result])},m.readAsDataURL(t)}))}},N=s=>{_(i=>i.filter((l,t)=>t!==s)),w(i=>i.filter((l,t)=>t!==s)),h.current&&(h.current.value="")},[L,O]=d.useState(!1),S=d.useRef(null),$=async s=>{s.preventDefault(),p("submitting");try{if(!r.cuisine_type||r.cuisine_type.length===0){p("error"),S.current&&(S.current.scrollIntoView({behavior:"smooth",block:"center"}),O(!0),setTimeout(()=>O(!1),2e3));return}const i=[];if(g.length>0)for(const c of g){const x=c.name.split(".").pop(),T=`${`${Math.random().toString(36).substring(2)}_${Date.now()}.${x}`}`,{error:z}=await v.storage.from("restaurants").upload(T,c);if(z)throw new Error(`Image upload failed: ${z.message}`);const{data:{publicUrl:I}}=v.storage.from("restaurants").getPublicUrl(T);i.push(I)}const l=i.length>0?i[0]:"",t={...r,name_zh:r.name,description_zh:r.description,address_zh:r.address,name:"",description:"",address:"",image_url:l,gallery_images:i,status:"pending"};if(t.cuisine_type&&Array.isArray(t.cuisine_type)){const c=x=>t.cuisine_type.map(o=>o==="Other"?r.cuisine_type_other||"Other":y.getFixedT(x)(`cuisineTypes.${o.toLowerCase()}`));if(t.cuisine_type_zh=c("zh"),t.cuisine_type_pt=c("pt"),t.cuisine_type.includes("Other")&&r.cuisine_type_other){const x=r.cuisine_type_other;t.cuisine_type=t.cuisine_type.map(o=>o==="Other"?x:o),t.cuisine_type_zh=t.cuisine_type_zh.map(o=>o==="其他"||o==="Other"?x:o),t.cuisine_type_pt=t.cuisine_type_pt.map(o=>o==="Outros"||o==="Other"?x:o)}}delete t.cuisine_type_other,t.latitude||(t.latitude=22.1897),t.longitude||(t.longitude=113.5378);const{error:m}=await v.from("restaurants").insert(t);if(m)throw m;p("success")}catch(i){console.error("Submission error:",i),p("error")}};return e.jsxs("form",{onSubmit:$,className:"space-y-6",children:[f==="error"&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 text-red-700 rounded-xl",children:[e.jsx(F,{className:"w-5 h-5 shrink-0"}),e.jsx("span",{children:n("submit.errorMessage")})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-card p-6",children:[e.jsxs("label",{htmlFor:"name",className:"block text-sm font-medium text-neutral-700 mb-2",children:[n("submit.form.name")," *"]}),e.jsx("input",{type:"text",id:"name",name:"name",required:!0,value:r.name,onChange:u,placeholder:n("submit.form.namePlaceholder"),className:"w-full px-4 py-3 border-2 border-neutral-200 rounded-xl focus:border-primary-400 focus:ring-4 focus:ring-primary-100 focus:outline-none transition-all"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-card p-6",children:[e.jsxs("label",{htmlFor:"description",className:"block text-sm font-medium text-neutral-700 mb-2",children:[n("submit.form.description")," (",n("submit.form.optional"),")"]}),e.jsx("textarea",{id:"description",name:"description",rows:4,value:r.description,onChange:u,placeholder:n("submit.form.descriptionPlaceholder"),className:"w-full px-4 py-3 border-2 border-neutral-200 rounded-xl focus:border-primary-400 focus:ring-4 focus:ring-primary-100 focus:outline-none transition-all resize-none"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-card p-6",children:[e.jsxs("label",{htmlFor:"address",className:"block text-sm font-medium text-neutral-700 mb-2",children:[n("submit.form.address")," *"]}),e.jsx("input",{type:"text",id:"address",name:"address",required:!0,value:r.address,onChange:u,placeholder:n("submit.form.addressPlaceholder"),className:"w-full px-4 py-3 border-2 border-neutral-200 rounded-xl focus:border-primary-400 focus:ring-4 focus:ring-primary-100 focus:outline-none transition-all"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-card p-6",children:[e.jsxs("label",{htmlFor:"location",className:"block text-sm font-medium text-neutral-700 mb-2",children:[n("explore.filters.location")||"地區"," *"]}),e.jsxs("select",{id:"location",name:"location",required:!0,value:r.location||"澳門",onChange:u,className:"w-full px-4 py-3 border-2 border-neutral-200 rounded-xl focus:border-primary-400 focus:ring-4 focus:ring-primary-100 focus:outline-none transition-all appearance-none bg-white",children:[e.jsx("option",{value:"澳門",children:"澳門 / Macau"}),e.jsx("option",{value:"氹仔",children:"氹仔 / Taipa"}),e.jsx("option",{value:"路環",children:"路環 / Coloane"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-card p-6",children:[e.jsxs("label",{htmlFor:"pet_policy",className:"block text-sm font-medium text-neutral-700 mb-2",children:[n("submit.form.petPolicy")," *"]}),e.jsx("select",{id:"pet_policy",name:"pet_policy",required:!0,value:r.pet_policy,onChange:u,className:"w-full px-4 py-3 border-2 border-neutral-200 rounded-xl focus:border-primary-400 focus:ring-4 focus:ring-primary-100 focus:outline-none transition-all appearance-none bg-white",children:W.map(s=>e.jsx("option",{value:s,children:n(`petPolicy.${s}`)},s))})]}),e.jsxs("div",{ref:S,className:`bg-white rounded-2xl shadow-card p-6 transition-colors duration-500 ${L?"ring-2 ring-red-500 bg-red-50":""}`,children:[e.jsxs("label",{htmlFor:"cuisine_type",className:"block text-sm font-medium text-neutral-700 mb-2",children:[n("submit.form.cuisineType")," *"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[k.filter(s=>s.name!=="Other").map(s=>{const i=y.language==="zh"?s.name_zh||s.name:y.language==="pt"&&s.name_pt||s.name,l=(r.cuisine_type||[]).includes(s.name);return e.jsx("button",{type:"button",onClick:()=>{const t=r.cuisine_type||[],m=t.includes(s.name)?t.filter(c=>c!==s.name):[...t,s.name];a(c=>({...c,cuisine_type:m}))},className:`
                      px-3 py-1.5 rounded-full text-sm font-medium transition-all border
                      ${l?"bg-primary-500 text-white border-primary-500 shadow-sm":"bg-white text-neutral-600 border-neutral-200 hover:border-primary-300 hover:bg-neutral-50"}
                    `,children:i},s.id)}),e.jsx("button",{type:"button",onClick:()=>{const s=r.cuisine_type||[],i=s.includes("Other")?s.filter(l=>l!=="Other"):[...s,"Other"];a(l=>({...l,cuisine_type:i}))},className:`
                  px-3 py-1.5 rounded-full text-sm font-medium transition-all border
                  ${(r.cuisine_type||[]).includes("Other")?"bg-primary-500 text-white border-primary-500 shadow-sm":"bg-white text-neutral-600 border-neutral-200 hover:border-primary-300 hover:bg-neutral-50"}
                `,children:n("common.other")||"Other"})]}),(r.cuisine_type||[]).includes("Other")&&e.jsx("input",{type:"text",name:"cuisine_type_other",value:r.cuisine_type_other||"",onChange:u,placeholder:n("submit.form.otherCuisinePlaceholder")||"Please specify cuisine type",className:"w-full px-4 py-3 border-2 border-neutral-200 rounded-xl focus:border-primary-400 focus:ring-4 focus:ring-primary-100 focus:outline-none transition-all"}),(r.cuisine_type||[]).length===0&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:n("submit.form.selectAtLeastOne")||"Please select at least one cuisine type"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-card p-6",children:[e.jsxs("label",{htmlFor:"contact_info",className:"block text-sm font-medium text-neutral-700 mb-2",children:[n("submit.form.contactInfo")," (",n("submit.form.optional"),")"]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-neutral-500 font-medium",children:"+853"})}),e.jsx("input",{type:"text",id:"contact_info",name:"contact_info",value:r.contact_info?.replace(/^\+853\s?/,"")||"",onChange:s=>{const i=s.target.value.replace(/^\+853\s?/,"");a(l=>({...l,contact_info:`+853 ${i}`}))},placeholder:"6666 6666",className:"w-full pl-16 pr-4 py-3 border-2 border-neutral-200 rounded-xl focus:border-primary-400 focus:ring-4 focus:ring-primary-100 focus:outline-none transition-all"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-card p-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:[n("restaurant.socialMedia.title")," (",n("submit.form.optional")||"Optional",")"]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsx("input",{type:"url",value:r.social_media?.facebook||"",onChange:s=>a(i=>({...i,social_media:{...i.social_media,facebook:s.target.value||""}})),placeholder:"Facebook URL",className:"w-full px-4 py-3 border-2 border-neutral-200 rounded-xl focus:border-primary-400 focus:ring-4 focus:ring-primary-100 focus:outline-none transition-all"}),e.jsx("input",{type:"url",value:r.social_media?.instagram||"",onChange:s=>a(i=>({...i,social_media:{...i.social_media,instagram:s.target.value||""}})),placeholder:"Instagram URL",className:"w-full px-4 py-3 border-2 border-neutral-200 rounded-xl focus:border-primary-400 focus:ring-4 focus:ring-primary-100 focus:outline-none transition-all"}),e.jsx("input",{type:"url",value:r.social_media?.website||"",onChange:s=>a(i=>({...i,social_media:{...i.social_media,website:s.target.value||""}})),placeholder:"Website URL",className:"w-full px-4 py-3 border-2 border-neutral-200 rounded-xl focus:border-primary-400 focus:ring-4 focus:ring-primary-100 focus:outline-none transition-all"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-card p-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:[n("submit.form.uploadPhoto")," (Max 5 photos)"]}),e.jsxs("div",{className:"grid grid-cols-2 xs:grid-cols-3 md:grid-cols-4 gap-4",children:[b.map((s,i)=>e.jsxs("div",{className:"relative aspect-square",children:[e.jsx("img",{src:s,alt:`Preview ${i+1}`,className:"w-full h-full object-cover rounded-xl"}),e.jsx("button",{type:"button",onClick:()=>N(i),className:"absolute top-1 right-1 p-1 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors shadow-md","aria-label":n("common.close"),children:e.jsx(A,{size:14})})]},i)),b.length<5&&e.jsxs("div",{onClick:()=>h.current?.click(),className:`
                border-2 border-dashed border-neutral-300
                rounded-xl aspect-square
                flex flex-col items-center justify-center
                cursor-pointer
                hover:border-primary-400 hover:bg-primary-50
                transition-all
              `,children:[e.jsx("div",{className:"p-2 bg-neutral-100 rounded-full mb-2",children:e.jsx(M,{size:20,className:"text-neutral-400"})}),e.jsx("span",{className:"text-xs font-medium text-neutral-600 text-center px-2",children:b.length===0?n("submit.form.clickToUpload"):n("common.addMore")})]})]}),e.jsx("input",{ref:h,type:"file",accept:"image/*",multiple:!0,onChange:j,className:"hidden"})]}),e.jsx("button",{type:"submit",disabled:f==="submitting",className:"w-full flex items-center justify-center gap-3 px-8 py-4 bg-primary-500 hover:bg-primary-600 disabled:bg-primary-300 text-white font-semibold text-lg rounded-xl shadow-lg hover:shadow-xl transition-all",children:f==="submitting"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:n("common.loading")})]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{size:20}),e.jsx("span",{children:n("submit.submitButton")})]})})]})}function X(){const{t:r}=C();return e.jsx("footer",{className:"bg-neutral-900 text-neutral-400 py-8 mt-16",children:e.jsxs("div",{className:"max-w-3xl mx-auto px-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx(H,{className:"w-5 h-5 text-primary-400"}),e.jsx("span",{className:"font-semibold text-white",children:r("common.appName")})]}),e.jsx("p",{className:"text-sm",children:r("footer.copyright")})]})})}function D(){const[r,a]=d.useState(!1),[k,f]=d.useState([]);d.useEffect(()=>{const j=()=>{a(window.scrollY>10)};return window.addEventListener("scroll",j),()=>window.removeEventListener("scroll",j)},[]),d.useEffect(()=>{(async()=>{const{data:N}=await v.from("cuisine_types").select("*").order("sort_order",{ascending:!0});N&&f(N)})()},[]);const[p,g]=d.useState("idle"),[_,b]=d.useState([]),[w,n]=d.useState([]),[y,h]=d.useState({name:"",description:"",address:"",pet_policy:"patio_only",cuisine_type:[],contact_info:"",image_url:"",gallery_images:[],social_media:{facebook:"",instagram:"",website:""}}),u=()=>{g("idle"),b([]),n([]),h({name:"",description:"",address:"",pet_policy:"patio_only",cuisine_type:[],contact_info:"",image_url:"",gallery_images:[],social_media:{facebook:"",instagram:"",website:""}})};return p==="success"?e.jsx(B,{onReset:u}):e.jsxs("div",{className:"min-h-screen bg-neutral-50",children:[e.jsx(V,{isScrolled:r}),e.jsx("div",{className:"max-w-3xl mx-auto px-4 py-8 pt-28",children:e.jsx(Y,{formData:y,setFormData:h,cuisineTypes:k,formState:p,setFormState:g,imageFiles:_,setImageFiles:b,imagePreviews:w,setImagePreviews:n})}),e.jsx(X,{})]})}export{D as Submit};
